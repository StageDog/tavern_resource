$((async()=>{eventOn(tavern_events.MESSAGE_SENT,(async e=>{1===e&&async function(){const e=getCharLorebooks().primary;if(!e)return void toastr.error('请导入本角色卡的世界书!');const a={元首派医生:{'变量.艾莉卡.好感度':_.random(20,50),'变量.艾琳.好感度':_.random(30,70),'变量.安娜斯塔西娅.好感度':0,'变量.海尔嘉.好感度':_.random(10,60),'变量.莫妮卡.好感度':_.random(20,30),'变量.维多利亚.好感度':_.random(0,40),'变量.伊丽莎白.好感度':0,'变量.伊琳娜.好感度':_.random(10,30),'变量.伊薇特.好感度':_.random(0,20)},蛇之眼高层:{'变量.艾莉卡.好感度':_.random(0,50),'变量.艾琳.好感度':_.random(10,40),'变量.安娜斯塔西娅.好感度':_.random(0,20),'变量.海尔嘉.好感度':_.random(20,50),'变量.莫妮卡.好感度':_.random(40,60),'变量.维多利亚.好感度':_.random(0,100),'变量.伊丽莎白.好感度':_.random(0,50),'变量.伊琳娜.好感度':0,'变量.伊薇特.好感度':_.random(40,80)}},r=await getLorebookEntries(e).then((e=>e.filter((e=>e.comment.includes('user身份是')&&e.enabled)).map((e=>e.comment.replace('user身份是',''))))),n=_.mergeWith({},...r.map((e=>_.defaultTo(a[e],{}))),((e,a)=>_.sample([e,a])));let o=getChatMessages(0)[0].message;o=o.replace(/(?<=\|初始化变量\|)(\s*)(?=<UpdateVariable>)/,Object.entries(n).map((([e,a])=>`\n@${e}=${a}@`)).join('')+'\n'),await setChatMessage({message:o},0,{refresh:'display_current'})}()}))}));