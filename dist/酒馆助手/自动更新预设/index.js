import{compare as t}from'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/json5/+esm';import'https://testingcf.jsdelivr.net/npm/jsonrepair/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';import{marked as e}from'https://testingcf.jsdelivr.net/npm/marked/+esm';const n=z,r=n.z.object({预设名称:n.z.string().default('未填写'),预设链接:n.z.string().default('未填写'),更新日志链接:n.z.string().default('未填写')}).prefault({});function a(t){return{name:`更新预设: ${t.name}`,function:async()=>{if(getPresetNames().includes(t.name))return;await importRawPreset(t.name,t.content)?(loadPreset(t.name),toastr.success(`更新预设 '${t.name}' 成功`)):toastr.error('更新预设失败, 请刷新重试')}}}function s(t){return{name:'更新日志',function:()=>{e.parse(t.changelog,{async:!0,breaks:!0}).then(t=>{SillyTavern.callGenericPopup(t,SillyTavern.POPUP_TYPE.TEXT,'',{leftAlign:!0,wider:!0,allowVerticalScrolling:!0})})}}}async function c(t,e){const n=await fetch(t,{cache:'no-cache'});if(n.ok)return'text'===e?n.text():n.blob();throw new Error(`(${n.status}) ${await n.text()}`)}$(errorCatched(async()=>{!async function(e,n){t(await getTavernHelperVersion(),e,'<')&&toastr.error(`'${n}' 需要酒馆助手版本 >= '${e}'`,'版本不兼容')}('4.6.5','自动更新预设'),async function(t){const e=await fetch(t);if(!e.ok)return!1;const n=await e.text();replaceScriptInfo(n)}('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/自动更新预设/README.md');const e=r.parse(getVariables({type:'script'}));if(replaceVariables(e,{type:'script'}),Object.values(e).some(t=>!t||'未填写'===t))return;const n=await c(e.更新日志链接,'text'),i={name:`${e.预设名称}`+(n.match(/^##\s*(.*)\s*$/m)?.[1]??''),content:await c(e.预设链接,'text'),changelog:n};var o;o=await async function(t){return getPresetNames().includes(t.name)?[]:[a(t),s(t)]}(i),o.forEach(t=>{eventClearEvent(getButtonEvent(t.name)),eventOn(getButtonEvent(t.name),t.function)}),replaceScriptButtons(o.map(t=>({name:t.name,visible:!0})))}));
//# sourceMappingURL=index.js.map