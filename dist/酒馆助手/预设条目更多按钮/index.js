function e(e){return e.closest('.completion_prompt_manager_prompt').attr('data-pm-identifier')}function t(){o.disconnect();const t=$('.completion_prompt_manager_prompt:has(.fa-asterisk)').find('.prompt_manager_prompt_controls');t.find('.prompt-manager-detach-action').remove(),t.prepend($('<span title="delete" class="prompt-manager-remove-action caution fa-solid fa-trash fa-xs"></span>').on('click',async function(){if(!await SillyTavern.callGenericPopup('确定要永久删除这个条目吗?',SillyTavern.POPUP_TYPE.CONFIRM))return;const t=e($(this));await updatePresetWith('in_use',e=>{const n=e.prompts.findIndex(e=>e.id===t);return-1===n||e.prompts.splice(n,1),e},{render:'immediate'})}),$('<span title="copy" class="prompt-manager-copy-action fa-solid fa-copy fa-xs"></span>').on('click',async function(){const t=e($(this));await updatePresetWith('in_use',e=>{const n=e.prompts.findIndex(e=>e.id===t);return-1===n||e.prompts.splice(n+1,0,{...e.prompts[n],id:crypto.randomUUID()}),e},{render:'immediate'})})),o.observe($('#completion_prompt_manager')[0],{childList:!0,subtree:!0})}const n=_.debounce(t,500),o=new MutationObserver(n);$(()=>{t()}),$(window).on('unload',()=>{replacePreset('in_use',getPreset('in_use')),o.disconnect()});