{"version":3,"file":"index.js","mappings":"sLAGAA,eAAeC,IACb,MAAMC,EAAYC,eAElB,IAAIC,EAAkC,KACtC,MAAMC,EAAYC,EAAE,SAASC,OAC3B,+CACAD,EAAE,SAASC,OACTD,EAAE,2DACCC,OAAOL,EAAUM,IAAI,CAACC,EAAUC,IAAU,IAAIC,OAAOF,EAAUG,OAAOF,MACtEG,GAAG,SAAUb,iBACZ,MAAMc,EAAQF,OAAON,EAAES,MAAMC,OAC7B,GAAc,KAAVF,EAEF,YADAV,EAAmB,MAGrB,MAAMK,EAAWP,EAAUe,GAAGC,OAAOJ,IACrCV,EAAmBK,GAAY,IACjC,KAKN,aADqBU,YAAYC,iBAAiBf,EAAU,GAAIc,YAAYE,WAAWC,WACxEH,YAAYI,aAAaC,aAAgBpB,EAIjDA,EAHE,IAIX,CAEAJ,eAAeyB,EACbhB,EACAiB,EACAC,GAEiB,OAAblB,UAIEmB,0BAA0BnB,EAAUoB,IACxCA,EAAQC,QAAQC,IACdA,EAAMC,QAAUN,EAAWK,EAAMC,SAAW,IAC5CD,EAAME,QAAUP,EAAWK,EAAME,SAAW,IAC5CF,EAAMG,KAAOH,EAAMG,KAAK1B,IAAI2B,GAAOT,EAAWS,GAAO,KACrDJ,EAAMK,QAAUL,EAAMK,QAAQ5B,IAAI2B,GAAOT,EAAWS,GAAO,OAEtDN,IAGTV,YAAYC,iBAAiB,OAAOX,WAAkBkB,IAAmBR,YAAYE,WAAWgB,MAClG,CAEA/B,EAAE,MChBKN,eAA0BsC,GAC/B,MAAMC,QAAeC,MAAMF,GAC3B,IAAKC,EAAOE,GACV,OAAO,EAET,MAAMC,QAAoBH,EAAOI,OACjCC,kBAAkBF,EAEpB,CDSEG,CAAW,yFACXC,8BAA8B,CAC5B,CACEC,KAAM,YACNC,SAAS,GAEX,CACED,KAAM,YACNC,SAAS,KAIbC,QAAQC,eAAe,aAAclD,gBAC7ByB,QAAwBxB,IAAkB,EAAe,QAGjEgD,QAAQC,eAAe,aAAclD,gBAC7ByB,QAAwBxB,IAAkB,EAAc","sources":["src://tavern_helper_template/src/酒馆助手/世界书繁简互换/index.ts","src://tavern_helper_template/src/util/tavern.ts"],"sourcesContent":["import { loadReadme } from '@/util/tavern';\nimport { toSimplified, toTraditional } from 'chinese-simple2traditional';\n\nasync function chooseLorebook(): Promise<string | null> {\n  const lorebooks = getLorebooks();\n\n  let chosen_worldbook: string | null = null;\n  const $template = $('<div>').append(\n    '<div><h4><span>请选择你要处理的世界书</span></h4></div>',\n    $('<div>').append(\n      $('<select><option value=\"\">--- None ---</option></select>')\n        .append(lorebooks.map((lorebook, index) => new Option(lorebook, String(index))))\n        .on('change', async function () {\n          const value = String($(this).val());\n          if (value === '') {\n            chosen_worldbook = null;\n            return;\n          }\n          const lorebook = lorebooks.at(Number(value));\n          chosen_worldbook = lorebook ?? null;\n        }),\n    ),\n  );\n\n  const result = await SillyTavern.callGenericPopup($template[0], SillyTavern.POPUP_TYPE.CONFIRM);\n  if (result !== SillyTavern.POPUP_RESULT.AFFIRMATIVE || !chosen_worldbook) {\n    return null;\n  }\n\n  return chosen_worldbook;\n}\n\nasync function translateLorebook(\n  lorebook: string | null,\n  translator: (text: string) => string,\n  translator_name: string,\n) {\n  if (lorebook === null) {\n    return;\n  }\n\n  await updateLorebookEntriesWith(lorebook, entries => {\n    entries.forEach(entry => {\n      entry.comment = translator(entry.comment ?? '');\n      entry.content = translator(entry.content ?? '');\n      entry.keys = entry.keys.map(key => translator(key ?? ''));\n      entry.filters = entry.filters.map(key => translator(key ?? ''));\n    });\n    return entries;\n  });\n\n  SillyTavern.callGenericPopup(`已将 '${lorebook}' 完全翻译成${translator_name}`, SillyTavern.POPUP_TYPE.TEXT);\n}\n\n$(() => {\n  loadReadme('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/世界书繁简互换/README.md');\n  appendInexistentScriptButtons([\n    {\n      name: '将世界书翻译成简体',\n      visible: true,\n    },\n    {\n      name: '将世界书翻译成繁体',\n      visible: true,\n    },\n  ]);\n\n  eventOn(getButtonEvent('将世界书翻译成繁体'), async () => {\n    await translateLorebook(await chooseLorebook(), toTraditional, '繁体');\n  });\n\n  eventOn(getButtonEvent('将世界书翻译成简体'), async () => {\n    await translateLorebook(await chooseLorebook(), toSimplified, '简体');\n  });\n});\n","import { compare } from 'compare-versions';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n"],"names":["async","chooseLorebook","lorebooks","getLorebooks","chosen_worldbook","$template","$","append","map","lorebook","index","Option","String","on","value","this","val","at","Number","SillyTavern","callGenericPopup","POPUP_TYPE","CONFIRM","POPUP_RESULT","AFFIRMATIVE","translateLorebook","translator","translator_name","updateLorebookEntriesWith","entries","forEach","entry","comment","content","keys","key","filters","TEXT","url","readme","fetch","ok","readme_text","text","replaceScriptInfo","loadReadme","appendInexistentScriptButtons","name","visible","eventOn","getButtonEvent"],"sourceRoot":""}