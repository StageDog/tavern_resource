{"version":3,"file":"index.js","mappings":"wFAEAA,EAAE,KACA,MAAMC,EAAUD,EAAE,2BAElB,IAAIE,GAAa,EACjBC,eAAeC,EAASC,GACtB,GAAIH,EAEF,YADAA,GAAa,GAGfG,EAAMC,2BACND,EAAME,kBAEN,MAAMC,EAAgBC,YAAYC,uBAAuBC,uBAEnDC,EAASC,UAAU,UACnBC,EAAiBD,UAAUL,GACjC,GAAIO,EAAEC,QAAQJ,EAAQE,GAGpB,OAFAZ,GAAa,OACbD,EAAQgB,QAAQ,UAIlB,MAAMC,EAAO,EAAaJ,EAAgBF,GACpCO,EAAelB,EAAQmB,KAAK,aAAaC,OACzCC,QAAeb,YAAYc,iBAC/BC,QAAQC,eACN,IAAIjB,2BAAuCW,uBAAkCO,KAAKC,UAAUZ,EAAEa,OAAOV,EAAMW,IAAUd,EAAEe,QAAQD,gBAEjIpB,YAAYsB,WAAWC,QACvB,GACA,CACEC,WAAW,EACXC,cAAe,CAAC,SAChBC,SAAU,MACVC,aAAc,KACdC,MAAM,IAILf,GAUU,IAAXA,SACIgB,cAAc9B,EAAeI,GAErCV,GAAa,EACbD,EAAQgB,QAAQ,WAbdhB,EACGmB,KAAK,UACLmB,OAAO,WACN,OAAOvC,EAAEwC,MAAMnB,SAAWb,CAC5B,GACCiC,KAAK,YAAY,EASxB,CAEAxC,EAAQ,GAAGyC,iBAAiB,SAAUtC,EAAU,CAAEuC,SAAS,IAE3D3C,EAAE4C,QAAQC,GAAG,WAAY,KACvB5C,EAAQ,GAAG6C,oBAAoB,SAAU1C","sources":["src://tavern_helper_template/src/酒馆助手/切换预设时提醒还没有保存/index.ts"],"sourcesContent":["import { detailedDiff } from 'deep-object-diff';\n\n$(() => {\n  const $select = $('#settings_preset_openai');\n\n  let allow_next = false;\n  async function onChange(event: Event) {\n    if (allow_next) {\n      allow_next = false;\n      return;\n    }\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    const preset_before = SillyTavern.chatCompletionSettings.preset_settings_openai;\n\n    const in_use = getPreset('in_use');\n    const preset_content = getPreset(preset_before);\n    if (_.isEqual(in_use, preset_content)) {\n      allow_next = true;\n      $select.trigger('change');\n      return;\n    }\n\n    const diff = detailedDiff(preset_content, in_use);\n    const preset_after = $select.find(':selected').text();\n    const result = await SillyTavern.callGenericPopup(\n      builtin.renderMarkdown(\n        `'${preset_before}' 预设存在以下内容还未保存, 是否切换成 '${preset_after}' 预设?\\n\\`\\`\\`yaml\\n${YAML.stringify(_.pickBy(diff, value => !_.isEmpty(value)))}\\n\\`\\`\\``,\n      ),\n      SillyTavern.POPUP_TYPE.CONFIRM,\n      '',\n      {\n        leftAlign: true,\n        customButtons: ['保存并切换'],\n        okButton: '仅切换',\n        cancelButton: '取消',\n        wide: true,\n      },\n    );\n\n    if (!result) {\n      $select\n        .find('option')\n        .filter(function () {\n          return $(this).text() === preset_before;\n        })\n        .prop('selected', true);\n      return;\n    }\n\n    if (result === 2) {\n      await replacePreset(preset_before, in_use);\n    }\n    allow_next = true;\n    $select.trigger('change');\n  }\n\n  $select[0].addEventListener('change', onChange, { capture: true });\n\n  $(window).on('pagehide', () => {\n    $select[0].removeEventListener('change', onChange);\n  });\n});\n"],"names":["$","$select","allow_next","async","onChange","event","stopImmediatePropagation","stopPropagation","preset_before","SillyTavern","chatCompletionSettings","preset_settings_openai","in_use","getPreset","preset_content","_","isEqual","trigger","diff","preset_after","find","text","result","callGenericPopup","builtin","renderMarkdown","YAML","stringify","pickBy","value","isEmpty","POPUP_TYPE","CONFIRM","leftAlign","customButtons","okButton","cancelButton","wide","replacePreset","filter","this","prop","addEventListener","capture","window","on","removeEventListener"],"sourceRoot":""}