{"version":3,"file":"index.js","mappings":"wFAEA,SAASA,EAAaC,EAA+BC,GACnDC,EAAEC,IAAIH,EAAU,yBAA0BC,GAC1CG,EAAE,kCACCC,OAAO,WACN,OAAOD,EAAEE,MAAMC,SAAWN,CAC5B,GACCO,KAAK,YAAY,EACtB,CAEAJ,EAAE,KACAK,QAAQC,cAAcC,0BAA2BC,MAAMC,IACrD,MAAMC,EAASC,UAAU,UACnBC,EAASD,UAAUF,EAAKI,kBAC9B,GAAIf,EAAEgB,QAAQJ,EAAQE,GACpB,OAGF,MAAMG,EAAO,EAAaH,EAAQF,GAC5BM,QAAeC,YAAYC,iBAC/BC,QAAQC,eACN,IAAIX,EAAKI,0CAA0CJ,EAAKY,gCAAgCC,KAAKC,UAAUzB,EAAE0B,OAAOT,EAAMU,IAAU3B,EAAE4B,QAAQD,gBAE5IR,YAAYU,WAAWC,QACvB,GACA,CACEC,WAAW,EACXC,SAAU,QACVC,aAAc,KACdC,cAAe,CAAC,QAChBC,MAAM,IAGV,GAAIjB,IAAWC,YAAYiB,aAAaC,SAAsB,IAAXnB,EAAnD,CAGA,GAAIA,IAAWC,YAAYiB,aAAaE,YAGtC,aAFM3B,EAAK4B,WAAW5B,EAAKI,iBAAkBJ,EAAKb,UAAU,QAC5DD,EAAac,EAAKb,SAAUa,EAAKI,kBAGnCyB,OAAOC,KAAK9B,EAAKG,QAAQ4B,QAAQC,GAAO3C,EAAE4C,MAAMjC,EAAKG,OAAQ6B,IAC7D9C,EAAac,EAAKb,SAAUa,EAAKI,iBAPjC","sources":["src://tavern_helper_template/src/酒馆助手/切换预设时提醒还没有保存/index.ts"],"sourcesContent":["import { detailedDiff } from 'deep-object-diff';\n\nfunction selectPreset(settings: Record<string, any>, preset_name: string) {\n  _.set(settings, 'preset_settings_openai', preset_name);\n  $(`#settings_preset_openai option`)\n    .filter(function () {\n      return $(this).text() === preset_name;\n    })\n    .prop('selected', true);\n}\n\n$(() => {\n  eventOn(tavern_events.OAI_PRESET_CHANGED_BEFORE, async data => {\n    const in_use = getPreset('in_use');\n    const preset = getPreset(data.presetNameBefore);\n    if (_.isEqual(in_use, preset)) {\n      return;\n    }\n\n    const diff = detailedDiff(preset, in_use);\n    const result = await SillyTavern.callGenericPopup(\n      builtin.renderMarkdown(\n        `'${data.presetNameBefore}' 预设存在以下内容还未保存, 是否切换成 '${data.presetName}' 预设?\\n\\`\\`\\`yaml\\n${YAML.stringify(_.pickBy(diff, value => !_.isEmpty(value)))}\\n\\`\\`\\``,\n      ),\n      SillyTavern.POPUP_TYPE.CONFIRM,\n      '',\n      {\n        leftAlign: true,\n        okButton: '保存并切换',\n        cancelButton: '取消',\n        customButtons: ['直接切换'],\n        wide: true,\n      },\n    );\n    if (result === SillyTavern.POPUP_RESULT.CUSTOM1 || result === 2) {\n      return;\n    }\n    if (result === SillyTavern.POPUP_RESULT.AFFIRMATIVE) {\n      await data.savePreset(data.presetNameBefore, data.settings, false);\n      selectPreset(data.settings, data.presetNameBefore);\n      return;\n    }\n    Object.keys(data.preset).forEach(key => _.unset(data.preset, key));\n    selectPreset(data.settings, data.presetNameBefore);\n  });\n});\n"],"names":["selectPreset","settings","preset_name","_","set","$","filter","this","text","prop","eventOn","tavern_events","OAI_PRESET_CHANGED_BEFORE","async","data","in_use","getPreset","preset","presetNameBefore","isEqual","diff","result","SillyTavern","callGenericPopup","builtin","renderMarkdown","presetName","YAML","stringify","pickBy","value","isEmpty","POPUP_TYPE","CONFIRM","leftAlign","okButton","cancelButton","customButtons","wide","POPUP_RESULT","CUSTOM1","AFFIRMATIVE","savePreset","Object","keys","forEach","key","unset"],"sourceRoot":""}