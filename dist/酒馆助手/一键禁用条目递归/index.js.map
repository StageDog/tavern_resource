{"version":3,"file":"index.js","mappings":"AAEAA,EAAE,KCFK,IAAwCC,KDGd,ECD/BC,8BAA8BC,cAAe,CAC3C,CACEC,KAAM,gBACNH,aAIJI,cAAc,gBAAiBC,UAC7B,MAAMC,EAAYC,eAElB,IAAIC,EAAkC,KACtC,MAAMC,EAAYV,EAAE,SAASW,OAC3B,+CACAX,EAAE,SAASW,OACTX,EAAE,2DACCW,OAAOJ,EAAUK,IAAI,CAACC,EAAUC,IAAU,IAAIC,OAAOF,EAAUG,OAAOF,MACtEG,GAAG,SAAUX,iBACZ,MAAMY,EAAQF,OAAOhB,EAAEmB,MAAMC,OAC7B,GAAc,KAAVF,EAEF,YADAT,EAAmB,MAGrB,MAAMI,EAAWN,EAAUc,GAAGC,OAAOJ,IACrCT,EAAmBI,GAAY,IACjC,WAIeU,YAAYC,iBAAiBd,EAAU,GAAIa,YAAYE,WAAWC,WACxEH,YAAYI,aAAaC,aAAgBnB,UAIlDoB,0BAA0BpB,EAAkBqB,IAChDA,EAAQC,QAAQC,IACdA,EAAMC,mBAAoB,EAC1BD,EAAME,mBAAoB,IAErBJ,IAETP,YAAYC,iBAAiB,QAAQf,WAA2Bc,YAAYE,WAAWU","sources":["src://tavern_helper_template/src/酒馆助手/一键禁用条目递归/index.ts","src://tavern_helper_template/src/酒馆助手/一键禁用条目递归/button.ts"],"sourcesContent":["import { registerDisableRecursionButton } from './button';\n\n$(() => {\n  registerDisableRecursionButton(true);\n});\n","export function registerDisableRecursionButton(visible: boolean) {\n  // @ts-expect-error 为了向后兼容性\n  appendInexistentScriptButtons(getScriptId(), [\n    {\n      name: '处理要禁用递归扫描的世界书',\n      visible,\n    },\n  ]);\n\n  eventOnButton('处理要禁用递归扫描的世界书', async () => {\n    const lorebooks = getLorebooks();\n\n    let choosen_lorebook: string | null = null;\n    const $template = $('<div>').append(\n      '<div><h4><span>请选择你要处理的世界书</span></h4></div>',\n      $('<div>').append(\n        $('<select><option value=\"\">--- None ---</option></select>')\n          .append(lorebooks.map((lorebook, index) => new Option(lorebook, String(index))))\n          .on('change', async function () {\n            const value = String($(this).val());\n            if (value === '') {\n              choosen_lorebook = null;\n              return;\n            }\n            const lorebook = lorebooks.at(Number(value));\n            choosen_lorebook = lorebook ?? null;\n          }),\n      ),\n    );\n\n    const result = await SillyTavern.callGenericPopup($template[0], SillyTavern.POPUP_TYPE.CONFIRM);\n    if (result !== SillyTavern.POPUP_RESULT.AFFIRMATIVE || !choosen_lorebook) {\n      return;\n    }\n\n    await updateLorebookEntriesWith(choosen_lorebook, entries => {\n      entries.forEach(entry => {\n        entry.exclude_recursion = true;\n        entry.prevent_recursion = true;\n      });\n      return entries;\n    });\n    SillyTavern.callGenericPopup(`已禁用 '${choosen_lorebook}' 的递归扫描`, SillyTavern.POPUP_TYPE.TEXT);\n  });\n}\n"],"names":["$","visible","appendInexistentScriptButtons","getScriptId","name","eventOnButton","async","lorebooks","getLorebooks","choosen_lorebook","$template","append","map","lorebook","index","Option","String","on","value","this","val","at","Number","SillyTavern","callGenericPopup","POPUP_TYPE","CONFIRM","POPUP_RESULT","AFFIRMATIVE","updateLorebookEntriesWith","entries","forEach","entry","exclude_recursion","prevent_recursion","TEXT"],"sourceRoot":""}