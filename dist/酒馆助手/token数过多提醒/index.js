import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';const e=z,t=e.z.object({token数阈值:e.z.number().default(8e4)}).prefault({});let n;function i(){return n||(n=t.parse(getVariables({type:'script',script_id:getScriptId()})),insertVariables(n,{type:'script',script_id:getScriptId()})),n}const r=({prompt:e})=>{setTimeout(async()=>{const t=(await Promise.all(e.map(async e=>await SillyTavern.getTokenCountAsync(e.content)))).reduce((e,t)=>e+t,0);t>i().token数阈值&&toastr.warning('<u>点击查看如何减少 token</u><br>如果不想被提醒，请通过 \'酒馆助手-工具箱\' 关闭此功能',`token 数 (${t}) 超过建议 (${i().token数阈值})`,{showDuration:1e3,escapeHtml:!1,onclick:()=>{SillyTavern.callGenericPopup('<h2>聊天 token 数过多</h2> <p>这会让 AI 变笨、抽风、重复内容, 因此建议你减少聊天 token 数, 你可以:</p> <ul> <li>自行要求 AI 总结前面的楼层, 然后在聊天框输入 <code>/hide 开始楼层号-结束楼层号</code> 隐藏前面的楼层</li> <li>去社区寻找合适的带总结功能预设、总结世界书、总结插件</li> </ul> ',SillyTavern.POPUP_TYPE.TEXT,'',{allowHorizontalScrolling:!0,leftAlign:!0})}})})};$(()=>{i(),async function(e){const t=await fetch(e);if(!t.ok)return!1;const n=await t.text();replaceScriptInfo(n)}('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/token数过多提醒/README.md'),eventOn(tavern_events.GENERATE_AFTER_DATA,_.debounce(r,1e3,{leading:!0,trailing:!1}))});