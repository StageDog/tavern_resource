const t=z,e=t.z.object({token数阈值:t.z.number().default(8e4)}).prefault({});let n;function i(){return n||(n=e.parse(getVariables({type:'script',script_id:getScriptId()})),insertVariables(n,{type:'script',script_id:getScriptId()})),n}const o=({prompt:t})=>{setTimeout(async()=>{const e=(await Promise.all(t.filter(t=>'string'==typeof t.content).map(async t=>await SillyTavern.getTokenCountAsync(t.content)))).reduce((t,e)=>t+e,0);e>i().token数阈值&&toastr.warning('<u>点击查看如何减少 token</u><br>如果不想被提醒，请关闭 \'token数过多提醒\' 脚本',`token 数 (${e}) 超过建议 (${i().token数阈值})`,{showDuration:1e3,escapeHtml:!1,onclick:()=>{SillyTavern.callGenericPopup('<h2>聊天 token 数过多</h2> <p>这会让 AI 变笨、抽风、重复内容, 因此建议你减少聊天 token 数, 你可以:</p> <ul> <li>自行要求 AI 总结前面的楼层, 然后在聊天框输入 <code>/hide 开始楼层号-结束楼层号</code> 隐藏前面的楼层</li> <li>去社区寻找合适的带总结功能预设、总结世界书、总结插件</li> </ul> ',SillyTavern.POPUP_TYPE.TEXT,'',{allowHorizontalScrolling:!0,leftAlign:!0})}})})};$(()=>{i(),async function(t){const e=await fetch(t);if(!e.ok)return!1;const n=await e.text();replaceScriptInfo(n)}('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/token数过多提醒/README.md'),eventOn(tavern_events.GENERATE_AFTER_DATA,_.debounce(o,1e3,{leading:!0,trailing:!1}))});
//# sourceMappingURL=index.js.map