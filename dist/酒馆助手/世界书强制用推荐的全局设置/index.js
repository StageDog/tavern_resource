async function e(e){$('#wiActivationSettings').find('input, select').prop('disabled',e)}$(()=>{appendInexistentScriptButtons(getScriptId(),[{name:'处理要禁用递归扫描的世界书',visible:!1}]),eventOnButton('处理要禁用递归扫描的世界书',async()=>{const e=getLorebooks();let n=null;const t=$('<div>').append('<div><h4><span>请选择你要处理的世界书</span></h4></div>',$('<div>').append($('<select><option value="">--- None ---</option></select>').append(e.map((e,n)=>new Option(e,String(n)))).on('change',async function(){const t=String($(this).val());if(''===t)return void(n=null);const i=e.at(Number(t));n=i??null})));await SillyTavern.callGenericPopup(t[0],SillyTavern.POPUP_TYPE.CONFIRM)===SillyTavern.POPUP_RESULT.AFFIRMATIVE&&n&&(await updateLorebookEntriesWith(n,e=>(e.forEach(e=>{e.exclude_recursion=!0,e.prevent_recursion=!0}),e)),SillyTavern.callGenericPopup(`已禁用 '${n}' 的递归扫描`,SillyTavern.POPUP_TYPE.TEXT))}),async function(){setLorebookSettings({scan_depth:2,context_percentage:100,budget_cap:0,min_activations:0,max_depth:0,max_recursion_steps:0,insertion_strategy:'character_first',include_names:!1,recursive:!0,case_sensitive:!1,match_whole_words:!1,use_group_scoring:!1,overflow_alert:!1})}(),e(!0)}),$(window).on('unload',()=>e(!1));