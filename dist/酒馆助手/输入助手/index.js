import{compare as e}from'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import{createPinia as t,defineStore as n,storeToRefs as o}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var r={8:(e,t,n)=>{var o=n(46);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,n(424).A)('d6758258',o,!1,{ssrId:!0})},46:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var o=n(790),r=n.n(o),a=n(54),i=n.n(a)()(r());i.push([e.id,'.input_helper_block[data-v-2f53e243]{margin-bottom:10px}.input_helper_block label[data-v-2f53e243]{margin-left:5px}.integrated_button_settings[data-v-2f53e243]{display:flex;flex-direction:column;gap:5px;margin-top:5px}.integrated-button-row[data-v-2f53e243]{display:flex;align-items:center;padding:5px 8px;border:1px solid var(--SmartThemeBorderColor);border-radius:5px;background-color:rgba(30,30,30,.3);cursor:default;transition:background-color .2s,transform .1s}.integrated-button-row input[type=checkbox][data-v-2f53e243]{margin-right:8px}.integrated-button-row label[data-v-2f53e243]{flex-grow:1;margin-right:10px}.integrated-button-row.sortable-helper[data-v-2f53e243]{background-color:rgba(50,50,80,.6);transform:scale(1.02);box-shadow:0 4px 8px rgba(0,0,0,.3)}.integrated-button-row.sortable-placeholder[data-v-2f53e243]{visibility:visible !important;background-color:rgba(30,30,50,.3);border:1px dashed var(--SmartThemeBorderColor);height:38px}.button-preview[data-v-2f53e243]{width:40px;height:25px;display:flex;align-items:center;justify-content:center;background-color:var(--SmartThemeBlurTintColor);border:1px solid var(--SmartThemeBorderColor);border-radius:5px;margin-right:8px;filter:grayscale(0.5);font-family:var(--mainFontFamily)}.note[data-v-2f53e243]{font-size:12px;color:var(--SmartThemeEmColor);margin-bottom:8px;font-style:italic}.edit-button[data-v-2f53e243],.delete-button[data-v-2f53e243]{background:none;border:none;font-size:16px;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;margin-right:5px;opacity:.7;transition:opacity .2s}.edit-button[data-v-2f53e243]:hover,.delete-button[data-v-2f53e243]:hover{opacity:1}.delete-button[data-v-2f53e243]{color:rgba(255,80,80,.9)}.add_button[data-v-2f53e243]{width:100%;margin:10px 0;padding:8px}.drag-handle[data-v-2f53e243]{cursor:grab;margin-right:8px;color:var(--SmartThemeEmColor);opacity:.6;transition:opacity .3s}.drag-handle[data-v-2f53e243]:hover{opacity:1}.drag-handle[data-v-2f53e243]:active{cursor:grabbing}.modal-overlay[data-v-2f53e243]{position:fixed;inset:0;width:100%;height:100vh;background-color:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:9999}.modal-content[data-v-2f53e243]{background-color:var(--SmartThemeBlurTintColor);border:1px solid var(--SmartThemeBorderColor);border-radius:8px;padding:20px;min-width:300px;max-width:90vw;max-height:90vh;overflow-y:auto}.modal-content h3[data-v-2f53e243]{margin:0 0 15px 0;color:var(--SmartThemeBodyColor)}.form-group[data-v-2f53e243]{margin-bottom:15px;display:flex;align-items:center;gap:10px}.form-group label[data-v-2f53e243]{flex-shrink:0;min-width:90px;color:var(--SmartThemeBodyColor);font-weight:500}.form-group input[type=text][data-v-2f53e243],.form-group input[type=number][data-v-2f53e243]{flex:1;padding:8px 12px;border:1px solid var(--SmartThemeBorderColor);border-radius:4px;background-color:var(--SmartThemeBlurTintColor);color:var(--SmartThemeBodyColor);font-size:14px}.form-group input[type=text][data-v-2f53e243]:focus,.form-group input[type=number][data-v-2f53e243]:focus{outline:none;border-color:var(--SmartThemeEmColor)}.form-group input[type=checkbox][data-v-2f53e243]{margin-right:8px;transform:scale(1.2)}.form-group select[data-v-2f53e243]{flex:1;padding:8px 12px;border:1px solid var(--SmartThemeBorderColor);border-radius:4px;background-color:var(--SmartThemeBlurTintColor);color:var(--SmartThemeBodyColor);font-size:14px;cursor:pointer}.form-group select[data-v-2f53e243]:focus{outline:none;border-color:var(--SmartThemeEmColor)}.form-group select option[data-v-2f53e243]{background-color:var(--SmartThemeBlurTintColor);color:var(--SmartThemeBodyColor)}.form-group .cursor-position-wrapper[data-v-2f53e243]{display:flex;gap:8px;align-items:center}.form-group .cursor-position-wrapper select[data-v-2f53e243]{flex:1;min-width:0}.form-group .cursor-position-wrapper .custom-cursor-input[data-v-2f53e243]{width:100px;flex-shrink:0}.modal-buttons[data-v-2f53e243]{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}.modal-buttons button[data-v-2f53e243]{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color .2s}.modal-buttons button.button-cancel[data-v-2f53e243]{background-color:rgba(0,0,0,0);border:1px solid var(--SmartThemeBorderColor);color:var(--SmartThemeBodyColor)}.modal-buttons button.button-cancel[data-v-2f53e243]:hover{background-color:hsla(0,0%,100%,.1)}.modal-buttons button.button-save[data-v-2f53e243]{background-color:rgba(0,0,0,0);border:1px solid var(--SmartThemeBorderColor);color:var(--SmartThemeBodyColor)}.modal-buttons button.button-save[data-v-2f53e243]:hover{background-color:hsla(0,0%,100%,.1)}','',{version:3,sources:['webpack://./src/酒馆助手/输入助手/panel.vue'],names:[],mappings:'AAYA,qCACE,kBAAA,CAEA,2CACE,eAAA,CAIJ,6CACE,YAAA,CACA,qBAAA,CACA,OAAA,CACA,cAAA,CAGF,wCACE,YAAA,CACA,kBAAA,CACA,eAAA,CACA,6CAAA,CACA,iBAtBoB,CAuBpB,kCAAA,CACA,cAAA,CACA,6CACE,CAGF,6DACE,gBAAA,CAGF,8CACE,WAAA,CACA,iBAAA,CAGF,wDACE,kCAAA,CACA,qBAAA,CACA,mCAAA,CAGF,6DACE,6BAAA,CACA,kCAAA,CACA,8CAAA,CACA,WAAA,CAIJ,iCACE,UAAA,CACA,WAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,+CAlEQ,CAmER,6CAAA,CACA,iBA5DoB,CA6DpB,gBAAA,CACA,qBAAA,CACA,iCApEU,CAuEZ,uBACE,cAAA,CACA,8BA1ES,CA2ET,iBAAA,CACA,iBAAA,CAGF,8DAEE,eAAA,CACA,WAAA,CACA,cAAA,CACA,cAAA,CACA,SAAA,CACA,UAlFY,CAmFZ,WAnFY,CAoFZ,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,gBAAA,CACA,UAAA,CACA,sBAAA,CAEA,0EACE,SAAA,CAIJ,gCACE,wBAAA,CAGF,6BACE,UAAA,CACA,aAAA,CACA,WAAA,CAGF,8BACE,WAAA,CACA,gBAAA,CACA,8BAAA,CACA,UAAA,CACA,sBAAA,CAEA,oCACE,SAAA,CAGF,qCACE,eAAA,CAIJ,gCACE,cAAA,CACA,OAAA,CACA,UAAA,CACA,YAAA,CACA,+BAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CACA,YAAA,CAGF,gCACE,+CAAA,CACA,6CAAA,CACA,iBAAA,CACA,YAAA,CACA,eAAA,CACA,cAAA,CACA,eAAA,CACA,eAAA,CAEA,mCACE,iBAAA,CACA,gCAvJS,CA2Jb,6BACE,kBAAA,CACA,YAAA,CACA,kBAAA,CACA,QAAA,CAEA,mCACE,aAAA,CACA,cAAA,CACA,gCApKS,CAqKT,eAAA,CAGF,8FAEE,MAAA,CACA,gBAAA,CACA,6CAAA,CACA,iBAvKY,CAwKZ,+CAAA,CACA,gCA/KS,CAgLT,cAAA,CAEA,0GACE,YAAA,CACA,qCAAA,CAIJ,kDACE,gBAAA,CACA,oBAAA,CAGF,oCACE,MAAA,CACA,gBAAA,CACA,6CAAA,CACA,iBA3LY,CA4LZ,+CAAA,CACA,gCAnMS,CAoMT,cAAA,CACA,cAAA,CAEA,0CACE,YAAA,CACA,qCAAA,CAGF,2CACE,+CAAA,CACA,gCA9MO,CAkNX,sDACE,YAAA,CACA,OAAA,CACA,kBAAA,CAEA,6DACE,MAAA,CACA,WAAA,CAGF,2EACE,WAAA,CACA,aAAA,CAKN,gCACE,YAAA,CACA,QAAA,CACA,wBAAA,CACA,eAAA,CAEA,uCACE,gBAAA,CACA,WAAA,CACA,iBAtOY,CAuOZ,cAAA,CACA,cAAA,CACA,+BAAA,CAEA,qDACE,8BAAA,CACA,6CAAA,CACA,gCApPO,CAsPP,2DACE,mCAAA,CAIJ,mDACE,8BAAA,CACA,6CAAA,CACA,gCA9PO,CAgQP,yDACE,mCAAA',sourcesContent:['\n$border-color: var(--SmartThemeBorderColor);\n$bg-tint: var(--SmartThemeBlurTintColor);\n$text-color: var(--SmartThemeBodyColor);\n$em-color: var(--SmartThemeEmColor);\n$main-font: var(--mainFontFamily);\n$mono-font: var(--monoFontFamily);\n\n$button-size: 24px;\n$border-radius: 4px;\n$small-border-radius: 5px;\n\n.input_helper_block {\n  margin-bottom: 10px;\n\n  label {\n    margin-left: 5px;\n  }\n}\n\n.integrated_button_settings {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n  margin-top: 5px;\n}\n\n.integrated-button-row {\n  display: flex;\n  align-items: center;\n  padding: 5px 8px;\n  border: 1px solid $border-color;\n  border-radius: $small-border-radius;\n  background-color: rgba(30, 30, 30, 0.3);\n  cursor: default;\n  transition:\n    background-color 0.2s,\n    transform 0.1s;\n\n  input[type=\'checkbox\'] {\n    margin-right: 8px;\n  }\n\n  label {\n    flex-grow: 1;\n    margin-right: 10px;\n  }\n\n  &.sortable-helper {\n    background-color: rgba(50, 50, 80, 0.6);\n    transform: scale(1.02);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);\n  }\n\n  &.sortable-placeholder {\n    visibility: visible !important;\n    background-color: rgba(30, 30, 50, 0.3);\n    border: 1px dashed $border-color;\n    height: 38px;\n  }\n}\n\n.button-preview {\n  width: 40px;\n  height: 25px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: $bg-tint;\n  border: 1px solid $border-color;\n  border-radius: $small-border-radius;\n  margin-right: 8px;\n  filter: grayscale(0.5);\n  font-family: $main-font;\n}\n\n.note {\n  font-size: 12px;\n  color: $em-color;\n  margin-bottom: 8px;\n  font-style: italic;\n}\n\n.edit-button,\n.delete-button {\n  background: none;\n  border: none;\n  font-size: 16px;\n  cursor: pointer;\n  padding: 0;\n  width: $button-size;\n  height: $button-size;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 5px;\n  opacity: 0.7;\n  transition: opacity 0.2s;\n\n  &:hover {\n    opacity: 1;\n  }\n}\n\n.delete-button {\n  color: rgba(255, 80, 80, 0.9);\n}\n\n.add_button {\n  width: 100%;\n  margin: 10px 0;\n  padding: 8px;\n}\n\n.drag-handle {\n  cursor: grab;\n  margin-right: 8px;\n  color: var(--SmartThemeEmColor);\n  opacity: 0.6;\n  transition: opacity 0.3s;\n\n  &:hover {\n    opacity: 1;\n  }\n\n  &:active {\n    cursor: grabbing;\n  }\n}\n\n.modal-overlay {\n  position: fixed;\n  inset: 0;\n  width: 100%;\n  height: 100vh;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 9999;\n}\n\n.modal-content {\n  background-color: var(--SmartThemeBlurTintColor);\n  border: 1px solid $border-color;\n  border-radius: 8px;\n  padding: 20px;\n  min-width: 300px;\n  max-width: 90vw;\n  max-height: 90vh;\n  overflow-y: auto;\n\n  h3 {\n    margin: 0 0 15px 0;\n    color: $text-color;\n  }\n}\n\n.form-group {\n  margin-bottom: 15px;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n\n  label {\n    flex-shrink: 0;\n    min-width: 90px;\n    color: $text-color;\n    font-weight: 500;\n  }\n\n  input[type=\'text\'],\n  input[type=\'number\'] {\n    flex: 1;\n    padding: 8px 12px;\n    border: 1px solid $border-color;\n    border-radius: $border-radius;\n    background-color: var(--SmartThemeBlurTintColor);\n    color: $text-color;\n    font-size: 14px;\n\n    &:focus {\n      outline: none;\n      border-color: var(--SmartThemeEmColor);\n    }\n  }\n\n  input[type=\'checkbox\'] {\n    margin-right: 8px;\n    transform: scale(1.2);\n  }\n\n  select {\n    flex: 1;\n    padding: 8px 12px;\n    border: 1px solid $border-color;\n    border-radius: $border-radius;\n    background-color: var(--SmartThemeBlurTintColor);\n    color: $text-color;\n    font-size: 14px;\n    cursor: pointer;\n\n    &:focus {\n      outline: none;\n      border-color: var(--SmartThemeEmColor);\n    }\n\n    option {\n      background-color: var(--SmartThemeBlurTintColor);\n      color: $text-color;\n    }\n  }\n\n  .cursor-position-wrapper {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n\n    select {\n      flex: 1;\n      min-width: 0;\n    }\n\n    .custom-cursor-input {\n      width: 100px;\n      flex-shrink: 0;\n    }\n  }\n}\n\n.modal-buttons {\n  display: flex;\n  gap: 10px;\n  justify-content: flex-end;\n  margin-top: 20px;\n\n  button {\n    padding: 8px 16px;\n    border: none;\n    border-radius: $border-radius;\n    cursor: pointer;\n    font-size: 14px;\n    transition: background-color 0.2s;\n\n    &.button-cancel {\n      background-color: transparent;\n      border: 1px solid $border-color;\n      color: $text-color;\n\n      &:hover {\n        background-color: rgba(255, 255, 255, 0.1);\n      }\n    }\n\n    &.button-save {\n      background-color: transparent;\n      border: 1px solid $border-color;\n      color: $text-color;\n\n      &:hover {\n        background-color: rgba(255, 255, 255, 0.1);\n      }\n    }\n  }\n}\n'],sourceRoot:''}]);const l=i},54:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n='',o=void 0!==t[5];return t[4]&&(n+='@supports ('.concat(t[4],') {')),t[2]&&(n+='@media '.concat(t[2],' {')),o&&(n+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),n+=e(t),o&&(n+='}'),t[2]&&(n+='}'),t[4]&&(n+='}'),n}).join('')},t.i=function(e,n,o,r,a){'string'==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(i[s]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);o&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=a),n&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=n):c[2]=n),r&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=r):c[4]=''.concat(r)),t.push(c))}},t}},424:(e,t,n)=>{function o(e,t){for(var n=[],o={},r=0;r<t.length;r++){var a=t[r],i=a[0],l={id:e+':'+r,css:a[1],media:a[2],sourceMap:a[3]};o[i]?o[i].parts.push(l):n.push(o[i]={id:i,parts:[l]})}return n}n.d(t,{A:()=>m});var r='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!r)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var a={},i=r&&(document.head||document.getElementsByTagName('head')[0]),l=null,s=0,d=!1,c=function(){},A=null,p='data-vue-ssr-id',u='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,t,n,r){d=n,A=r||{};var i=o(e,t);return C(i),function(t){for(var n=[],r=0;r<i.length;r++){var l=i[r];(s=a[l.id]).refs--,n.push(s)}t?C(i=o(e,t)):i=[];for(r=0;r<n.length;r++){var s;if(0===(s=n[r]).refs){for(var d=0;d<s.parts.length;d++)s.parts[d]();delete a[s.id]}}}}function C(e){for(var t=0;t<e.length;t++){var n=e[t],o=a[n.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](n.parts[r]);for(;r<n.parts.length;r++)o.parts.push(g(n.parts[r]));o.parts.length>n.parts.length&&(o.parts.length=n.parts.length)}else{var i=[];for(r=0;r<n.parts.length;r++)i.push(g(n.parts[r]));a[n.id]={id:n.id,refs:1,parts:i}}}}function f(){var e=document.createElement('style');return e.type='text/css',i.appendChild(e),e}function g(e){var t,n,o=document.querySelector('style['+p+'~="'+e.id+'"]');if(o){if(d)return c;o.parentNode.removeChild(o)}if(u){var r=s++;o=l||(l=f()),t=h.bind(null,o,r,!1),n=h.bind(null,o,r,!0)}else o=f(),t=x.bind(null,o),n=function(){o.parentNode.removeChild(o)};return t(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;t(e=o)}else n()}}var v,b=(v=[],function(e,t){return v[e]=t,v.filter(Boolean).join('\n')});function h(e,t,n,o){var r=n?'':o.css;if(e.styleSheet)e.styleSheet.cssText=b(t,r);else{var a=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function x(e,t){var n=t.css,o=t.media,r=t.sourceMap;if(o&&e.setAttribute('media',o),A.ssrId&&e.setAttribute(p,t.id),r&&(n+='\n/*# sourceURL='+r.sources[0]+' */',n+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+' */'),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},790:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if('function'==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(o),a='/*# '.concat(r,' */');return[t].concat([a]).join('\n')}return[t].join('\n')}},800:(e,t)=>{t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,o]of t)n[e]=o;return n}}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={id:e,exports:{}};return r[e](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const l=Vue;const s=z,d=s.z.object({name:s.z.string(),enable:s.z.boolean(),description:s.z.string(),content:s.z.string(),cursor_position:s.z.number(),insert_position:s.z.enum(['prepend','as_is','append','newline'])}),c=s.z.object({buttons:s.z.array(d).default([{name:'**',enable:!0,description:'星号之间',content:'**',cursor_position:1,insert_position:'as_is'},{name:'“”',enable:!0,description:'双引号之间',content:'“”',cursor_position:1,insert_position:'as_is'},{name:'（）',enable:!0,description:'圆括号之间',content:'（）',cursor_position:1,insert_position:'as_is'},{name:'「」',enable:!0,description:'直角单开引号之间',content:'「」',cursor_position:1,insert_position:'as_is'},{name:'『』',enable:!0,description:'直角双开引号之间',content:'『』',cursor_position:1,insert_position:'as_is'},{name:'《》',enable:!0,description:'书名号之间',content:'《》',cursor_position:1,insert_position:'as_is'},{name:'⇤',enable:!0,description:'移到行首',content:'',cursor_position:0,insert_position:'prepend'},{name:'⇥',enable:!0,description:'移到行尾',content:'',cursor_position:0,insert_position:'append'},{name:'⏎',enable:!0,description:'换行',content:'\n',cursor_position:0,insert_position:'append'},{name:'user',enable:!0,description:'用户标记',content:'<user>',cursor_position:6,insert_position:'as_is'},{name:'char',enable:!0,description:'角色标记',content:'<char>',cursor_position:6,insert_position:'as_is'}])}),A=n('settings',()=>{const e=(0,l.ref)(c.parse(getVariables({type:'script',script_id:getScriptId()})));return(0,l.watchEffect)(()=>{replaceVariables(_.cloneDeep(e.value),{type:'script',script_id:getScriptId()})}),{settings:e}}),p={class:'inline-drawer'},u={class:'inline-drawer-content'},m={class:'integrated_button_settings'},C=['data-original-index'],f=['onUpdate:modelValue'],g={class:'button-preview'},v=['for'],b=['data-index','onClick'],h=['data-index','onClick'],x={class:'form-group'},E={class:'form-group'},y={class:'form-group'},B={class:'form-group'},k={class:'form-group'},w={key:1,class:'cursor-position-wrapper'},S=(0,l.defineComponent)({__name:'panel',setup(e){const{settings:t}=o(A()),n=(0,l.ref)({show:!1,title:'',editing_index:-1,form_data:{name:'',description:'',content:'',insert_position:'as_is',cursor_position:0},cursor_position_type:'middle'}),r=$('body')[0];function a(){(0,l.nextTick)(()=>{$('.integrated-button-row').each(function(e){$(this).attr('data-original-index',e),$(this).find('.edit-button, .delete-button').attr('data-index',e)})})}function i(){n.value.title='添加按钮',n.value.editing_index=-1,n.value.form_data={name:'',description:'',content:'',cursor_position:0,insert_position:'as_is'},n.value.cursor_position_type='end',n.value.show=!0}function s(){n.value.show=!1}function d(){if(''===n.value.form_data.name)return;const e=(()=>{switch(n.value.cursor_position_type){case'begin':default:return 0;case'middle':return Math.floor(n.value.form_data.content.length/2);case'end':return n.value.form_data.content.length;case'custom':return _.clamp(n.value.form_data.cursor_position,0,n.value.form_data.content.length)}})(),o={name:n.value.form_data.name,enable:t.value.buttons.at(n.value.editing_index)?.enable??!0,description:n.value.form_data.description,content:n.value.form_data.content,insert_position:n.value.form_data.insert_position,cursor_position:e};-1===n.value.editing_index?t.value.buttons.push(o):t.value.buttons[n.value.editing_index]=o,s(),a()}return(0,l.onMounted)(()=>{(0,l.nextTick)(()=>{$('.integrated_button_settings').sortable({handle:'.drag-handle',placeholder:'sortable-placeholder',cursor:'move',tolerance:'pointer',update:function(e,n){const o=n.item,r=o.data('original-index'),i=o.index(),l=t.value.buttons[r];t.value.buttons.splice(r,1),t.value.buttons.splice(i,0,l),a()},start:function(e,t){t.helper.addClass('sortable-helper')},stop:function(e,t){t.item.removeClass('sortable-helper')}})})}),(e,o)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',p,[o[18]||(o[18]=(0,l.createElementVNode)('div',{class:'inline-drawer-toggle inline-drawer-header'},[(0,l.createElementVNode)('b',null,'输入助手'),(0,l.createElementVNode)('div',{class:'inline-drawer-icon fa-solid fa-circle-chevron-down down'})],-1)),(0,l.createElementVNode)('div',u,[o[9]||(o[9]=(0,l.createElementVNode)('div',{class:'input_helper_block'},[(0,l.createElementVNode)('b',null,'按钮管理'),(0,l.createElementVNode)('div',{class:'note'},'管理按钮显示和快捷键，点击输入框并按下键盘组合可设置快捷键'),(0,l.createElementVNode)('div',{class:'note'},'拖动排序按钮调整工具栏中的显示顺序')],-1)),(0,l.createElementVNode)('div',m,[((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)((0,l.unref)(t).buttons,(e,r)=>((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:e.name,'data-original-index':r,class:'integrated-button-row'},[o[8]||(o[8]=(0,l.createElementVNode)('span',{class:'drag-handle menu-handle'},'☰',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{'onUpdate:modelValue':t=>e.enable=t,type:'checkbox'},null,8,f),[[l.vModelCheckbox,e.enable]]),(0,l.createElementVNode)('div',g,(0,l.toDisplayString)(e.name),1),(0,l.createElementVNode)('label',{for:e.description},(0,l.toDisplayString)(e.description),9,v),(0,l.createElementVNode)('button',{class:'edit-button fa-solid fa-pencil fa-xs','data-index':r,onClick:e=>function(e){n.value.title='编辑按钮',n.value.editing_index=e;const o=t.value.buttons[e];n.value.form_data.name=o.name,n.value.form_data.description=o.description,n.value.form_data.content=o.content,n.value.form_data.cursor_position=o.cursor_position,n.value.form_data.insert_position=o.insert_position,n.value.cursor_position_type=(()=>{switch(o.cursor_position){case 0:return'begin';case Math.floor(o.content.length/2):return'middle';case o.content.length:return'end';default:return'custom'}})(),n.value.show=!0}(r)},null,8,b),(0,l.createElementVNode)('button',{class:'delete-button fa-solid fa-trash fa-xs','data-index':r,onClick:e=>async function(e){await SillyTavern.callGenericPopup(`确定要删除按钮 '${t.value.buttons[e].name}' 吗? 此操作无法撤销`,SillyTavern.POPUP_TYPE.CONFIRM)&&(t.value.buttons.splice(e,1),a())}(r)},null,8,h)],8,C))),128))]),(0,l.createElementVNode)('div',{class:'input_helper_block'},[(0,l.createElementVNode)('button',{class:'add_button menu_button',onClick:i},'添加按钮')])]),((0,l.openBlock)(),(0,l.createBlock)(l.Teleport,{to:(0,l.unref)(r)},[n.value.show?((0,l.openBlock)(),(0,l.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:s},[(0,l.createElementVNode)('div',{class:'modal-content',onClick:o[7]||(o[7]=(0,l.withModifiers)(()=>{},['stop']))},[(0,l.createElementVNode)('h3',null,(0,l.toDisplayString)(n.value.title),1),(0,l.createElementVNode)('div',x,[o[10]||(o[10]=(0,l.createElementVNode)('label',{for:'button-name'},'显示名称:',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{id:'button-name','onUpdate:modelValue':o[0]||(o[0]=e=>n.value.form_data.name=e),type:'text',placeholder:'请输入按钮名称'},null,512),[[l.vModelText,n.value.form_data.name]])]),(0,l.createElementVNode)('div',E,[o[11]||(o[11]=(0,l.createElementVNode)('label',{for:'button-description'},'描述:',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{id:'button-description','onUpdate:modelValue':o[1]||(o[1]=e=>n.value.form_data.description=e),type:'text',placeholder:'请输入按钮描述'},null,512),[[l.vModelText,n.value.form_data.description]])]),(0,l.createElementVNode)('div',y,[o[12]||(o[12]=(0,l.createElementVNode)('label',{for:'button-content'},'内容:',-1)),(0,l.withDirectives)((0,l.createElementVNode)('input',{id:'button-content','onUpdate:modelValue':o[2]||(o[2]=e=>n.value.form_data.content=e),type:'text',placeholder:'请输入按钮内容'},null,512),[[l.vModelText,n.value.form_data.content]])]),(0,l.createElementVNode)('div',B,[o[14]||(o[14]=(0,l.createElementVNode)('label',{for:'button-insert-method'},'插入位置:',-1)),(0,l.withDirectives)((0,l.createElementVNode)('select',{id:'button-insert-method','onUpdate:modelValue':o[3]||(o[3]=e=>n.value.form_data.insert_position=e)},[...o[13]||(o[13]=[(0,l.createElementVNode)('option',{value:'prepend'},'当前行开头',-1),(0,l.createElementVNode)('option',{value:'as_is'},'当前光标位置',-1),(0,l.createElementVNode)('option',{value:'append'},'当前行结尾',-1),(0,l.createElementVNode)('option',{value:'newline'},'下一行',-1)])],512),[[l.vModelSelect,n.value.form_data.insert_position]])]),(0,l.createElementVNode)('div',k,[o[17]||(o[17]=(0,l.createElementVNode)('label',{for:'button-position'},'插入后光标:',-1)),'custom'!==n.value.cursor_position_type?(0,l.withDirectives)(((0,l.openBlock)(),(0,l.createElementBlock)('select',{key:0,id:'button-position','onUpdate:modelValue':o[4]||(o[4]=e=>n.value.cursor_position_type=e)},[...o[15]||(o[15]=[(0,l.createElementVNode)('option',{value:'begin'},'内容开头',-1),(0,l.createElementVNode)('option',{value:'middle'},'内容中间',-1),(0,l.createElementVNode)('option',{value:'end'},'内容结尾',-1),(0,l.createElementVNode)('option',{value:'custom'},'自定义',-1)])],512)),[[l.vModelSelect,n.value.cursor_position_type]]):(0,l.createCommentVNode)('v-if',!0),'custom'===n.value.cursor_position_type?((0,l.openBlock)(),(0,l.createElementBlock)('div',w,[(0,l.withDirectives)((0,l.createElementVNode)('select',{id:'button-position','onUpdate:modelValue':o[5]||(o[5]=e=>n.value.cursor_position_type=e)},[...o[16]||(o[16]=[(0,l.createElementVNode)('option',{value:'begin'},'内容开头',-1),(0,l.createElementVNode)('option',{value:'middle'},'内容中间',-1),(0,l.createElementVNode)('option',{value:'end'},'内容结尾',-1),(0,l.createElementVNode)('option',{value:'custom'},'自定义',-1)])],512),[[l.vModelSelect,n.value.cursor_position_type]]),(0,l.withDirectives)((0,l.createElementVNode)('input',{id:'custom-cursor-position','onUpdate:modelValue':o[6]||(o[6]=e=>n.value.form_data.cursor_position=e),type:'number',min:'0',placeholder:'位置数字',class:'custom-cursor-input'},null,512),[[l.vModelText,n.value.form_data.cursor_position,void 0,{number:!0}]])])):(0,l.createCommentVNode)('v-if',!0)]),(0,l.createElementVNode)('div',{class:'modal-buttons'},[(0,l.createElementVNode)('button',{class:'button-cancel',onClick:s},'取消'),(0,l.createElementVNode)('button',{class:'button-save',onClick:d},'保存')])])])):(0,l.createCommentVNode)('v-if',!0)],8,['to']))]))}});i(8);const T=(0,i(800).A)(S,[['__scopeId','data-v-2f53e243']]),V=(0,l.createApp)(T);function N(){!function(){if($(`head > div[script_id="${getScriptId()}"]`).length>0)return;const e=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(e)}();const e=$('<div>').attr('script_id',getScriptId());$('#extensions_settings2').append(e),V.use(t()).mount(e[0])}function M(){V.unmount(),$(`#extensions_settings2 > div[script_id="${getScriptId()}"]`).remove(),$(`head > div[script_id="${getScriptId()}"]`).remove()}function D(e){replaceScriptButtons(e.map(e=>({name:e.name,visible:!0}))),eventClearAll(),e.forEach(e=>{eventOn(getButtonEvent(e.name),()=>function(e){const t=$('#send_textarea'),n=t.val(),{start_position:o,end_position:r}=(()=>{let o=t.prop('selectionStart'),r=t.prop('selectionEnd');switch(e.insert_position){case'prepend':{const e=n.lastIndexOf('\n',o);o=r=-1===e?0:e;break}case'as_is':break;case'append':case'newline':{const e=n.indexOf('\n',r);o=r=-1===e?n.length:e;break}}return{start_position:o,end_position:r}})();t.val(n.substring(0,o)+('newline'===e.insert_position?'\n':'')+e.content+n.substring(r)),setTimeout(()=>{const n=o+_.clamp(e.cursor_position,0,e.content.length)+('newline'===e.insert_position?1:0);t.prop('selectionStart',n),t.prop('selectionEnd',n),t.trigger('focus')})}(e))})}$(()=>{!async function(t,n){e(await getTavernHelperVersion(),t,'<')&&toastr.error(`'${n}' 需要酒馆助手版本 >= '${t}'`,'版本不兼容')}('3.4.19','输入助手'),async function(e){const t=await fetch(e);if(!t.ok)return!1;const n=await t.text();replaceScriptInfo(n)}('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/输入助手/README.md'),N();const t=A();(0,l.watchEffect)(()=>{D(t.settings.buttons.filter(e=>e.enable))})}),$(window).on('pagehide',()=>{M(),replaceScriptButtons([])});
//# sourceMappingURL=index.js.map