import{compare as e}from'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import{createPinia as t,defineStore as o,storeToRefs as n}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var r={99:(e,t,o)=>{var n=o(876);n.__esModule&&(n=n.default),'string'==typeof n&&(n=[[e.id,n,'']]),n.locals&&(e.exports=n.locals);(0,o(424).A)('ee3cdd88',n,!1,{})},226:e=>{e.exports=function(e){return e[1]}},341:(e,t)=>{t.A=(e,t)=>{const o=e.__vccOpts||e;for(const[e,n]of t)o[e]=n;return o}},424:(e,t,o)=>{function n(e,t){for(var o=[],n={},r=0;r<t.length;r++){var a=t[r],i=a[0],s={id:e+':'+r,css:a[1],media:a[2],sourceMap:a[3]};n[i]?n[i].parts.push(s):o.push(n[i]={id:i,parts:[s]})}return o}o.d(t,{A:()=>v});var r='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!r)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var a={},i=r&&(document.head||document.getElementsByTagName('head')[0]),s=null,l=0,d=!1,c=function(){},p=null,u='data-vue-ssr-id',m='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(e,t,o,r){d=o,p=r||{};var i=n(e,t);return b(i),function(t){for(var o=[],r=0;r<i.length;r++){var s=i[r];(l=a[s.id]).refs--,o.push(l)}t?b(i=n(e,t)):i=[];for(r=0;r<o.length;r++){var l;if(0===(l=o[r]).refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete a[l.id]}}}}function b(e){for(var t=0;t<e.length;t++){var o=e[t],n=a[o.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](o.parts[r]);for(;r<o.parts.length;r++)n.parts.push(g(o.parts[r]));n.parts.length>o.parts.length&&(n.parts.length=o.parts.length)}else{var i=[];for(r=0;r<o.parts.length;r++)i.push(g(o.parts[r]));a[o.id]={id:o.id,refs:1,parts:i}}}}function f(){var e=document.createElement('style');return e.type='text/css',i.appendChild(e),e}function g(e){var t,o,n=document.querySelector('style['+u+'~="'+e.id+'"]');if(n){if(d)return c;n.parentNode.removeChild(n)}if(m){var r=l++;n=s||(s=f()),t=y.bind(null,n,r,!1),o=y.bind(null,n,r,!0)}else n=f(),t=E.bind(null,n),o=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else o()}}var h,x=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join('\n')});function y(e,t,o,n){var r=o?'':n.css;if(e.styleSheet)e.styleSheet.cssText=x(t,r);else{var a=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function E(e,t){var o=t.css,n=t.media,r=t.sourceMap;if(n&&e.setAttribute('media',n),p.ssrId&&e.setAttribute(u,t.id),r&&(o+='\n/*# sourceURL='+r.sources[0]+' */',o+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+' */'),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}},480:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var o='',n=void 0!==t[5];return t[4]&&(o+='@supports ('.concat(t[4],') {')),t[2]&&(o+='@media '.concat(t[2],' {')),n&&(o+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),o+=e(t),n&&(o+='}'),t[2]&&(o+='}'),t[4]&&(o+='}'),o}).join('')},t.i=function(e,o,n,r,a){'string'==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);n&&i[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=a),o&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=o):c[2]=o),r&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=r):c[4]=''.concat(r)),t.push(c))}},t}},876:(e,t,o)=>{o.r(t),o.d(t,{default:()=>s});var n=o(226),r=o.n(n),a=o(480),i=o.n(a)()(r());i.push([e.id,'.input_helper_block[data-v-4b4e7a61]{margin-bottom:10px}.input_helper_block label[data-v-4b4e7a61]{margin-left:5px}.integrated_button_settings[data-v-4b4e7a61]{display:flex;flex-direction:column;gap:5px;margin-top:5px}.integrated-button-row[data-v-4b4e7a61]{display:flex;align-items:center;padding:5px 8px;border:1px solid var(--SmartThemeBorderColor);border-radius:5px;background-color:rgba(30,30,30,.3);cursor:default;transition:background-color .2s,transform .1s}.integrated-button-row input[type=checkbox][data-v-4b4e7a61]{margin-right:8px}.integrated-button-row label[data-v-4b4e7a61]{flex-grow:1;margin-right:10px}.integrated-button-row.sortable-helper[data-v-4b4e7a61]{background-color:rgba(50,50,80,.6);transform:scale(1.02);box-shadow:0 4px 8px rgba(0,0,0,.3)}.integrated-button-row.sortable-placeholder[data-v-4b4e7a61]{visibility:visible !important;background-color:rgba(30,30,50,.3);border:1px dashed var(--SmartThemeBorderColor);height:38px}.button-preview[data-v-4b4e7a61]{width:40px;height:25px;display:flex;align-items:center;justify-content:center;background-color:var(--SmartThemeBlurTintColor);border:1px solid var(--SmartThemeBorderColor);border-radius:5px;margin-right:8px;filter:grayscale(0.5);font-family:var(--mainFontFamily)}.note[data-v-4b4e7a61]{font-size:12px;color:var(--SmartThemeEmColor);margin-bottom:8px;font-style:italic}.edit-button[data-v-4b4e7a61],.delete-button[data-v-4b4e7a61]{background:none;border:none;font-size:16px;cursor:pointer;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;margin-right:5px;opacity:.7;transition:opacity .2s}.edit-button[data-v-4b4e7a61]:hover,.delete-button[data-v-4b4e7a61]:hover{opacity:1}.delete-button[data-v-4b4e7a61]{color:rgba(255,80,80,.9)}.add_button[data-v-4b4e7a61]{width:100%;margin:10px 0;padding:8px}.drag-handle[data-v-4b4e7a61]{cursor:grab;margin-right:8px;color:var(--SmartThemeEmColor);opacity:.6;transition:opacity .3s}.drag-handle[data-v-4b4e7a61]:hover{opacity:1}.drag-handle[data-v-4b4e7a61]:active{cursor:grabbing}.modal-overlay[data-v-4b4e7a61]{position:fixed;inset:0;width:100%;height:100vh;background-color:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:9999}.modal-content[data-v-4b4e7a61]{background-color:var(--SmartThemeBlurTintColor);border:1px solid var(--SmartThemeBorderColor);border-radius:8px;padding:20px;min-width:300px;max-width:90vw;max-height:90vh;overflow-y:auto}.modal-content h3[data-v-4b4e7a61]{margin:0 0 15px 0;color:var(--SmartThemeBodyColor)}.form-group[data-v-4b4e7a61]{margin-bottom:15px;display:flex;align-items:center;gap:10px}.form-group label[data-v-4b4e7a61]{flex-shrink:0;min-width:90px;color:var(--SmartThemeBodyColor);font-weight:500}.form-group input[type=text][data-v-4b4e7a61],.form-group input[type=number][data-v-4b4e7a61]{flex:1;padding:8px 12px;border:1px solid var(--SmartThemeBorderColor);border-radius:4px;background-color:var(--SmartThemeBlurTintColor);color:var(--SmartThemeBodyColor);font-size:14px}.form-group input[type=text][data-v-4b4e7a61]:focus,.form-group input[type=number][data-v-4b4e7a61]:focus{outline:none;border-color:var(--SmartThemeEmColor)}.form-group input[type=checkbox][data-v-4b4e7a61]{margin-right:8px;transform:scale(1.2)}.form-group select[data-v-4b4e7a61]{flex:1;padding:8px 12px;border:1px solid var(--SmartThemeBorderColor);border-radius:4px;background-color:var(--SmartThemeBlurTintColor);color:var(--SmartThemeBodyColor);font-size:14px;cursor:pointer}.form-group select[data-v-4b4e7a61]:focus{outline:none;border-color:var(--SmartThemeEmColor)}.form-group select option[data-v-4b4e7a61]{background-color:var(--SmartThemeBlurTintColor);color:var(--SmartThemeBodyColor)}.form-group .cursor-position-wrapper[data-v-4b4e7a61]{display:flex;gap:8px;align-items:center}.form-group .cursor-position-wrapper select[data-v-4b4e7a61]{flex:1;min-width:0}.form-group .cursor-position-wrapper .custom-cursor-input[data-v-4b4e7a61]{width:100px;flex-shrink:0}.modal-buttons[data-v-4b4e7a61]{display:flex;gap:10px;justify-content:flex-end;margin-top:20px}.modal-buttons button[data-v-4b4e7a61]{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color .2s}.modal-buttons button.button-cancel[data-v-4b4e7a61]{background-color:rgba(0,0,0,0);border:1px solid var(--SmartThemeBorderColor);color:var(--SmartThemeBodyColor)}.modal-buttons button.button-cancel[data-v-4b4e7a61]:hover{background-color:hsla(0,0%,100%,.1)}.modal-buttons button.button-save[data-v-4b4e7a61]{background-color:rgba(0,0,0,0);border:1px solid var(--SmartThemeBorderColor);color:var(--SmartThemeBodyColor)}.modal-buttons button.button-save[data-v-4b4e7a61]:hover{background-color:hsla(0,0%,100%,.1)}','']);const s=i}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={id:e,exports:{}};return r[e](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const s=Vue;const l=z.object({name:z.string(),enable:z.boolean(),description:z.string(),content:z.string(),cursor_position:z.number(),insert_position:z.enum(['prepend','as_is','append','newline'])}),d=z.object({buttons:z.array(l).default([{name:'**',enable:!0,description:'星号之间',content:'**',cursor_position:1,insert_position:'as_is'},{name:'“”',enable:!0,description:'双引号之间',content:'“”',cursor_position:1,insert_position:'as_is'},{name:'（）',enable:!0,description:'圆括号之间',content:'（）',cursor_position:1,insert_position:'as_is'},{name:'「」',enable:!0,description:'直角单开引号之间',content:'「」',cursor_position:1,insert_position:'as_is'},{name:'『』',enable:!0,description:'直角双开引号之间',content:'『』',cursor_position:1,insert_position:'as_is'},{name:'《》',enable:!0,description:'书名号之间',content:'《》',cursor_position:1,insert_position:'as_is'},{name:'⇤',enable:!0,description:'移到行首',content:'',cursor_position:0,insert_position:'prepend'},{name:'⇥',enable:!0,description:'移到行尾',content:'',cursor_position:0,insert_position:'append'},{name:'⏎',enable:!0,description:'换行',content:'\n',cursor_position:0,insert_position:'append'},{name:'user',enable:!0,description:'用户标记',content:'<user>',cursor_position:6,insert_position:'as_is'},{name:'char',enable:!0,description:'角色标记',content:'<char>',cursor_position:6,insert_position:'as_is'}])}),c=o('settings',()=>{const e=(0,s.ref)(d.parse(getVariables({type:'script',script_id:getScriptId()})));return(0,s.watchEffect)(()=>{replaceVariables(_.cloneDeep(e.value),{type:'script',script_id:getScriptId()})}),{settings:e}}),p={class:'inline-drawer'},u={class:'inline-drawer-content'},m={class:'integrated_button_settings'},v=['data-original-index'],b=['onUpdate:modelValue'],f={class:'button-preview'},g=['for'],h=['data-index','onClick'],x=['data-index','onClick'],y={class:'form-group'},E={class:'form-group'},w={class:'form-group'},V={class:'form-group'},N={class:'form-group'},k={key:1,class:'cursor-position-wrapper'},S=(0,s.defineComponent)({__name:'panel',setup(e){const{settings:t}=n(c()),o=(0,s.ref)({show:!1,title:'',editing_index:-1,form_data:{name:'',description:'',content:'',insert_position:'as_is',cursor_position:0},cursor_position_type:'middle'}),r=$('body')[0];function a(){(0,s.nextTick)(()=>{$('.integrated-button-row').each(function(e){$(this).attr('data-original-index',e),$(this).find('.edit-button, .delete-button').attr('data-index',e)})})}function i(){o.value.title='添加按钮',o.value.editing_index=-1,o.value.form_data={name:'',description:'',content:'',cursor_position:0,insert_position:'as_is'},o.value.cursor_position_type='end',o.value.show=!0}function l(){o.value.show=!1}function d(){if(''===o.value.form_data.name)return;const e=(()=>{switch(o.value.cursor_position_type){case'begin':default:return 0;case'middle':return Math.floor(o.value.form_data.content.length/2);case'end':return o.value.cursor_position_type.length;case'custom':return o.value.form_data.cursor_position}})(),n={name:o.value.form_data.name,enable:t.value.buttons.at(o.value.editing_index)?.enable??!0,description:o.value.form_data.description,content:o.value.form_data.content,insert_position:o.value.form_data.insert_position,cursor_position:e};-1===o.value.editing_index?t.value.buttons.push(n):t.value.buttons[o.value.editing_index]=n,l(),a()}return(0,s.onMounted)(()=>{(0,s.nextTick)(()=>{$('.integrated_button_settings').sortable({handle:'.drag-handle',placeholder:'sortable-placeholder',cursor:'move',tolerance:'pointer',update:function(e,o){const n=o.item,r=n.data('original-index');let i=n.index();const s=t.value.buttons[r];t.value.buttons.splice(r,1),t.value.buttons.splice(i,0,s),a()},start:function(e,t){t.helper.addClass('sortable-helper')},stop:function(e,t){t.item.removeClass('sortable-helper')}})})}),(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',p,[n[18]||(n[18]=(0,s.createElementVNode)('div',{class:'inline-drawer-toggle inline-drawer-header'},[(0,s.createElementVNode)('b',null,'输入助手'),(0,s.createElementVNode)('div',{class:'inline-drawer-icon fa-solid fa-circle-chevron-down down'})],-1)),(0,s.createElementVNode)('div',u,[n[9]||(n[9]=(0,s.createElementVNode)('div',{class:'input_helper_block'},[(0,s.createElementVNode)('b',null,'按钮管理'),(0,s.createElementVNode)('div',{class:'note'},'管理按钮显示和快捷键，点击输入框并按下键盘组合可设置快捷键'),(0,s.createElementVNode)('div',{class:'note'},'拖动排序按钮调整工具栏中的显示顺序')],-1)),(0,s.createElementVNode)('div',m,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)((0,s.unref)(t).buttons,(e,r)=>((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:e.name,'data-original-index':r,class:'integrated-button-row'},[n[8]||(n[8]=(0,s.createElementVNode)('span',{class:'drag-handle menu-handle'},'☰',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{'onUpdate:modelValue':t=>e.enable=t,type:'checkbox'},null,8,b),[[s.vModelCheckbox,e.enable]]),(0,s.createElementVNode)('div',f,(0,s.toDisplayString)(e.name),1),(0,s.createElementVNode)('label',{for:e.description},(0,s.toDisplayString)(e.description),9,g),(0,s.createElementVNode)('button',{class:'edit-button fa-solid fa-pencil fa-xs','data-index':r,onClick:e=>function(e){o.value.title='编辑按钮',o.value.editing_index=e;const n=t.value.buttons[e];o.value.form_data.name=n.name,o.value.form_data.description=n.description,o.value.form_data.content=n.content,o.value.form_data.cursor_position=n.cursor_position,o.value.form_data.insert_position=n.insert_position,o.value.cursor_position_type=(()=>{switch(n.cursor_position){case 0:return'begin';case Math.floor(n.content.length/2):return'middle';case n.content.length:return'end';default:return'custom'}})(),o.value.form_data.cursor_position=o.value.form_data.cursor_position,o.value.show=!0}(r)},null,8,h),(0,s.createElementVNode)('button',{class:'delete-button fa-solid fa-trash fa-xs','data-index':r,onClick:e=>async function(e){await SillyTavern.callGenericPopup(`确定要删除按钮 '${t.value.buttons[e].name}' 吗? 此操作无法撤销`,SillyTavern.POPUP_TYPE.CONFIRM)&&(t.value.buttons.splice(e,1),a())}(r)},null,8,x)],8,v))),128))]),(0,s.createElementVNode)('div',{class:'input_helper_block'},[(0,s.createElementVNode)('button',{class:'add_button menu_button',onClick:i},'添加按钮')])]),((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{to:(0,s.unref)(r)},[o.value.show?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'modal-overlay',onClick:l},[(0,s.createElementVNode)('div',{class:'modal-content',onClick:n[7]||(n[7]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createElementVNode)('h3',null,(0,s.toDisplayString)(o.value.title),1),(0,s.createElementVNode)('div',y,[n[10]||(n[10]=(0,s.createElementVNode)('label',{for:'button-name'},'显示名称:',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{id:'button-name','onUpdate:modelValue':n[0]||(n[0]=e=>o.value.form_data.name=e),type:'text',placeholder:'请输入按钮名称'},null,512),[[s.vModelText,o.value.form_data.name]])]),(0,s.createElementVNode)('div',E,[n[11]||(n[11]=(0,s.createElementVNode)('label',{for:'button-description'},'描述:',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{id:'button-description','onUpdate:modelValue':n[1]||(n[1]=e=>o.value.form_data.description=e),type:'text',placeholder:'请输入按钮描述'},null,512),[[s.vModelText,o.value.form_data.description]])]),(0,s.createElementVNode)('div',w,[n[12]||(n[12]=(0,s.createElementVNode)('label',{for:'button-content'},'内容:',-1)),(0,s.withDirectives)((0,s.createElementVNode)('input',{id:'button-content','onUpdate:modelValue':n[2]||(n[2]=e=>o.value.form_data.content=e),type:'text',placeholder:'请输入按钮内容'},null,512),[[s.vModelText,o.value.form_data.content]])]),(0,s.createElementVNode)('div',V,[n[14]||(n[14]=(0,s.createElementVNode)('label',{for:'button-insert-method'},'插入位置:',-1)),(0,s.withDirectives)((0,s.createElementVNode)('select',{id:'button-insert-method','onUpdate:modelValue':n[3]||(n[3]=e=>o.value.form_data.insert_position=e)},[...n[13]||(n[13]=[(0,s.createElementVNode)('option',{value:'prepend'},'当前行开头',-1),(0,s.createElementVNode)('option',{value:'as_is'},'当前光标位置',-1),(0,s.createElementVNode)('option',{value:'append'},'当前行结尾',-1),(0,s.createElementVNode)('option',{value:'newline'},'下一行',-1)])],512),[[s.vModelSelect,o.value.form_data.insert_position]])]),(0,s.createElementVNode)('div',N,[n[17]||(n[17]=(0,s.createElementVNode)('label',{for:'button-position'},'插入后光标:',-1)),'custom'!==o.value.cursor_position_type?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)('select',{key:0,id:'button-position','onUpdate:modelValue':n[4]||(n[4]=e=>o.value.cursor_position_type=e)},[...n[15]||(n[15]=[(0,s.createElementVNode)('option',{value:'begin'},'内容开头',-1),(0,s.createElementVNode)('option',{value:'middle'},'内容中间',-1),(0,s.createElementVNode)('option',{value:'end'},'内容结尾',-1),(0,s.createElementVNode)('option',{value:'custom'},'自定义',-1)])],512)),[[s.vModelSelect,o.value.cursor_position_type]]):(0,s.createCommentVNode)('v-if',!0),'custom'===o.value.cursor_position_type?((0,s.openBlock)(),(0,s.createElementBlock)('div',k,[(0,s.withDirectives)((0,s.createElementVNode)('select',{id:'button-position','onUpdate:modelValue':n[5]||(n[5]=e=>o.value.cursor_position_type=e)},[...n[16]||(n[16]=[(0,s.createElementVNode)('option',{value:'begin'},'内容开头',-1),(0,s.createElementVNode)('option',{value:'middle'},'内容中间',-1),(0,s.createElementVNode)('option',{value:'end'},'内容结尾',-1),(0,s.createElementVNode)('option',{value:'custom'},'自定义',-1)])],512),[[s.vModelSelect,o.value.cursor_position_type]]),(0,s.withDirectives)((0,s.createElementVNode)('input',{id:'custom-cursor-position','onUpdate:modelValue':n[6]||(n[6]=e=>o.value.form_data.cursor_position=e),type:'number',min:'0',placeholder:'位置数字',class:'custom-cursor-input'},null,512),[[s.vModelText,o.value.form_data.cursor_position,void 0,{number:!0}]])])):(0,s.createCommentVNode)('v-if',!0)]),(0,s.createElementVNode)('div',{class:'modal-buttons'},[(0,s.createElementVNode)('button',{class:'button-cancel',onClick:l},'取消'),(0,s.createElementVNode)('button',{class:'button-save',onClick:d},'保存')])])])):(0,s.createCommentVNode)('v-if',!0)],8,['to']))]))}});i(99);const C=(0,i(341).A)(S,[['__scopeId','data-v-4b4e7a61']]),T=(0,s.createApp)(C);function B(e){replaceScriptButtons(e.map(e=>({name:e.name,visible:!0}))),eventClearAll(),e.forEach(e=>{eventOn(getButtonEvent(e.name),()=>function(e){const t=$('#send_textarea'),o=t.val(),{start_position:n,end_position:r}=(()=>{let n=t.prop('selectionStart'),r=t.prop('selectionEnd');switch(e.insert_position){case'prepend':{const e=o.lastIndexOf('\n',n);n=r=-1===e?0:e;break}case'as_is':break;case'append':case'newline':{const e=o.indexOf('\n',r);n=r=-1===e?o.length:e;break}}return{start_position:n,end_position:r}})();t.val(o.substring(0,n)+('newline'===e.insert_position?'\n':'')+e.content+o.substring(r)),setTimeout(()=>{const o=n+_.clamp(e.cursor_position,0,e.content.length)+('newline'===e.insert_position?1:0);t.prop('selectionStart',o),t.prop('selectionEnd',o),t.trigger('focus')})}(e))})}$(()=>{!async function(t,o){e(await getTavernHelperVersion(),t,'<')&&toastr.error(`'${o}' 需要酒馆助手版本 >= '${t}'`,'版本不兼容')}('3.4.19','输入助手'),async function(e){const t=await fetch(e);if(!t.ok)return!1;const o=await t.text();replaceScriptInfo(o)}('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/输入助手/README.md'),$(`<div id="style-${getScriptId()}">`).append($('head > style[data-vue-ssr-id]',document)).appendTo('head'),function(){const e=$('<div>').attr('id','input_helper');$('#extensions_settings2').append(e),T.use(t()).mount(e[0]),T.onUnmount(()=>{e.remove()})}();const o=c();(0,s.watchEffect)(()=>{B(o.settings.buttons.filter(e=>e.enable))})}),$(window).on('pagehide',()=>{$(`head > div[id="style-${getScriptId()}"]`).remove(),T.unmount(),replaceScriptButtons([])});