{"version":3,"file":"index.js","mappings":"AAAA,MAAM,EAA+BA,ECA/BC,EAAW,EAAAD,EAAEE,OAAO,CACtB,OAAQ,EAAAF,EAAEG,SAASC,QAAQ,OAE/B,IAAIC,EAwBJC,eAAeC,EAAeC,GAC1B,IAAKA,GAAkC,IAArBA,EAAUC,OACxB,OAEJ,MAAMC,EAA4B,IAArBF,EAAUC,OAAeD,EAAU,GAAGE,KAAOC,YAAYC,CAAE,GAAGJ,EAAUC,wBAC/EI,EAAO,IAAIL,GAAWM,OAAO,CAACC,EAAKC,IAASD,EAAMC,EAAKH,KAAM,GAC7DI,EAAQ,IAAIT,GAAWU,IAAIC,GAAKA,EAAET,MAAMU,KAAK,MACnDC,EAAE,yBAAyBC,KAAKZ,GAAMa,KAAK,QAASN,GACpDI,EAAE,yBAAyBC,KAxB/B,SAAyBE,EAAOC,GAAK,EAAOC,EAAK,GAC7C,MAAMC,EAASF,EAAK,IAAO,KAC3B,GAAIG,KAAKC,IAAIL,GAASG,EAClB,OAAOH,EAAQ,KAEnB,MAAMM,EAAQL,EACR,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAC3C,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACxD,IAAIM,GAAK,EACT,MAAMC,EAAI,IAAMN,EAChB,GACIF,GAASG,IACPI,QACGH,KAAKK,MAAML,KAAKC,IAAIL,GAASQ,GAAKA,GAAKL,GAAUI,EAAID,EAAMrB,OAAS,GAC7E,OAAOe,EAAMU,QAAQR,GAAM,IAAMI,EAAMC,EAC3C,CASoCI,CAAgBtB,IAAOU,KAAK,QAASV,GACrEQ,EAAE,cAAce,YAAY,eACNzB,YAAY0B,oBAE9BC,UAAUC,cAAcC,aAAc,KAClCnB,EAAE,cAAcoB,QAAQ,UAGpC,CACA,MAAMC,EAAQ,IAAIC,IAqBlB,SAASC,EAAeC,GACpB,MAAMC,EAAiBD,EAAME,eACK,oBAA7BD,EAAeE,WAAgE,eAA7BF,EAAeE,YAClEF,EAAeG,MACfH,EAAeG,KAAKxC,QAhEnBJ,IACDA,EAAWJ,EAASiD,MAAMC,aAAa,CAAEC,KAAM,SAAUC,UAAWC,iBACpEC,gBAAgBlD,EAAU,CAAE+C,KAAM,SAAUC,UAAWC,iBAEpDjD,GA4DyC,SAC5CyC,EAAeU,iBACfV,EAAeW,kBA1BvB,SAA+BnC,GAC3B,IAAIN,EACA0B,EAAMgB,IAAIpC,GACVN,EAAO0B,EAAMiB,IAAIrC,IAGjBN,EAAO,IAAI4C,KAAK,CAACtC,GAAO,cACxBoB,EAAMmB,IAAIvC,EAAMN,IAEpB,MAAM8C,EAAmBzC,EAAE,oBACrB0C,EAAgB,IAAIC,aAC1BC,EAAEC,MAAMC,KAAKL,EAAiBM,KAAK,WAC9BC,OAAOrD,GACPsD,OAAOtD,GAAQ,GAAGA,EAAKuD,gBAAgBvD,EAAKN,QAAQM,EAAKH,QAAQG,EAAKoC,QACtEoB,QAAQxD,IACT+C,EAAcU,MAAMC,IAAI1D,KAE5B8C,EAAiBM,KAAK,QAASL,EAAcrB,OAC7CnC,EAAewD,EAAcrB,MACjC,CAQQiC,CAAsB7B,EAAeG,MAE7C,CACA5B,EAAE,KACE,MAAMuD,EAAYvD,EAAE,kBAAkBwD,QACtCD,EAAUE,GAAG,cAAelC,GAC5BvB,EAAE0D,QAAQD,GAAG,WAAY,KACrBF,EAAUI,IAAI,cAAepC","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/酒馆助手/粘贴文本转为附加文件/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","const Settings = z.object({\n    触发字数下限: z.number().default(400),\n});\nlet settings;\nfunction get_settings() {\n    if (!settings) {\n        settings = Settings.parse(getVariables({ type: 'script', script_id: getScriptId() }));\n        insertVariables(settings, { type: 'script', script_id: getScriptId() });\n    }\n    return settings;\n}\nfunction human_file_size(bytes, si = false, dp = 1) {\n    const thresh = si ? 1000 : 1024;\n    if (Math.abs(bytes) < thresh) {\n        return bytes + ' B';\n    }\n    const units = si\n        ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n        : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\n    let u = -1;\n    const r = 10 ** dp;\n    do {\n        bytes /= thresh;\n        ++u;\n    } while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1);\n    return bytes.toFixed(dp) + ' ' + units[u];\n}\nasync function on_file_attach(file_list) {\n    if (!file_list || file_list.length === 0) {\n        return;\n    }\n    const name = file_list.length === 1 ? file_list[0].name : SillyTavern.t `${file_list.length} files selected`;\n    const size = [...file_list].reduce((acc, file) => acc + file.size, 0);\n    const title = [...file_list].map(x => x.name).join('\\n');\n    $('#file_form .file_name').text(name).attr('title', title);\n    $('#file_form .file_size').text(human_file_size(size)).attr('title', size);\n    $('#file_form').removeClass('displayNone');\n    const currentChatId = SillyTavern.getCurrentChatId();\n    if (currentChatId) {\n        eventOnce(tavern_events.CHAT_CHANGED, () => {\n            $('#file_form').trigger('reset');\n        });\n    }\n}\nconst files = new Map();\nfunction attach_file_from_text(text) {\n    let file;\n    if (files.has(text)) {\n        file = files.get(text);\n    }\n    else {\n        file = new File([text], 'pasted.txt');\n        files.set(text, file);\n    }\n    const $file_form_input = $('#file_form_input');\n    const data_transfer = new DataTransfer();\n    _(Array.from($file_form_input.prop('files')))\n        .concat(file)\n        .uniqBy(file => `${file.lastModified}-${file.name}-${file.size}-${file.type}`)\n        .forEach(file => {\n        data_transfer.items.add(file);\n    });\n    $file_form_input.prop('files', data_transfer.files);\n    on_file_attach(data_transfer.files);\n}\nfunction on_beforeinput(event) {\n    const original_event = event.originalEvent;\n    if ((original_event.inputType === 'insertFromPaste' || original_event.inputType === 'insertText') &&\n        original_event.data &&\n        original_event.data.length > get_settings().触发字数下限) {\n        original_event.preventDefault();\n        original_event.stopPropagation();\n        attach_file_from_text(original_event.data);\n    }\n}\n$(() => {\n    const text_area = $('#send_textarea').first();\n    text_area.on('beforeinput', on_beforeinput);\n    $(window).on('pagehide', () => {\n        text_area.off('beforeinput', on_beforeinput);\n    });\n});\nexport {};\n"],"names":["z","Settings","object","number","default","settings","async","on_file_attach","file_list","length","name","SillyTavern","t","size","reduce","acc","file","title","map","x","join","$","text","attr","bytes","si","dp","thresh","Math","abs","units","u","r","round","toFixed","human_file_size","removeClass","getCurrentChatId","eventOnce","tavern_events","CHAT_CHANGED","trigger","files","Map","on_beforeinput","event","original_event","originalEvent","inputType","data","parse","getVariables","type","script_id","getScriptId","insertVariables","preventDefault","stopPropagation","has","get","File","set","$file_form_input","data_transfer","DataTransfer","_","Array","from","prop","concat","uniqBy","lastModified","forEach","items","add","attach_file_from_text","text_area","first","on","window","off"],"sourceRoot":""}