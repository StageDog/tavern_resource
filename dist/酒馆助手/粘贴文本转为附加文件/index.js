const e=z,t=e.z.object({触发字数下限:e.z.number().default(400)});let i;async function n(e){if(!e||0===e.length)return;const t=1===e.length?e[0].name:SillyTavern.t`${e.length} files selected`,i=[...e].reduce((e,t)=>e+t.size,0),n=[...e].map(e=>e.name).join('\n');$('#file_form .file_name').text(t).attr('title',n),$('#file_form .file_size').text(function(e,t=!1,i=1){const n=t?1e3:1024;if(Math.abs(e)<n)return e+' B';const r=t?['kB','MB','GB','TB','PB','EB','ZB','YB']:['KiB','MiB','GiB','TiB','PiB','EiB','ZiB','YiB'];let a=-1;const s=10**i;do{e/=n,++a}while(Math.round(Math.abs(e)*s)/s>=n&&a<r.length-1);return e.toFixed(i)+' '+r[a]}(i)).attr('title',i),$('#file_form').removeClass('displayNone');SillyTavern.getCurrentChatId()&&eventOnce(tavern_events.CHAT_CHANGED,()=>{$('#file_form').trigger('reset')})}const r=new Map;function a(e){const a=e.originalEvent;('insertFromPaste'===a.inputType||'insertText'===a.inputType)&&a.data&&a.data.length>(i||(i=t.parse(getVariables({type:'script',script_id:getScriptId()})),insertVariables(i,{type:'script',script_id:getScriptId()})),i).触发字数下限&&(a.preventDefault(),a.stopPropagation(),function(e){let t;r.has(e)?t=r.get(e):(t=new File([e],'pasted.txt'),r.set(e,t));const i=$('#file_form_input'),a=new DataTransfer;_(Array.from(i.prop('files'))).concat(t).uniqBy(e=>`${e.lastModified}-${e.name}-${e.size}-${e.type}`).forEach(e=>{a.items.add(e)}),i.prop('files',a.files),n(a.files)}(a.data))}$(()=>{const e=$('#send_textarea').first();e.on('beforeinput',a),$(window).on('pagehide',()=>{e.off('beforeinput',a)})});
//# sourceMappingURL=index.js.map