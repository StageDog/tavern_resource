{"version":3,"file":"index.js","mappings":"AAAA,MAAM,EAA+BA,ECC/BC,EAAW,EAAAD,EAAEE,OAAO,CACtB,GAAI,EAAAF,EAAEG,SAASC,QAAQ,IACvB,GAAI,EAAAJ,EAAEK,SAASD,QAAQ,OAErBE,EAAkB,CAAEC,KAAM,SAAUC,UAAWC,eACrD,SAASC,IACL,MAAMC,EAAWV,EAASW,MAAMC,aAAaP,IAE7C,OADAQ,gBAAgBH,EAAUL,GACnBK,CACX,CACA,IAAII,EAgBAC,EAfJC,eAAeC,IACX,IAAKR,IAAe,GAChB,OAEJ,MAAMS,QAAiBC,MAAMV,IAAe,IAC5C,IAAKS,EAASE,GAEV,YADAC,OAAOC,MAAM,QAAQb,IAAe,2BAA4B,WAGpE,MAAMc,QAAgBL,EAASM,OAC3BV,GAAOS,IACPT,EAAMS,EACNE,EAAE,cAAcC,IAAIZ,GAAK,GAAGa,cAAc,IAAIC,MAAM,UAE5D,CAEAH,EAAE,MC5BKT,eAA0Ba,GAC/B,MAAMC,QAAeX,MAAMU,GAC3B,IAAKC,EAAOV,GACV,OAAO,EAET,MAAMW,QAAoBD,EAAON,OACjCQ,kBAAkBD,EAEpB,CDqBIE,CAAW,yFACXlB,EAAKmB,YAAYjB,EAAaR,IAAe,MAEjDgB,EAAEU,QAAQC,GAAG,WAAY,KACrBC,cAActB","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/酒馆助手/实时修改css/index.ts","src://tavern_helper_template/src/util/script.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { loadReadme } from '@/util/script';\nconst Settings = z.object({\n    链接: z.string().default(''),\n    延迟: z.number().default(1000),\n});\nconst variable_option = { type: 'script', script_id: getScriptId() };\nfunction get_settings() {\n    const settings = Settings.parse(getVariables(variable_option));\n    insertVariables(settings, variable_option);\n    return settings;\n}\nlet css;\nasync function refresh_css() {\n    if (!get_settings().链接) {\n        return;\n    }\n    const response = await fetch(get_settings().链接);\n    if (!response.ok) {\n        toastr.error(`未能从 '${get_settings().链接}' 获取 css 文件, 请确认链接是否有效`, '实时修改css');\n        return;\n    }\n    const new_css = await response.text();\n    if (css != new_css) {\n        css = new_css;\n        $('#customCSS').val(css)[0].dispatchEvent(new Event('input'));\n    }\n}\nlet id;\n$(() => {\n    loadReadme('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/实时修改css/README.md');\n    id = setInterval(refresh_css, get_settings().延迟);\n});\n$(window).on('pagehide', () => {\n    clearInterval(id);\n});\n","export async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["z","Settings","object","string","default","number","variable_option","type","script_id","getScriptId","get_settings","settings","parse","getVariables","insertVariables","css","id","async","refresh_css","response","fetch","ok","toastr","error","new_css","text","$","val","dispatchEvent","Event","url","readme","readme_text","replaceScriptInfo","loadReadme","setInterval","window","on","clearInterval"],"sourceRoot":""}