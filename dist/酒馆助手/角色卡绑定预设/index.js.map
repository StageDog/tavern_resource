{"version":3,"file":"index.js","mappings":"AAAA,MAAM,EAA+BA,ECC/BC,EAAW,EAAAD,EAAEE,OAAO,CACtB,SAAU,EAAAF,EAAEG,SAASC,QAAQ,IAAMC,yBAEvCC,EAAE,MCFKC,eAA0BC,GAC/B,MAAMC,QAAeC,MAAMF,GAC3B,IAAKC,EAAOE,GACV,OAAO,EAET,MAAMC,QAAoBH,EAAOI,OACjCC,kBAAkBF,EAEpB,CDLIG,CAAW,yFACX,MAAMC,EAAWf,EAASgB,MAAMC,aAAa,CAAEC,KAAM,YACrDC,wBAAwBJ,EAAU,CAAEG,KAAM,WAC1CE,WAAWL,EAAS","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/酒馆助手/角色卡绑定预设/index.ts","src://tavern_helper_template/util/script.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { loadReadme } from '@util/script';\nconst Settings = z.object({\n    要绑定的预设名称: z.string().default(() => getLoadedPresetName()),\n});\n$(() => {\n    loadReadme('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/角色卡绑定预设/README.md');\n    const settings = Settings.parse(getVariables({ type: 'script' }));\n    insertOrAssignVariables(settings, { type: 'script' });\n    loadPreset(settings.要绑定的预设名称);\n});\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n\nexport function registerAsUniqueScript(id: string): {\n  unregister: () => void;\n  getPreferredScriptId: () => string | undefined;\n  listenPreferenceState: (callback: (perferred_script_id: string) => void) => EventOnReturn;\n} {\n  const script_id = getScriptId();\n  const path = `th_unique_check.${id}`;\n\n  const getPreferredScriptId = () => {\n    const registered_scripts = _.get(window.parent, path, new Set<string>());\n    return _($('#tavern_helper').find('div[data-script-id]').toArray())\n      .map(element => String($(element).attr('data-script-id')))\n      .filter(element => registered_scripts.has(element))\n      .last();\n  };\n\n  _.update(window.parent, path, (value: Set<string> | undefined) => {\n    if (value === undefined) {\n      return new Set([script_id]);\n    }\n    value.add(script_id);\n    return value;\n  });\n  eventEmit(path, getPreferredScriptId());\n\n  return {\n    unregister: () => {\n      _.update(window.parent, path, (value: Set<string> | undefined) => {\n        if (value !== undefined) {\n          value.delete(script_id);\n        }\n        return value;\n      });\n      eventEmit(path, getPreferredScriptId());\n    },\n    getPreferredScriptId,\n    listenPreferenceState: (callback: (enabled_script_id: string) => void) => eventOn(path, callback),\n  };\n}\n"],"names":["z","Settings","object","string","default","getLoadedPresetName","$","async","url","readme","fetch","ok","readme_text","text","replaceScriptInfo","loadReadme","settings","parse","getVariables","type","insertOrAssignVariables","loadPreset"],"sourceRoot":""}