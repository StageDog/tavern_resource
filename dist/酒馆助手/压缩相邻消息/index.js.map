{"version":3,"file":"index.js","mappings":"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","sources":["webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue?e159","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue?8669","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue?6406","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue?68a0","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue?333d","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue?1023","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/store.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue?a6cc","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue?1c52","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Item.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Item.vue?5cb3","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue?ffbb","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Select.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Select.vue?2c77","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/chat_history.md?3990","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/ChatHistory.vue?c9aa","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/ChatHistory.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/delimiter.md?5e86","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Delimiter.vue?0cae","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Delimiter.vue","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Checkbox.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Checkbox.vue?8b80","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/depth_injection.md?c27e","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/DepthInjection.vue?8ab4","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/DepthInjection.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/stop.md?c541","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Stop.vue?ec2e","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Stop.vue","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Panel.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Panel.vue?ffb1","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/index.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/squash.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/index.ts"],"sourcesContent":["/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"6afbab2b\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"f023d2a2\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"60f1d5b8\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-880.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.TR-section[data-v-399ec098]{border:1px solid var(--SmartThemeBorderColor,rgba(45,45,45,1));border-radius:10px;padding:0.6rem 0.75rem;gap:0.45rem;background-color:rgba(0,0,0,0.08);background-color:color-mix(in srgb,var(--SmartThemeBlurTintColor,rgba(31,31,31,1)) 75%,transparent)}.TR-section__content[data-v-399ec098]{gap:0.5rem}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/酒馆助手/压缩相邻消息/panel/component/Section.vue\"],\"names\":[],\"mappings\":\"AAmBA,6BACE,8DAAmE,CACnE,kBAAmB,CACnB,sBAAuB,CACvB,WAAY,CACZ,iCAAqC,CACrC,mGACF,CAEA,sCACE,UACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"TR-section flex-container flexFlowColumn\\\">\\n    <div class=\\\"TR-section__title\\\">\\n      <strong>\\n        <span>{{ label }}</span>\\n      </strong>\\n      <slot name=\\\"label-suffix\\\" />\\n    </div>\\n    <div class=\\\"TR-section__content flex-container flexFlowColumn\\\">\\n      <slot />\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\ndefineProps<{ label: string }>();\\n</script>\\n\\n<style scoped>\\n.TR-section {\\n  border: 1px solid var(--SmartThemeBorderColor, rgba(45, 45, 45, 1));\\n  border-radius: 10px;\\n  padding: 0.6rem 0.75rem;\\n  gap: 0.45rem;\\n  background-color: rgba(0, 0, 0, 0.08);\\n  background-color: color-mix(in srgb, var(--SmartThemeBlurTintColor, rgba(31, 31, 31, 1)) 75%, transparent);\\n}\\n\\n.TR-section__content {\\n  gap: 0.5rem;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.TR-help-icon[data-v-43141e14]{cursor:pointer}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue\"],\"names\":[],\"mappings\":\"AAsBA,+BACE,cACF\",\"sourcesContent\":[\"<template>\\n  <i\\n    class=\\\"fa-solid fa-circle-question fa-sm note-link-span TR-help-icon\\\"\\n    role=\\\"button\\\"\\n    tabindex=\\\"0\\\"\\n    @click=\\\"showHelpPopup(help)\\\"\\n  />\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\ndefineProps<{ help: string }>();\\n\\nfunction showHelpPopup(content: string) {\\n  SillyTavern.callGenericPopup(content, SillyTavern.POPUP_TYPE.TEXT, '', {\\n    allowVerticalScrolling: true,\\n    leftAlign: true,\\n    wide: true,\\n  });\\n}\\n</script>\\n\\n<style scoped>\\n.TR-help-icon {\\n  cursor: pointer;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.TR-field[data-v-75b81b74]{padding:0.45rem 0.6rem;gap:0.25rem;border:1px solid color-mix(in srgb,var(--SmartThemeBorderColor,rgba(45,45,45,1)) 35%,transparent);border-radius:10px;background-color:color-mix(in srgb,var(--SmartThemeBlurTintColor,rgba(31,31,31,1)) 55%,transparent)}.TR-field__label[data-v-75b81b74]{display:inline-flex;align-items:center;gap:0.35rem;font-weight:600;opacity:0.95}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/酒馆助手/压缩相邻消息/panel/component/Field.vue\"],\"names\":[],\"mappings\":\"AAeA,2BACE,sBAAuB,CACvB,WAAY,CACZ,iGAAwG,CACxG,kBAAmB,CACnB,mGACF,CAEA,kCACE,mBAAoB,CACpB,kBAAmB,CACnB,WAAY,CACZ,eAAgB,CAChB,YACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"TR-field flex-container flexFlowColumn\\\">\\n    <label class=\\\"TR-field__label\\\">\\n      <span>{{ label }}</span>\\n      <slot name=\\\"label-suffix\\\" />\\n    </label>\\n    <slot />\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\ndefineProps<{ label: string }>();\\n</script>\\n\\n<style scoped>\\n.TR-field {\\n  padding: 0.45rem 0.6rem;\\n  gap: 0.25rem;\\n  border: 1px solid color-mix(in srgb, var(--SmartThemeBorderColor, rgba(45, 45, 45, 1)) 35%, transparent);\\n  border-radius: 10px;\\n  background-color: color-mix(in srgb, var(--SmartThemeBlurTintColor, rgba(31, 31, 31, 1)) 55%, transparent);\\n}\\n\\n.TR-field__label {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 0.35rem;\\n  font-weight: 600;\\n  opacity: 0.95;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { compare } from 'compare-versions';\nimport JSON5 from 'json5';\nimport { jsonrepair } from 'jsonrepair';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string, replace_macros?: boolean): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  const makeRegex = (pattern: string, flags: string) => {\n    if (replace_macros) {\n      pattern = substitudeMacros(pattern);\n    }\n    return new RegExp(pattern, flags);\n  };\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return makeRegex(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return makeRegex(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return makeRegex(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n\nexport function literalYamlify(value: any) {\n  return YAML.stringify(value, { blockQuote: 'literal' });\n}\n\nexport function parseString(content: string): any {\n  let parsed: unknown;\n  try {\n    parsed = YAML.parseDocument(content, { merge: true }).toJS();\n  } catch (yaml_error) {\n    try {\n      // eslint-disable-next-line import-x/no-named-as-default-member\n      parsed = JSON5.parse(content);\n    } catch (json5_error) {\n      try {\n        parsed = JSON.parse(jsonrepair(content));\n      } catch (json_error) {\n        const toError = (error: unknown) => (error instanceof Error ? error.message : String(error));\n        throw new Error(\n          literalYamlify({\n            ['要解析的字符串不是有效的 YAML/JSON 格式']: {\n              字符串内容: content,\n              YAML错误信息: toError(yaml_error),\n              JSON5错误信息: toError(json5_error),\n              尝试修复JSON时的错误信息: toError(json_error),\n            },\n          }),\n        );\n      }\n    }\n  }\n  return parsed;\n}\n\nexport function getComplementString(string: string) {\n  const encoder = new TextEncoder();\n  const bytes = encoder.encode(string);\n\n  const complemented = new Uint8Array(bytes.length);\n  for (let i = 0; i < bytes.length; i++) {\n    complemented[i] = 0xff - bytes[i];\n  }\n\n  let hex = '';\n  for (let i = 0; i < complemented.length; i++) {\n    const h = complemented[i].toString(16).padStart(2, '0');\n    hex += h;\n  }\n  return hex;\n}\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n\nexport function registerAsUniqueScript(id: string): {\n  unregister: () => void;\n  getPreferredScriptId: () => string | undefined;\n  listenPreferenceState: (callback: (perferred_script_id: string) => void) => EventOnReturn;\n} {\n  const script_id = getScriptId();\n  const path = `th_unique_check.${id}`;\n\n  const getPreferredScriptId = () => {\n    const registered_scripts = _.get(window.parent, path, new Set<string>());\n    return _($('#tavern_helper').find('div[data-script-id]').toArray())\n      .map(element => String($(element).attr('data-script-id')))\n      .filter(element => registered_scripts.has(element))\n      .last();\n  };\n\n  _.update(window.parent, path, (value: Set<string> | undefined) => {\n    if (value === undefined) {\n      return new Set([script_id]);\n    }\n    value.add(script_id);\n    return value;\n  });\n  eventEmit(path, getPreferredScriptId());\n\n  return {\n    unregister: () => {\n      _.update(window.parent, path, (value: Set<string> | undefined) => {\n        if (value !== undefined) {\n          value.delete(script_id);\n        }\n        return value;\n      });\n      eventEmit(path, getPreferredScriptId());\n    },\n    getPreferredScriptId,\n    listenPreferenceState: (callback: (enabled_script_id: string) => void) => eventOn(path, callback),\n  };\n}\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { registerAsUniqueScript } from '@util/script';\nconst OldSettings = z\n    .object({\n    name: z.string().default('压缩相邻消息'),\n    seperator: z\n        .object({\n        type: z.enum(['space', 'newline', 'double newline', 'custom']).default('double newline'),\n        value: z.string().default('\\n\\n'),\n    })\n        .prefault({})\n        .transform(data => {\n        switch (data.type) {\n            case 'space':\n                data.value = ' ';\n                break;\n            case 'newline':\n                data.value = '\\n';\n                break;\n            case 'double newline':\n                data.value = '\\n\\n';\n                break;\n            case 'custom':\n                break;\n        }\n        return data;\n    }),\n    put_system_injection_after_chat_history: z.boolean().default(false),\n    on_chat_history: z\n        .object({\n        type: z.enum(['mixin', 'seperate', 'squash']).default('squash'),\n        squash_role: z.enum(['user', 'assistant', 'system']).default('assistant'),\n        user_prefix: z.string().default('[下段剧情指令]\\n'),\n        user_suffix: z.string().default('\\n[/下段剧情指令]'),\n        assistant_prefix: z.string().default('[剧情]\\n'),\n        assistant_suffix: z.string().default('\\n[/剧情]'),\n        system_prefix: z.string().default('[设定]\\n'),\n        system_suffix: z.string().default('\\n[/设定]'),\n    })\n        .prefault({}),\n    stop_string: z.string().default('<|im_end|>').catch('<|im_end|>'),\n})\n    .transform(data => {\n    return Settings.parse({\n        delimiter: data.seperator,\n        stop_string: data.stop_string,\n        depth_injection: {\n            threshold: 10,\n            above: {\n                enabled: data.put_system_injection_after_chat_history,\n                type: 'exclude',\n                placeholder: `{{压缩相邻消息::above_dx}}`,\n            },\n            below: {\n                enabled: data.put_system_injection_after_chat_history,\n                type: 'exclude',\n                placeholder: `{{压缩相邻消息::below_dx}}`,\n            },\n        },\n        chat_history: {\n            ...data.on_chat_history,\n            type: data.on_chat_history.type === 'squash' ? 'squash_into_one' : 'squash_nearby',\n        },\n    });\n});\nexport const Settings = z\n    .object({\n    delimiter: z\n        .object({\n        type: z.enum(['space', 'newline', 'double newline', 'custom']).default('double newline'),\n        value: z.string().default('\\n\\n'),\n    })\n        .prefault({})\n        .transform(data => {\n        switch (data.type) {\n            case 'space':\n                data.value = ' ';\n                break;\n            case 'newline':\n                data.value = '\\n';\n                break;\n            case 'double newline':\n                data.value = '\\n\\n';\n                break;\n            case 'custom':\n                break;\n        }\n        return data;\n    }),\n    stop_string: z.string().default('<|im_end|>').catch('<|im_end|>'),\n    depth_injection: z\n        .object({\n        threshold: z.number().int().min(1).default(10).catch(10),\n        above: z\n            .object({\n            enabled: z.boolean().default(false),\n            type: z.enum(['exclude', 'placeholder']).default('exclude'),\n            placeholder: z.string().default('{{压缩相邻消息::above_dx}}'),\n        })\n            .prefault({}),\n        below: z\n            .object({\n            enabled: z.boolean().default(false),\n            type: z.enum(['exclude', 'placeholder']).default('exclude'),\n            placeholder: z.string().default('{{压缩相邻消息::below_dx}}'),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    chat_history: z\n        .object({\n        type: z.enum(['squash_nearby', 'squash_into_one']).default('squash_into_one'),\n        squash_role: z.enum(['user', 'assistant', 'system']).default('assistant'),\n        user_prefix: z.string().default('[{{user}}]\\n'),\n        user_suffix: z.string().default('\\n[/{{user}}]'),\n        assistant_prefix: z.string().default('[剧情]\\n'),\n        assistant_suffix: z.string().default('\\n[/剧情]'),\n        system_prefix: z.string().default('[设定]\\n'),\n        system_suffix: z.string().default('\\n[/设定]'),\n    })\n        .prefault({}),\n})\n    .prefault({});\nexport const useSettingsStore = defineStore('settings', () => {\n    const variables = getVariables({ type: 'script', script_id: getScriptId() });\n    const settings = ref((_.has(variables, 'seperator') ? OldSettings : Settings).parse(variables));\n    const should_enable = ref(false);\n    registerAsUniqueScript('压缩相邻消息').listenPreferenceState(preferred_script_id => {\n        should_enable.value = preferred_script_id === getScriptId();\n    });\n    watchEffect(() => {\n        replaceVariables(klona(settings.value), { type: 'script', script_id: getScriptId() });\n    });\n    const useEscapedNewline = (path) => {\n        return computed({\n            get: () => _.get(settings.value, path).replace(/\\n/g, '\\\\n'),\n            set: value => _.set(settings.value, path, value.replace(/\\\\n/g, '\\n')),\n        });\n    };\n    return { settings, should_enable, useEscapedNewline };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderSlot as _renderSlot, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"TR-field flex-container flexFlowColumn\" };\nconst _hoisted_2 = { class: \"TR-field__label\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Field',\n    props: {\n        label: {}\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"label\", _hoisted_2, [\n                    _createElementVNode(\"span\", null, _toDisplayString(__props.label), 1 /* TEXT */),\n                    _renderSlot(_ctx.$slots, \"label-suffix\")\n                ]),\n                _renderSlot(_ctx.$slots, \"default\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Field.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Field.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-75b81b74\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'HelpIcon',\n    props: {\n        help: {}\n    },\n    setup(__props) {\n        function showHelpPopup(content) {\n            SillyTavern.callGenericPopup(content, SillyTavern.POPUP_TYPE.TEXT, '', {\n                allowVerticalScrolling: true,\n                leftAlign: true,\n                wide: true,\n            });\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"i\", {\n                class: \"fa-solid fa-circle-question fa-sm note-link-span TR-help-icon\",\n                role: \"button\",\n                tabindex: \"0\",\n                onClick: _cache[0] || (_cache[0] = ($event) => (showHelpPopup(__props.help)))\n            }));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./HelpIcon.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./HelpIcon.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-43141e14\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderSlot as _renderSlot } from \"vue\";\nconst _hoisted_1 = { class: \"flex-container alignitemscenter\" };\nconst _hoisted_2 = { key: 0 };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Item',\n    props: {\n        label: {}\n    },\n    setup(__props) {\n        const props = __props;\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                (__props.label)\n                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_2, _toDisplayString(__props.label), 1 /* TEXT */))\n                    : _createCommentVNode(\"v-if\", true),\n                _renderSlot(_ctx.$slots, \"default\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Item.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Item.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderSlot as _renderSlot, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"TR-section flex-container flexFlowColumn\" };\nconst _hoisted_2 = { class: \"TR-section__title\" };\nconst _hoisted_3 = { class: \"TR-section__content flex-container flexFlowColumn\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Section',\n    props: {\n        label: {}\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"strong\", null, [\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.label), 1 /* TEXT */)\n                    ]),\n                    _renderSlot(_ctx.$slots, \"label-suffix\")\n                ]),\n                _createElementVNode(\"div\", _hoisted_3, [\n                    _renderSlot(_ctx.$slots, \"default\")\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Section.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Section.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.27_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-399ec098\"]])\n\nexport default __exports__","import { useModel as _useModel, mergeModels as _mergeModels, defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, withDirectives as _withDirectives } from \"vue\";\n\nimport { computed } from 'vue';\nconst _hoisted_1 = [\"value\"];\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Select',\n    props: /*@__PURE__*/ _mergeModels({\n        options: {}\n    }, {\n        \"modelValue\": { required: true },\n        \"modelModifiers\": {},\n    }),\n    emits: [\"update:modelValue\"],\n    setup(__props) {\n        const model = _useModel(__props, \"modelValue\");\n        const props = __props;\n        const options = computed(() => props.options.map(option => (typeof option === 'string' ? { label: option, value: option } : option)));\n        return (_ctx, _cache) => {\n            return _withDirectives((_openBlock(), _createElementBlock(\"select\", {\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((model).value = $event)),\n                class: \"text_pole\"\n            }, [\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(options), ({ label, value }) => {\n                    return (_openBlock(), _createElementBlock(\"option\", {\n                        key: value,\n                        value: value\n                    }, _toDisplayString(label), 9 /* TEXT, PROPS */, _hoisted_1));\n                }), 128 /* KEYED_FRAGMENT */))\n            ], 512 /* NEED_PATCH */)), [\n                [_vModelSelect, model.value]\n            ]);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Select.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Select.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","// Module\nvar code = `<h1>处理聊天历史</h1> <p>酒馆的聊天历史 (预设中的 Chat History 条目) 记录了玩家和 AI 的每楼层提示词, 也就是实际游玩的内容.</p> <p>聊天记录往往是一问一答的: 一条用户输入、一条 AI 输出、一条用户输入……AI 团队可能针对这种对话进行了一些特殊训练, 而我们游玩酒馆恰因为这些训练出现问题 (出现八股、文风变差之类的).</p> <p>因此本脚本允许你对聊天历史进行额外处理:</p> <ul> <li>仅合并相邻同身份提示词: 将聊天历史中相邻且身份相同的提示词合并, 例如世界书条目 A 和 B 都插入到 D1 作为系统提示词, 则会被合并成一条提示词</li> <li><strong>压缩为单条提示词</strong>: 先合并相邻同身份提示词, 再将整个聊天历史压缩为一条提示词</li> </ul> <p>其中, 压缩为单条提示词就是为了避免受 AI 团队对人机对话的训练影响. 它将原本的一问一答附上相应的身份前后缀, 然后合并成一条提示词, 例如:</p> <pre><code class=\"language-text\">{{user}}:\n我输入了一段话\n\n剧情:\nAI 根据输入的话生成了一段文本\n\n{{user}}:\n我又输入了一段话\n</code></pre> <p>不过, 由于聊天记录被压缩成单条提示词发给 AI, AI 可能误认为它就该输出这样的一长串对话.</p> <p>为了避免它自问自答, 你可以在停止字符串中填入它应该在什么时候中止输出. (对于上面的例子, 我们可以填写 <code>{{user}}:</code> 作为停止字符串.)</p> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./ChatHistory.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ChatHistory.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, withCtx as _withCtx, isRef as _isRef, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createBlock as _createBlock } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport Field from './component/Field.vue';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Item from './component/Item.vue';\nimport Section from './component/Section.vue';\nimport Select from './component/Select.vue';\nimport chat_history_help from './help/chat_history.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ChatHistory',\n    setup(__props) {\n        const store = useSettingsStore();\n        const user_prefix_input = store.useEscapedNewline('chat_history.user_prefix');\n        const user_suffix_input = store.useEscapedNewline('chat_history.user_suffix');\n        const assistant_prefix_input = store.useEscapedNewline('chat_history.assistant_prefix');\n        const assistant_suffix_input = store.useEscapedNewline('chat_history.assistant_suffix');\n        const system_prefix_input = store.useEscapedNewline('chat_history.system_prefix');\n        const system_suffix_input = store.useEscapedNewline('chat_history.system_suffix');\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"处理聊天历史\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(chat_history_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _createVNode(Select, {\n                        modelValue: _unref(store).settings.chat_history.type,\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.chat_history.type) = $event)),\n                        options: [\n                            { label: '仅合并相邻同身份提示词', value: 'squash_nearby' },\n                            { label: '压缩为单条提示词', value: 'squash_into_one' },\n                        ]\n                    }, null, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.chat_history.type === 'squash_into_one')\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                            _createVNode(Field, { label: \"压缩后的提示词身份\" }, {\n                                default: _withCtx(() => [\n                                    _createVNode(Select, {\n                                        modelValue: _unref(store).settings.chat_history.squash_role,\n                                        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((_unref(store).settings.chat_history.squash_role) = $event)),\n                                        options: [\n                                            { label: '用户', value: 'user' },\n                                            { label: '助手', value: 'assistant' },\n                                            { label: '系统', value: 'system' },\n                                        ]\n                                    }, null, 8 /* PROPS */, [\"modelValue\"])\n                                ]),\n                                _: 1 /* STABLE */\n                            }),\n                            _createVNode(Field, { label: \"提示词前后缀\" }, {\n                                default: _withCtx(() => [\n                                    _createVNode(Item, { label: \"用户前缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => (_isRef(user_prefix_input) ? (user_prefix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\",\n                                                placeholder: \"[{{user}}:]\\\\n\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(user_prefix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"用户后缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => (_isRef(user_suffix_input) ? (user_suffix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\",\n                                                placeholder: \"\\\\n[/{{user}}:]\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(user_suffix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"助手前缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => (_isRef(assistant_prefix_input) ? (assistant_prefix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\",\n                                                placeholder: \"[剧情:]\\\\n\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(assistant_prefix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"助手后缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event) => (_isRef(assistant_suffix_input) ? (assistant_suffix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\",\n                                                placeholder: \"\\\\n[/剧情:]\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(assistant_suffix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"系统前缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[6] || (_cache[6] = ($event) => (_isRef(system_prefix_input) ? (system_prefix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\",\n                                                placeholder: \"[设定:]\\\\n\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(system_prefix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"系统后缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[7] || (_cache[7] = ($event) => (_isRef(system_suffix_input) ? (system_suffix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\",\n                                                placeholder: \"\\\\n[/设定:]\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(system_suffix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    })\n                                ]),\n                                _: 1 /* STABLE */\n                            })\n                        ], 64 /* STABLE_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","// Module\nvar code = `<h1>合并消息时的间隔文本</h1> <p>当发给 AI 的两条提示词合并时, 两条提示词的文本也会被合并. 但当文本合并时, 它们之间往往需要用额外文本间隔起来.</p> <p>例如, 一条提示词是:</p> <pre><code class=\"language-text\">用户:\n你好, 我是张三.\n</code></pre> <p>另一条提示词是:</p> <pre><code class=\"language-text\">助手:\n你好, 我是李四.\n</code></pre> <p>当这两条提示词合并时, 如果我们什么间隔文本都不加, 将会变成:</p> <pre><code class=\"language-text\">用户:\n你好, 我是张三.助手:\n你好, 我是李四.\n</code></pre> <p>显然这容易让 AI 产生误解, 因此我们需要在它们之间添加间隔文本.</p> <p>一般来说, 双换行是比较好的间隔文本, 因此脚本默认为你选择了双换行.</p> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./Delimiter.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Delimiter.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, isRef as _isRef, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, withCtx as _withCtx, createBlock as _createBlock } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Section from './component/Section.vue';\nimport Select from './component/Select.vue';\nimport delimiter_help from './help/delimiter.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Delimiter',\n    setup(__props) {\n        const store = useSettingsStore();\n        const delimiter = store.useEscapedNewline('delimiter.value');\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"合并提示词时的间隔文本\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(delimiter_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _createVNode(Select, {\n                        modelValue: _unref(store).settings.delimiter.type,\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.delimiter.type) = $event)),\n                        options: [\n                            { label: '空格', value: 'space' },\n                            { label: '换行', value: 'newline' },\n                            { label: '双换行', value: 'double newline' },\n                            { label: '自定义', value: 'custom' },\n                        ]\n                    }, null, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.delimiter.type === 'custom')\n                        ? _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n                            key: 0,\n                            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => (_isRef(delimiter) ? (delimiter).value = $event : null)),\n                            class: \"text_pole flex1 wide100p\",\n                            type: \"text\",\n                            autocomplete: \"off\"\n                        }, null, 512 /* NEED_PATCH */)), [\n                            [_vModelText, _unref(delimiter)]\n                        ])\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","import { useModel as _useModel, defineComponent as _defineComponent } from 'vue';\nimport { vModelCheckbox as _vModelCheckbox, createElementVNode as _createElementVNode, withDirectives as _withDirectives, renderSlot as _renderSlot, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"checkbox_label\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Checkbox',\n    props: {\n        \"modelValue\": { type: Boolean, ...{ required: true } },\n        \"modelModifiers\": {},\n    },\n    emits: [\"update:modelValue\"],\n    setup(__props) {\n        const model = _useModel(__props, \"modelValue\");\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"label\", _hoisted_1, [\n                _withDirectives(_createElementVNode(\"input\", {\n                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((model).value = $event)),\n                    type: \"checkbox\"\n                }, null, 512 /* NEED_PATCH */), [\n                    [_vModelCheckbox, model.value]\n                ]),\n                _renderSlot(_ctx.$slots, \"default\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Checkbox.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Checkbox.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","// Module\nvar code = `<h1>处理 D⚙ 条目</h1> <p>按照<a href=\"https://discord.com/channels/1134557553011998840/1413538722078785576\">一些预设作者和角色卡作者的说法</a>, Gemini 和 Claude 不同, 不必将条目插入聊天记录中, 插入其中反而会干扰聊天记录的连续性, 重要条目应该都插入到 D0.</p> <p>但玩家依旧可能使用 Claude、GPT 等游玩, 而对它们还是需要用 D4 等深度的.</p> <p>因此本脚本提供了处理深度条目功能, 允许你特殊处理特定深度 (Dx) 以上和以下的系统深度条目 (D⚙ 条目):</p> <ul> <li>将它们按顺序插入到 D9999/D0: 如果说法无误, 几乎所有预设都能从中获得好处, 而不会产生负面影响</li> <li>或将它们合并成一条文本, 并替换到占位符位置: 预设可以赋予这些条目特殊的语义, 就像有的预设为 AI 把 \"角色定义之前/之后\" 部分定义成 <code>additional_settings</code> 那样</li> </ul> <hr> <p><strong>注意</strong>: 这些选项虽然已经不用角色卡作者自行将条目全设置为 D0，但仍很需要角色卡适配；如果角色详情等会随剧情发展的设定放在了深度条目，则勾选这些选项容易使角色固化。</p> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./DepthInjection.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./DepthInjection.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, toDisplayString as _toDisplayString, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport Checkbox from './component/Checkbox.vue';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Section from './component/Section.vue';\nimport Select from './component/Select.vue';\nimport depth_injection_help from './help/depth_injection.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'DepthInjection',\n    setup(__props) {\n        const store = useSettingsStore();\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"处理 D⚙ 条目\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(depth_injection_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _withDirectives(_createElementVNode(\"input\", {\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.depth_injection.threshold) = $event)),\n                        type: \"number\",\n                        min: \"0\",\n                        class: \"text_pole flex1 wide100p\"\n                    }, null, 512 /* NEED_PATCH */), [\n                        [\n                            _vModelText,\n                            _unref(store).settings.depth_injection.threshold,\n                            void 0,\n                            { number: true }\n                        ]\n                    ]),\n                    _createVNode(Checkbox, {\n                        modelValue: _unref(store).settings.depth_injection.above.enabled,\n                        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((_unref(store).settings.depth_injection.above.enabled) = $event))\n                    }, {\n                        default: _withCtx(() => [\n                            _createElementVNode(\"span\", null, \"处理 D\" + _toDisplayString(_unref(store).settings.depth_injection.threshold) + \" 及以上的 D⚙ 条目\", 1 /* TEXT */)\n                        ]),\n                        _: 1 /* STABLE */\n                    }, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.depth_injection.above.enabled)\n                        ? (_openBlock(), _createBlock(Select, {\n                            key: 0,\n                            modelValue: _unref(store).settings.depth_injection.above.type,\n                            \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((_unref(store).settings.depth_injection.above.type) = $event)),\n                            style: { \"width\": \"90%\", \"align-self\": \"flex-end\" },\n                            options: [\n                                { label: '按顺序插入到 D9999', value: 'exclude' },\n                                { label: `合并后替换到 ${_unref(store).settings.depth_injection.above.placeholder} 宏位置`, value: 'placeholder' },\n                            ]\n                        }, null, 8 /* PROPS */, [\"modelValue\", \"options\"]))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createVNode(Checkbox, {\n                        modelValue: _unref(store).settings.depth_injection.below.enabled,\n                        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((_unref(store).settings.depth_injection.below.enabled) = $event))\n                    }, {\n                        default: _withCtx(() => [\n                            _createElementVNode(\"span\", null, \"处理 D\" + _toDisplayString(_unref(store).settings.depth_injection.threshold) + \" 以下的 D⚙ 条目\", 1 /* TEXT */)\n                        ]),\n                        _: 1 /* STABLE */\n                    }, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.depth_injection.below.enabled)\n                        ? (_openBlock(), _createBlock(Select, {\n                            key: 1,\n                            modelValue: _unref(store).settings.depth_injection.below.type,\n                            \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((_unref(store).settings.depth_injection.below.type) = $event)),\n                            style: { \"width\": \"90%\", \"align-self\": \"flex-end\" },\n                            options: [\n                                { label: '按顺序插入到 D0', value: 'exclude' },\n                                { label: `合并后替换到 ${_unref(store).settings.depth_injection.below.placeholder} 宏位置`, value: 'placeholder' },\n                            ]\n                        }, null, 8 /* PROPS */, [\"modelValue\", \"options\"]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","// Module\nvar code = `<h1>停止字符串</h1> <p>如果填入停止字符串, 则 AI 输出了对应文本时将会直接停止输出. 停止字符串可以是字符串或正则, 如 <code>User:</code> 或 <code>/User:|System:/</code>.</p> <p>这可以避免 AI 在输出完剧情后自己和自己对话. 例如, AI 直接回复了以下内容:</p> <pre><code class=\"language-text\">&#x3C;|im_start|> assistant\n剧情……\n&#x3C;|im_end|>\n\n&#x3C;|im_start|> user\nAI 自己作为 user 继续发送消息了!\n&#x3C;|im_end|>\n\n&#x3C;|im_start|> assistant\n剧情……\n&#x3C;|im_end|>\n</code></pre> <p>那么可以把 <code>&#x3C;|im_end|></code> 作为停止字符串.</p> <p>这样一来,</p> <ul> <li>对于流式传输: 当 AI 输出完剧情, 输出到 <code>&#x3C;|im_end|></code> 时, 就会直接停止输出</li> <li>对于非流式传输: 当 AI 回复后, 脚本会删去 <code>&#x3C;|im_end|></code> 及以后的所有文本</li> </ul> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./Stop.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Stop.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Section from './component/Section.vue';\nimport stop_help from './help/stop.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Stop',\n    setup(__props) {\n        const store = useSettingsStore();\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"停止字符串\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(stop_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _withDirectives(_createElementVNode(\"input\", {\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.stop_string) = $event)),\n                        class: \"text_pole flex1 wide100p\",\n                        type: \"text\",\n                        placeholder: \"请输入字符串或 /正则/\",\n                        autocomplete: \"off\"\n                    }, null, 512 /* NEED_PATCH */), [\n                        [_vModelText, _unref(store).settings.stop_string]\n                    ])\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n    key: 0,\n    class: \"inline-drawer\"\n};\nconst _hoisted_2 = { class: \"inline-drawer-content\" };\nimport { useSettingsStore } from '../store';\nimport ChatHistory from './ChatHistory.vue';\nimport Delimiter from './Delimiter.vue';\nimport DepthInjection from './DepthInjection.vue';\nimport Stop from './Stop.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Panel',\n    setup(__props) {\n        const store = useSettingsStore();\n        return (_ctx, _cache) => {\n            return (_unref(store).should_enable)\n                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                    _cache[0] || (_cache[0] = _createElementVNode(\"div\", { class: \"inline-drawer-toggle inline-drawer-header\" }, [\n                        _createElementVNode(\"b\", null, \"压缩相邻消息\"),\n                        _createElementVNode(\"div\", { class: \"inline-drawer-icon fa-solid fa-circle-chevron-down down\" })\n                    ], -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createVNode(Delimiter),\n                        _createVNode(Stop),\n                        _createVNode(DepthInjection),\n                        _createVNode(ChatHistory)\n                    ])\n                ]))\n                : _createCommentVNode(\"v-if\", true);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createScriptIdDiv, teleportStyle } from '@util/script';\nimport { createPinia } from 'pinia';\nimport { createApp } from 'vue';\nimport Panel from './Panel.vue';\n\nexport function initPanel() {\n  const app = createApp(Panel).use(createPinia());\n\n  const $app = createScriptIdDiv().appendTo('#extensions_settings2');\n  app.mount($app[0]);\n\n  const { destroy } = teleportStyle();\n\n  return {\n    destroy: () => {\n      app.unmount();\n      $app.remove();\n      destroy();\n    },\n  };\n}\n","import { assignInplace, chunkBy, getComplementString, regexFromString } from '@util/common';\nimport { registerAsUniqueScript } from '@util/script';\nimport { compare } from 'compare-versions';\nimport { Settings } from './store';\n\nfunction getPromptContent(prompt: SillyTavern.SendingMessage, settings: Settings): string {\n  if (typeof prompt.content === 'string') {\n    return prompt.content;\n  }\n  return prompt.content\n    .filter(({ type }) => type === 'text')\n    .map(({ text }: any) => text)\n    .join(settings.delimiter.value);\n}\nfunction updatePromptContentWith(\n  prompt: SillyTavern.SendingMessage,\n  updater: (prompt: { role: 'system' | 'assistant' | 'user'; content: string }) => string,\n  settings: Settings,\n): SillyTavern.SendingMessage {\n  const content = updater({ role: prompt.role, content: getPromptContent(prompt, settings) });\n  if (typeof prompt.content === 'string') {\n    prompt.content = content;\n  } else {\n    _.remove(prompt.content, item => item.type === 'text');\n    if (content) {\n      prompt.content.splice(0, 0, { type: 'text', text: content });\n    }\n  }\n  return prompt;\n}\n\nexport type Separators = {\n  head: InjectionPrompt;\n  deep: InjectionPrompt;\n  tail: InjectionPrompt;\n};\n\nexport function injectSeparators(settings: Settings) {\n  const separators: Readonly<Separators> = Object.freeze({\n    head: {\n      id: `\\0${getComplementString('压缩相邻消息-聊天记录开头')}`,\n      position: 'in_chat',\n      depth: 9999,\n      role: 'assistant',\n      content: `【【压缩相邻消息-聊天记录开头】】`,\n    },\n    deep: {\n      id: `\\xff压缩相邻消息-Dx`,\n      position: 'in_chat',\n      depth: settings.depth_injection.threshold,\n      role: 'system',\n      content: `【【压缩相邻消息-Dx】】`,\n    },\n    tail: {\n      id: `\\xff压缩相邻消息-聊天记录结尾`,\n      position: 'in_chat',\n      depth: 0,\n      role: 'system',\n      content: `【【压缩相邻消息-聊天记录结尾】】`,\n    },\n  } as const);\n\n  const inject = (_type: string, _option: object, dry_run: boolean) => {\n    if (dry_run) {\n      return;\n    }\n    injectPrompts(Object.values(separators));\n  };\n  eventOn(tavern_events.GENERATION_AFTER_COMMANDS, inject);\n\n  return {\n    separators,\n    uninject: () => {\n      eventRemoveListener(tavern_events.GENERATION_AFTER_COMMANDS, inject);\n      uninjectPrompts(Object.values(separators).map(({ id }) => id));\n    },\n  };\n}\n\n//----------------------------------------------------------------------------------------------------------------------\nfunction seperatePrompts(\n  prompts: SillyTavern.SendingMessage[],\n  separators: Separators,\n): SillyTavern.SendingMessage[][] | undefined {\n  const head_index = prompts.findIndex(\n    ({ content }) => typeof content === 'string' && content.includes(separators.head.content),\n  );\n  const deep_index = prompts.findIndex(\n    ({ content }) => typeof content === 'string' && content.includes(separators.deep.content),\n  );\n  const tail_index = prompts.findIndex(\n    ({ content }) => typeof content === 'string' && content.includes(separators.tail.content),\n  );\n  if (head_index === -1 || deep_index === -1 || tail_index === -1) {\n    return undefined;\n  }\n\n  const split_with_context = (\n    splitted_before: [string, string],\n    before_index: number,\n    current_index: number,\n    splitter: string,\n  ): [string, string] => {\n    if (before_index !== current_index) {\n      return (prompts[current_index].content as string).split(splitter) as [string, string];\n    }\n    const splitted = splitted_before[1].split(splitter) as [string, string];\n    splitted_before[1] = '';\n    return splitted;\n  };\n\n  const splitted_head = split_with_context(['', ''], -1, head_index, separators.head.content);\n  const splitted_deep = split_with_context(splitted_head, head_index, deep_index, separators.deep.content);\n  const splitted_tail = split_with_context(splitted_deep, deep_index, tail_index, separators.tail.content);\n\n  return [\n    [...prompts.slice(0, head_index), { role: prompts[head_index].role, content: splitted_head[0] }],\n    [\n      { role: prompts[head_index].role, content: splitted_head[1] },\n      ...prompts.slice(head_index + 1, deep_index),\n      { role: prompts[deep_index].role, content: splitted_deep[0] },\n    ],\n    [\n      { role: prompts[deep_index].role, content: splitted_deep[1] },\n      ...prompts.slice(deep_index + 1, tail_index),\n      { role: prompts[tail_index].role, content: splitted_tail[0] },\n    ],\n    [{ role: prompts[tail_index].role, content: splitted_tail[1] }, ...prompts.slice(tail_index + 1)],\n  ];\n}\n\nfunction trimEmptyLines(string: string): string {\n  return _(string)\n    .split('\\n')\n    .dropWhile(line => !line.trim())\n    .dropRightWhile(line => !line.trim())\n    .join('\\n');\n}\n\nfunction rejectEmptyPrompts(prompts: SillyTavern.SendingMessage[]): SillyTavern.SendingMessage[] {\n  return _.reject(prompts, ({ content }) => typeof content === 'string' && content.trim() === '');\n}\n\nfunction squashAdjacentMessage(\n  prompts: SillyTavern.SendingMessage[],\n  settings: Settings,\n): SillyTavern.SendingMessage[] {\n  return chunkBy(\n    prompts,\n    (lhs, rhs) => lhs.role === rhs.role && typeof lhs.content === 'string' && typeof rhs.content === 'string',\n  ).map(chunk => ({\n    role: chunk[0].role,\n    // 长度大于 1, 必然 content 为 string\n    content: chunk.length === 1 ? chunk[0].content : chunk.map(({ content }) => content).join(settings.delimiter.value),\n  }));\n}\n\nfunction squashChatHistory(prompts: SillyTavern.SendingMessage[], settings: Settings): SillyTavern.SendingMessage[] {\n  // TODO: zod encode\n  const system_prefix = substitudeMacros(settings.chat_history.system_prefix);\n  const system_suffix = substitudeMacros(settings.chat_history.system_suffix);\n  const assistant_prefix = substitudeMacros(settings.chat_history.assistant_prefix);\n  const assistant_suffix = substitudeMacros(settings.chat_history.assistant_suffix);\n  const user_prefix = substitudeMacros(settings.chat_history.user_prefix);\n  const user_suffix = substitudeMacros(settings.chat_history.user_suffix);\n\n  const tagContent = (prompt: SillyTavern.SendingMessage) =>\n    updatePromptContentWith(\n      prompt,\n      ({ role, content }) => {\n        switch (role) {\n          case 'system':\n            return system_prefix + content + system_suffix;\n          case 'assistant':\n            return assistant_prefix + content + assistant_suffix;\n          case 'user':\n            return user_prefix + content + user_suffix;\n        }\n      },\n      settings,\n    );\n\n  return chunkBy(prompts, (lhs, rhs) => typeof lhs.content === 'string' && typeof rhs.content === 'string').map(\n    chunk => {\n      chunk.forEach(tagContent);\n\n      return {\n        role: settings.chat_history.squash_role,\n        content:\n          chunk.length === 1 ? chunk[0].content : chunk.map(({ content }) => content).join(settings.delimiter.value),\n      };\n    },\n  );\n}\n\nfunction listenEvent(settings: Settings, separators: Separators, shouldEnable: () => boolean) {\n  const handlePrompts = ({ prompt }: { prompt: SillyTavern.SendingMessage[] }, dry_run: boolean) => {\n    if (dry_run || !shouldEnable()) {\n      return;\n    }\n\n    const chunks = seperatePrompts(prompt, separators)?.map(chunk =>\n      rejectEmptyPrompts(chunk).map(prompt =>\n        updatePromptContentWith(prompt, ({ content }) => trimEmptyLines(content), settings),\n      ),\n    );\n    if (!chunks) {\n      return;\n    }\n\n    const { above, below } = settings.depth_injection;\n\n    const applyInjection = (injection_settings: typeof above, from: number, to: number) => {\n      if (!injection_settings.enabled) {\n        return;\n      }\n\n      const isSystemWithoutPlaceholder = (p: SillyTavern.SendingMessage): boolean =>\n        p.role === 'system' &&\n        !(above.enabled && above.type === 'placeholder' && getPromptContent(p, settings).includes(above.placeholder)) &&\n        !(below.enabled && below.type === 'placeholder' && getPromptContent(p, settings).includes(below.placeholder));\n\n      const placeholder_content =\n        injection_settings.type === 'placeholder'\n          ? chunks[from]\n              .filter(isSystemWithoutPlaceholder)\n              // 没有把图片、多媒体也作为内容, 但无所谓, 世界书里不能设置图片或多媒体\n              .map(p => getPromptContent(p, settings))\n              .join(settings.delimiter.value)\n          : '';\n\n      if (\n        injection_settings.type === 'placeholder' &&\n        _(chunks)\n          .flatten()\n          .some(p => getPromptContent(p, settings).includes(injection_settings.placeholder))\n      ) {\n        _.remove(chunks[from], isSystemWithoutPlaceholder);\n      } else {\n        const exclude_chunk = _.remove(chunks[from], p => p.role === 'system');\n        chunks[to] = to < from ? _.concat(chunks[to], exclude_chunk) : _.concat(exclude_chunk, chunks[to]);\n      }\n      _(chunks)\n        .flatten()\n        .filter(p => getPromptContent(p, settings).includes(injection_settings.placeholder))\n        .forEach(p => {\n          updatePromptContentWith(\n            p,\n            ({ content }) => content.replaceAll(injection_settings.placeholder, placeholder_content),\n            settings,\n          );\n        });\n    };\n    applyInjection(above, 1, 0);\n    applyInjection(below, 2, 3);\n\n    const [head, above_chat_history, below_chat_history, tail] = chunks;\n\n    let result: SillyTavern.SendingMessage[];\n    switch (settings.chat_history.type) {\n      case 'squash_nearby':\n        result = squashAdjacentMessage(_.concat(head, above_chat_history, below_chat_history, tail), settings);\n        break;\n      case 'squash_into_one':\n        result = squashAdjacentMessage(\n          _.concat(head, squashChatHistory(_.concat(above_chat_history, below_chat_history), settings), tail),\n          settings,\n        );\n        break;\n    }\n\n    assignInplace(prompt, result);\n  };\n  const handlePrompts2 = ({ messages }: { messages: SillyTavern.SendingMessage[] }) => {\n    handlePrompts({ prompt: messages }, false);\n  };\n\n  if (compare(getTavernVersion(), '1.13.4', '>')) {\n    eventOn(tavern_events.GENERATE_AFTER_DATA, handlePrompts);\n  } else {\n    eventOn(tavern_events.CHAT_COMPLETION_SETTINGS_READY, handlePrompts2);\n  }\n\n  const handleStopStringOnStream = (text: string) => {\n    if (!settings.stop_string || !shouldEnable()) {\n      return;\n    }\n    const regex = regexFromString(settings.stop_string, true);\n    if (!regex) {\n      return;\n    }\n    if (regex.test(text)) {\n      SillyTavern.stopGeneration();\n    }\n  };\n  eventOn(tavern_events.STREAM_TOKEN_RECEIVED, handleStopStringOnStream);\n\n  const handleStopStringOnReceived = async (message_id: number | string) => {\n    if (!settings.stop_string || !shouldEnable()) {\n      return;\n    }\n\n    const chat_message = SillyTavern.chat[Number(message_id)];\n\n    const regex = regexFromString(settings.stop_string, true);\n    if (!regex) {\n      return;\n    }\n    const match = chat_message.mes.match(regex);\n    if (match) {\n      chat_message.mes = chat_message.mes.slice(0, match.index);\n      if (chat_message.swipes) {\n        _.set(chat_message, ['swipes', chat_message.swipe_id!], chat_message.mes);\n      }\n      // 与 https://gitgud.io/Monblant/noass 采用相同逻辑而不使用 setChatMessages, 因为 CHARACTER_MESSAGE_RENDERED 将会随后自然触发\n      SillyTavern.updateMessageBlock(Number(message_id), chat_message);\n      await SillyTavern.saveChat();\n    }\n  };\n  eventOn(tavern_events.MESSAGE_RECEIVED, handleStopStringOnReceived);\n\n  return {\n    unlisten: () => {\n      eventRemoveListener(tavern_events.GENERATE_AFTER_DATA, handlePrompts);\n      eventRemoveListener(tavern_events.CHAT_COMPLETION_SETTINGS_READY, handlePrompts2);\n      eventRemoveListener(tavern_events.STREAM_TOKEN_RECEIVED, handleStopStringOnStream);\n      eventRemoveListener(tavern_events.MESSAGE_RECEIVED, handleStopStringOnReceived);\n    },\n  };\n}\n\nexport function initSquash(settings: Settings) {\n  const { unregister, getPreferredScriptId } = registerAsUniqueScript('压缩相邻消息');\n  const { separators, uninject } = injectSeparators(settings);\n  const { unlisten } = listenEvent(settings, separators, () => getPreferredScriptId() === getScriptId());\n  return {\n    destroy: () => {\n      unregister();\n      unlisten();\n      uninject();\n    },\n  };\n}\n","import { checkMinimumVersion } from '@util/common';\nimport { loadReadme } from '@util/script';\nimport { initPanel } from './panel';\nimport { initSquash } from './squash';\nimport { useSettingsStore } from './store';\n$(() => {\n    checkMinimumVersion('3.4.17', '压缩相邻消息');\n    loadReadme('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/压缩相邻消息/README.md');\n    const { destroy: destroyPanel } = initPanel();\n    let destroySquash;\n    watch(() => useSettingsStore().settings, newSettings => {\n        destroySquash?.();\n        destroySquash = initSquash(newSettings).destroy;\n    }, { immediate: true, deep: true });\n    $(window).on('pagehide', () => {\n        destroyPanel();\n        destroySquash();\n    });\n});\n"],"names":["content","__esModule","default","module","id","locals","exports","add","listToStyles","parentId","list","styles","newStyles","i","length","item","part","css","media","sourceMap","parts","push","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","join","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","btoa","unescape","encodeURIComponent","JSON","stringify","firstChild","cssMapping","base64","data","concat","sourceMapping","cssWithMappingToString","toString","this","map","needLayer","modules","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","___CSS_LOADER_EXPORT___","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","chunkBy","array","predicate","chunks","lhs","rhs","_","zip","dropRight","drop","regexFromString","input","replace_macros","makeRegex","pattern","flags","substitudeMacros","RegExp","match","escapeRegExp","pull","indexOf","getComplementString","string","bytes","TextEncoder","encode","complemented","Uint8Array","hex","padStart","registerAsUniqueScript","script_id","getScriptId","path","getPreferredScriptId","registered_scripts","get","window","parent","Set","$","find","toArray","element","String","attr","has","last","value","eventEmit","unregister","delete","listenPreferenceState","callback","eventOn","n","getter","d","a","definition","o","Object","defineProperty","enumerable","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","Vue","z","OldSettings","object","name","seperator","enum","prefault","transform","put_system_injection_after_chat_history","boolean","on_chat_history","squash_role","user_prefix","user_suffix","assistant_prefix","assistant_suffix","system_prefix","system_suffix","stop_string","catch","Settings","parse","delimiter","depth_injection","threshold","above","enabled","placeholder","below","chat_history","number","int","min","useSettingsStore","variables","getVariables","settings","ref","should_enable","preferred_script_id","watchEffect","replaceVariables","useEscapedNewline","computed","replace","set","_hoisted_1","class","_hoisted_2","__name","label","setup","__props","_ctx","_cache","$slots","help","role","tabindex","onClick","$event","SillyTavern","callGenericPopup","POPUP_TYPE","TEXT","allowVerticalScrolling","leftAlign","wide","_hoisted_3","required","emits","model","option","store","user_prefix_input","user_suffix_input","assistant_prefix_input","assistant_suffix_input","system_prefix_input","system_suffix_input","Section","HelpIcon","Select","modelValue","Field","Item","autocomplete","Checkbox","style","Delimiter","Stop","DepthInjection","ChatHistory","initPanel","app","createApp","Panel","use","$app","appendTo","mount","destroy","append_to","$div","append","clone","teleportStyle","unmount","getPromptContent","prompt","text","updatePromptContentWith","updater","splice","squashAdjacentMessage","prompts","chunk","listenEvent","separators","shouldEnable","handlePrompts","dry_run","head_index","findIndex","includes","deep_index","deep","tail_index","tail","split_with_context","splitted_before","before_index","current_index","splitter","split","splitted","splitted_head","splitted_deep","splitted_tail","slice","seperatePrompts","rejectEmptyPrompts","reject","trim","dropWhile","line","dropRightWhile","applyInjection","injection_settings","from","to","isSystemWithoutPlaceholder","p","placeholder_content","flatten","some","exclude_chunk","forEach","replaceAll","above_chat_history","below_chat_history","result","tagContent","squashChatHistory","destination","new_array","handlePrompts2","messages","getTavernVersion","tavern_events","GENERATE_AFTER_DATA","CHAT_COMPLETION_SETTINGS_READY","handleStopStringOnStream","regex","stopGeneration","STREAM_TOKEN_RECEIVED","handleStopStringOnReceived","async","message_id","chat_message","chat","Number","mes","swipes","swipe_id","updateMessageBlock","saveChat","MESSAGE_RECEIVED","unlisten","eventRemoveListener","initSquash","uninject","freeze","position","depth","inject","_type","_option","injectPrompts","values","GENERATION_AFTER_COMMANDS","uninjectPrompts","injectSeparators","expected","title","getTavernHelperVersion","toastr","error","checkMinimumVersion","url","readme","fetch","ok","readme_text","replaceScriptInfo","loadReadme","destroyPanel","destroySquash","watch","newSettings","immediate","on"],"ignoreList":[],"sourceRoot":""}