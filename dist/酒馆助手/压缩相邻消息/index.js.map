{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/util.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/settings.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/Panel.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/Panel.vue?b43a","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/squash.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/index.ts"],"sourcesContent":["import { compare } from 'compare-versions';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { defineStore } from 'pinia';\nimport { ref, watchEffect } from 'vue';\nexport const Settings = z.object({\n    seperator: z\n        .object({\n        type: z.enum(['space', 'newline', 'double newline', 'custom']).default('double newline'),\n        value: z.string().default('\\n\\n'),\n    })\n        .prefault({})\n        .transform(data => {\n        switch (data.type) {\n            case 'space':\n                data.value = ' ';\n                break;\n            case 'newline':\n                data.value = '\\n';\n                break;\n            case 'double newline':\n                data.value = '\\n\\n';\n                break;\n            case 'custom':\n                break;\n        }\n        return data;\n    }),\n    put_system_injection_after_chat_history: z.boolean().default(false),\n    on_chat_history: z\n        .object({\n        type: z.enum(['mixin', 'seperate', 'squash']).default('squash'),\n        squash_role: z.enum(['user', 'assistant', 'system']).default('assistant'),\n        user_prefix: z.string().default('{{user}}: '),\n        user_suffix: z.string().default(''),\n        assistant_prefix: z.string().default('剧情: '),\n        assistant_suffix: z.string().default(''),\n        system_prefix: z.string().default(''),\n        system_suffix: z.string().default(''),\n    })\n        .prefault({}),\n});\nexport const useSettingsStore = defineStore('settings', () => {\n    const settings = ref(Settings.parse(getVariables({ type: 'script', script_id: getScriptId() })));\n    watchEffect(() => {\n        insertOrAssignVariables(klona(settings.value), { type: 'script', script_id: getScriptId() });\n    });\n    return { settings };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, unref as _unref, vModelSelect as _vModelSelect, withDirectives as _withDirectives, vModelText as _vModelText, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, vModelCheckbox as _vModelCheckbox } from \"vue\";\nconst _hoisted_1 = { class: \"inline-drawer\" };\nconst _hoisted_2 = { class: \"inline-drawer-content\" };\nconst _hoisted_3 = { class: \"flex-container flexFlowColumn\" };\nconst _hoisted_4 = {\n    key: 0,\n    class: \"flex-container flexFlowColumn\"\n};\nconst _hoisted_5 = { class: \"flex-container flexFlowColumn\" };\nconst _hoisted_6 = { style: { \"display\": \"flex\", \"align-items\": \"center\", \"gap\": \"8px\" } };\nconst _hoisted_7 = { class: \"flex-container flexFlowColumn\" };\nconst _hoisted_8 = {\n    key: 1,\n    class: \"flex-container flexFlowColumn\"\n};\nconst _hoisted_9 = { key: 2 };\nconst _hoisted_10 = {\n    class: \"flex-container flexFlowColumn\",\n    title: \"用户消息前缀\"\n};\nconst _hoisted_11 = {\n    class: \"flex-container flexFlowColumn\",\n    title: \"用户消息后缀\"\n};\nconst _hoisted_12 = {\n    class: \"flex-container flexFlowColumn\",\n    title: \"助手消息前缀\"\n};\nconst _hoisted_13 = {\n    class: \"flex-container flexFlowColumn\",\n    title: \"助手消息后缀\"\n};\nconst _hoisted_14 = {\n    class: \"flex-container flexFlowColumn\",\n    title: \"系统消息前缀\"\n};\nconst _hoisted_15 = {\n    class: \"flex-container flexFlowColumn\",\n    title: \"系统消息后缀\"\n};\nimport { storeToRefs } from 'pinia';\nimport { useSettingsStore } from './settings';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Panel',\n    setup(__props) {\n        const { settings } = storeToRefs(useSettingsStore());\n        function showHelp() {\n            SillyTavern.callGenericPopup(`<p>按照<a href=\"https://discord.com/channels/1134557553011998840/1413538722078785576\">一些预设作者和角色卡作者的说法</a>, Gemini 和 Claude 不同, 不必将条目插入聊天记录中, 插入其中反而会干扰聊天记录的连续性, 重要条目应该都插入到 D0.</p>\n     <p>但玩家依旧可能使用 Claude、GPT 等游玩, 而对它们还是需要用 D4 等深度的.</p>\n     <p>因此本脚本提供了这个选项: 勾选这个选项, D10 以下的条目将会被移动到 D0 位置, 而 D10 及以上条目将会被移动到 D9999 位置; 而关闭这个选项系统消息将会保持原有深度.</p>\n     <p>这个选项虽然已经不用角色卡作者自行将条目全设置为 D0, 但仍很需要角色卡适配; 如果角色详情等会随剧情发展的设定放在了深度条目, 则勾选这个选项容易使角色固化</p>`, SillyTavern.POPUP_TYPE.TEXT, '', { leftAlign: true });\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[27] || (_cache[27] = _createElementVNode(\"div\", { class: \"inline-drawer-toggle inline-drawer-header\" }, [\n                    _createElementVNode(\"b\", null, \"压缩相邻消息\"),\n                    _createElementVNode(\"div\", { class: \"inline-drawer-icon fa-solid fa-circle-chevron-down down\" })\n                ], -1 /* CACHED */)),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"div\", _hoisted_3, [\n                        _cache[12] || (_cache[12] = _createElementVNode(\"label\", null, \"消息分隔符\", -1 /* CACHED */)),\n                        _withDirectives(_createElementVNode(\"select\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(settings).seperator.type) = $event)),\n                            class: \"text_pole\"\n                        }, [...(_cache[11] || (_cache[11] = [\n                                _createElementVNode(\"option\", { value: \"space\" }, \"空格\", -1 /* CACHED */),\n                                _createElementVNode(\"option\", { value: \"newline\" }, \"换行\", -1 /* CACHED */),\n                                _createElementVNode(\"option\", { value: \"double newline\" }, \"双换行\", -1 /* CACHED */),\n                                _createElementVNode(\"option\", { value: \"custom\" }, \"自定义\", -1 /* CACHED */)\n                            ]))], 512 /* NEED_PATCH */), [\n                            [_vModelSelect, _unref(settings).seperator.type]\n                        ])\n                    ]),\n                    (_unref(settings).seperator.type === 'custom')\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [\n                            _cache[13] || (_cache[13] = _createElementVNode(\"label\", null, \"自定义分隔符\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"input\", {\n                                \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((_unref(settings).seperator.value) = $event)),\n                                class: \"text_pole flex1 wide100p\",\n                                type: \"text\",\n                                autocomplete: \"off\"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, _unref(settings).seperator.value]\n                            ])\n                        ]))\n                        : _createCommentVNode(\"v-if\", true),\n                    _cache[25] || (_cache[25] = _createElementVNode(\"hr\", null, null, -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _createElementVNode(\"div\", _hoisted_6, [\n                            _cache[14] || (_cache[14] = _createElementVNode(\"span\", null, \"将 D⚙ (系统深度条目) 按序移到聊天记录后\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"input\", {\n                                \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((_unref(settings).put_system_injection_after_chat_history) = $event)),\n                                type: \"checkbox\",\n                                style: { \"margin\": \"0 4px 0 0\" }\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelCheckbox, _unref(settings).put_system_injection_after_chat_history]\n                            ]),\n                            _createElementVNode(\"i\", {\n                                class: \"fa-solid fa-circle-question fa-sm note-link-span\",\n                                style: { \"cursor\": \"pointer\" },\n                                title: \"将注入到聊天深度的系统消息按照原有顺序移动到聊天记录的末尾，而不是保持在原来的深度位置。这可以确保系统消息不会干扰聊天记录的连续性。\",\n                                onClick: showHelp\n                            })\n                        ])\n                    ]),\n                    _cache[26] || (_cache[26] = _createElementVNode(\"hr\", null, null, -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_7, [\n                        _cache[16] || (_cache[16] = _createElementVNode(\"label\", null, \"聊天历史处理方式\", -1 /* CACHED */)),\n                        _withDirectives(_createElementVNode(\"select\", {\n                            \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((_unref(settings).on_chat_history.type) = $event)),\n                            class: \"text_pole\"\n                        }, [...(_cache[15] || (_cache[15] = [\n                                _createElementVNode(\"option\", { value: \"mixin\" }, \"与其他提示词混合\", -1 /* CACHED */),\n                                _createElementVNode(\"option\", { value: \"seperate\" }, \"与其他提示词隔离\", -1 /* CACHED */),\n                                _createElementVNode(\"option\", { value: \"squash\" }, \"单独压缩为一条消息\", -1 /* CACHED */)\n                            ]))], 512 /* NEED_PATCH */), [\n                            [_vModelSelect, _unref(settings).on_chat_history.type]\n                        ])\n                    ]),\n                    (_unref(settings).on_chat_history.type === 'squash')\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [\n                            _cache[18] || (_cache[18] = _createElementVNode(\"label\", null, \"压缩角色\", -1 /* CACHED */)),\n                            _withDirectives(_createElementVNode(\"select\", {\n                                \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((_unref(settings).on_chat_history.squash_role) = $event)),\n                                class: \"text_pole\"\n                            }, [...(_cache[17] || (_cache[17] = [\n                                    _createElementVNode(\"option\", { value: \"system\" }, \"系统\", -1 /* CACHED */),\n                                    _createElementVNode(\"option\", { value: \"user\" }, \"用户\", -1 /* CACHED */),\n                                    _createElementVNode(\"option\", { value: \"assistant\" }, \"助手\", -1 /* CACHED */)\n                                ]))], 512 /* NEED_PATCH */), [\n                                [_vModelSelect, _unref(settings).on_chat_history.squash_role]\n                            ])\n                        ]))\n                        : _createCommentVNode(\"v-if\", true),\n                    (_unref(settings).on_chat_history.type === 'squash')\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                _cache[19] || (_cache[19] = _createElementVNode(\"label\", null, \"用户前缀\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event) => ((_unref(settings).on_chat_history.user_prefix) = $event)),\n                                    class: \"text_pole flex1 wide100p\",\n                                    type: \"text\",\n                                    autocomplete: \"off\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(settings).on_chat_history.user_prefix]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_11, [\n                                _cache[20] || (_cache[20] = _createElementVNode(\"label\", null, \"用户后缀\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[6] || (_cache[6] = ($event) => ((_unref(settings).on_chat_history.user_suffix) = $event)),\n                                    class: \"text_pole flex1 wide100p\",\n                                    type: \"text\",\n                                    autocomplete: \"off\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(settings).on_chat_history.user_suffix]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_12, [\n                                _cache[21] || (_cache[21] = _createElementVNode(\"label\", null, \"助手前缀\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[7] || (_cache[7] = ($event) => ((_unref(settings).on_chat_history.assistant_prefix) = $event)),\n                                    class: \"text_pole flex1 wide100p\",\n                                    type: \"text\",\n                                    autocomplete: \"off\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(settings).on_chat_history.assistant_prefix]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_13, [\n                                _cache[22] || (_cache[22] = _createElementVNode(\"label\", null, \"助手后缀\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[8] || (_cache[8] = ($event) => ((_unref(settings).on_chat_history.assistant_suffix) = $event)),\n                                    class: \"text_pole flex1 wide100p\",\n                                    type: \"text\",\n                                    autocomplete: \"off\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(settings).on_chat_history.assistant_suffix]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_14, [\n                                _cache[23] || (_cache[23] = _createElementVNode(\"label\", null, \"系统前缀\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[9] || (_cache[9] = ($event) => ((_unref(settings).on_chat_history.system_prefix) = $event)),\n                                    class: \"text_pole flex1 wide100p\",\n                                    type: \"text\",\n                                    autocomplete: \"off\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(settings).on_chat_history.system_prefix]\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_15, [\n                                _cache[24] || (_cache[24] = _createElementVNode(\"label\", null, \"系统后缀\", -1 /* CACHED */)),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[10] || (_cache[10] = ($event) => ((_unref(settings).on_chat_history.system_suffix) = $event)),\n                                    class: \"text_pole flex1 wide100p\",\n                                    type: \"text\",\n                                    autocomplete: \"off\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(settings).on_chat_history.system_suffix]\n                                ])\n                            ])\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createPinia } from 'pinia';\nimport { createApp } from 'vue';\nimport { createScriptIdDiv, destroyScriptIdDiv, deteleportStyle, teleportStyle } from '../../util';\nimport Panel from './Panel.vue';\n\nconst app = createApp(Panel);\n\nexport function initPanel() {\n  teleportStyle();\n\n  const $app = createScriptIdDiv();\n  $('#extensions_settings2').append($app);\n\n  app.use(createPinia()).mount($app[0]);\n}\n\nexport function destroyPanel() {\n  app.unmount();\n  destroyScriptIdDiv();\n  deteleportStyle();\n}\n","import { assignInplace, chunkBy } from '../../util';\nimport { Settings } from './settings';\n\ntype Prompt = {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n};\n\n//----------------------------------------------------------------------------------------------------------------------\nconst head_separator = '{【{【聊天记录开头】}】}';\nconst deep_separator = '{【{【聊天记录深度分割】}】}';\nconst tail_separator = '{【{【聊天记录结尾】}】}';\nconst seperators: InjectionPrompt[] = [\n  {\n    id: '\\0压缩相邻消息',\n    position: 'in_chat',\n    depth: 9999,\n    role: 'assistant',\n    content: head_separator,\n  },\n  {\n    id: '\\xff压缩相邻消息深度分割',\n    position: 'in_chat',\n    depth: 10,\n    role: 'system',\n    content: deep_separator,\n  },\n  {\n    id: '\\xff压缩相邻消息',\n    position: 'in_chat',\n    depth: 0,\n    role: 'system',\n    content: tail_separator,\n  },\n];\n\nfunction injectSeperators() {\n  eventOn(tavern_events.GENERATION_AFTER_COMMANDS, (_type, _option, dry_run) => {\n    if (dry_run) {\n      return;\n    }\n    injectPrompts(seperators);\n  });\n}\n\nfunction uninjectSeperators() {\n  uninjectPrompts(seperators.map(({ id }) => id));\n}\n\n//----------------------------------------------------------------------------------------------------------------------\nfunction seperatePrompts(prompts: Prompt[]): Prompt[][] | null {\n  const head_index = prompts.findIndex(({ content }) => content.includes(head_separator));\n  const deep_index = prompts.findIndex(({ content }) => content.includes(deep_separator));\n  const tail_index = prompts.findIndex(({ content }) => content.includes(tail_separator));\n  if (head_index === -1 || deep_index === -1 || tail_index === -1) {\n    return null;\n  }\n\n  const [before_head_prompt_content, after_head_prompt_content] = prompts[head_index].content.split(head_separator);\n  const [before_deep_prompt_content, after_deep_prompt_content] = prompts[deep_index].content.split(deep_separator);\n  const [before_tail_prompt_content, after_tail_prompt_content] = prompts[tail_index].content.split(tail_separator);\n\n  return [\n    [...prompts.slice(0, head_index), { role: prompts[head_index].role, content: before_head_prompt_content }],\n    [\n      { role: prompts[head_index].role, content: after_head_prompt_content },\n      ...prompts.slice(head_index + 1, deep_index),\n      { role: prompts[deep_index].role, content: before_deep_prompt_content },\n    ],\n    [\n      { role: prompts[deep_index].role, content: after_deep_prompt_content },\n      ...prompts.slice(deep_index + 1, tail_index),\n      { role: prompts[tail_index].role, content: before_tail_prompt_content },\n    ],\n    [{ role: prompts[tail_index].role, content: after_tail_prompt_content }, ...prompts.slice(tail_index + 1)],\n  ];\n}\n\nfunction rejectEmptyPrompts(prompts: Prompt[]): Prompt[] {\n  return prompts.filter(({ content }) => content.trim() !== '');\n}\n\nfunction squashMessageByRole(prompts: Prompt[], settings: Settings): Prompt[] {\n  return chunkBy(prompts, (lhs, rhs) => lhs.role === rhs.role).map(chunk => ({\n    role: chunk[0].role,\n    content: chunk.map(({ content }) => content.trim()).join(settings.seperator.value),\n  }));\n}\n\nfunction squashChatHistory(prompts: Prompt[], settings: Settings): Prompt {\n  // TODO: zod encode\n  const system_prefix = substitudeMacros(settings.on_chat_history.system_prefix);\n  const system_suffix = substitudeMacros(settings.on_chat_history.system_suffix);\n  const assistant_prefix = substitudeMacros(settings.on_chat_history.assistant_prefix);\n  const assistant_suffix = substitudeMacros(settings.on_chat_history.assistant_suffix);\n  const user_prefix = substitudeMacros(settings.on_chat_history.user_prefix);\n  const user_suffix = substitudeMacros(settings.on_chat_history.user_suffix);\n  return {\n    role: settings.on_chat_history.squash_role,\n    content: prompts\n      .map(({ role, content }) => {\n        switch (role) {\n          case 'system':\n            return system_prefix + content.trim() + system_suffix;\n          case 'assistant':\n            return assistant_prefix + content.trim() + assistant_suffix;\n          case 'user':\n            return user_prefix + content.trim() + user_suffix;\n        }\n      })\n      .join(settings.seperator.value),\n  };\n}\n\nfunction listenEvent(settings: Settings) {\n  let check_dry_run = false;\n  eventOn(tavern_events.GENERATION_AFTER_COMMANDS, (_type, _option, dry_run) => {\n    check_dry_run = dry_run;\n  });\n  eventMakeLast(\n    tavern_events.GENERATE_AFTER_DATA,\n    ({ prompt }: { prompt: SillyTavern.SendingMessage[] }, dry_run?: boolean) => {\n      // 1.13.4 及之前 GENERATE_AFTER_DATA 没有 dry_run 参数\n      if (dry_run ?? check_dry_run) {\n        return;\n      }\n\n      if (prompt.some(({ content }) => typeof content !== 'string')) {\n        // TODO: 支持带图片、多媒体的脚本\n        return;\n      }\n\n      const chunks = seperatePrompts(prompt);\n      if (chunks === null) {\n        return;\n      }\n      if (settings.put_system_injection_after_chat_history) {\n        chunks[0] = _.concat(\n          chunks[0],\n          _.remove(chunks[1], ({ role }) => role === 'system'),\n        );\n        chunks[3] = _.concat(\n          _.remove(chunks[2], ({ role }) => role === 'system'),\n          chunks[3],\n        );\n      }\n      const [head, before_chat_history, after_chat_history, tail] = _(chunks)\n        .map(prompts => rejectEmptyPrompts(prompts))\n        .map(prompts => squashMessageByRole(prompts, settings))\n        .value();\n      switch (settings.on_chat_history.type) {\n        case 'mixin':\n          assignInplace(\n            prompt,\n            squashMessageByRole(_.concat(head, before_chat_history, after_chat_history, tail), settings),\n          );\n          break;\n        case 'seperate':\n          assignInplace(\n            prompt,\n            _.concat(head, squashMessageByRole(_.concat(before_chat_history, after_chat_history), settings), tail),\n          );\n          break;\n        case 'squash':\n          assignInplace(\n            prompt,\n            _.concat(head, squashChatHistory(_.concat(before_chat_history, after_chat_history), settings), tail),\n          );\n          break;\n      }\n    },\n  );\n}\n\n//----------------------------------------------------------------------------------------------------------------------\nexport function initSquash(settings: Settings) {\n  injectSeperators();\n  listenEvent(settings);\n}\n\nexport function destroySquash() {\n  uninjectSeperators();\n}\n","import { checkMinimumVersion, loadReadme } from '../../util';\nimport { destroyPanel, initPanel } from './panel';\nimport { useSettingsStore } from './settings';\nimport { destroySquash, initSquash } from './squash';\n\n$(() => {\n  checkMinimumVersion('3.4.17', '压缩相邻消息');\n  loadReadme('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/压缩相邻消息/README.md');\n  initPanel();\n  initSquash(useSettingsStore().settings);\n});\n\n$(window).on('pagehide', () => {\n  destroyPanel();\n  destroySquash();\n});\n"],"names":["assignInplace","destination","new_array","length","push","Vue","z","Settings","object","seperator","type","enum","default","value","string","prefault","transform","data","put_system_injection_after_chat_history","boolean","on_chat_history","squash_role","user_prefix","user_suffix","assistant_prefix","assistant_suffix","system_prefix","system_suffix","useSettingsStore","settings","ref","parse","getVariables","script_id","getScriptId","watchEffect","insertOrAssignVariables","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","key","_hoisted_5","_hoisted_6","style","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","title","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","__name","setup","__props","showHelp","SillyTavern","callGenericPopup","POPUP_TYPE","TEXT","leftAlign","_ctx","_cache","$event","autocomplete","onClick","app","createApp","Panel","initPanel","$","$div","attr","append","document","clone","teleportStyle","$app","use","mount","destroyPanel","unmount","remove","head_separator","deep_separator","tail_separator","seperators","id","position","depth","role","content","squashMessageByRole","prompts","array","predicate","chunks","lhs","rhs","_","zip","dropRight","drop","chunkBy","map","chunk","trim","join","listenEvent","check_dry_run","eventOn","tavern_events","GENERATION_AFTER_COMMANDS","_type","_option","dry_run","eventMakeLast","GENERATE_AFTER_DATA","prompt","some","head_index","findIndex","includes","deep_index","tail_index","before_head_prompt_content","after_head_prompt_content","split","before_deep_prompt_content","after_deep_prompt_content","before_tail_prompt_content","after_tail_prompt_content","slice","seperatePrompts","concat","head","before_chat_history","after_chat_history","tail","filter","rejectEmptyPrompts","substitudeMacros","squashChatHistory","initSquash","injectPrompts","destroySquash","uninjectPrompts","async","expected","getTavernHelperVersion","toastr","error","checkMinimumVersion","url","readme","fetch","ok","readme_text","text","replaceScriptInfo","loadReadme","window","on"],"sourceRoot":""}