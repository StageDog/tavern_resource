{"version":3,"file":"index.js","mappings":"kfAGIA,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAOC,GAAI,mDACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,4DAA4D,MAAQ,GAAG,SAAW,mBAAmB,eAAiB,CAAC,whBAA+hB,WAAa,MAEjsB,S,aCLA,IAAIC,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACF,EAAOC,GAAIC,EAAS,MAC7DA,EAAQG,SAAQL,EAAOM,QAAUJ,EAAQG,SAG/BE,EADH,UACO,WAAYL,GAAS,EAAO,CAAC,OAAQ,G,aCLvC,SAASM,EAAcC,EAAUC,GAG9C,IAFA,IAAIC,EAAS,GACTC,EAAY,CAAC,EACRC,EAAI,EAAGA,EAAIH,EAAKI,OAAQD,IAAK,CACpC,IAAIE,EAAOL,EAAKG,GACZZ,EAAKc,EAAK,GAIVC,EAAO,CACTf,GAAIQ,EAAW,IAAMI,EACrBI,IALQF,EAAK,GAMbG,MALUH,EAAK,GAMfI,UALcJ,EAAK,IAOhBH,EAAUX,GAGbW,EAAUX,GAAImB,MAAMrB,KAAKiB,GAFzBL,EAAOZ,KAAKa,EAAUX,GAAM,CAAEA,GAAIA,EAAImB,MAAO,CAACJ,IAIlD,CACA,OAAOL,CACT,C,iBClBA,IAAIU,EAAkC,oBAAbC,SAEzB,GAAqB,oBAAVC,OAAyBA,QAC7BF,EACH,MAAM,IAAIG,MACV,6JAkBJ,IAAIC,EAAc,CAMhB,EAEEC,EAAOL,IAAgBC,SAASI,MAAQJ,SAASK,qBAAqB,QAAQ,IAC9EC,EAAmB,KACnBC,EAAmB,EACnBC,GAAe,EACfC,EAAO,WAAa,EACpBC,EAAU,KACVC,EAAW,kBAIXC,EAA+B,oBAAdC,WAA6B,eAAeC,KAAKD,UAAUE,UAAUC,eAE3E,SAASC,EAAiB9B,EAAUC,EAAM8B,EAAeC,GACtEX,EAAeU,EAEfR,EAAUS,GAAY,CAAC,EAEvB,IAAI9B,EAASH,EAAaC,EAAUC,GAGpC,OAFAgC,EAAe/B,GAER,SAAiBgC,GAEtB,IADA,IAAIC,EAAY,GACP/B,EAAI,EAAGA,EAAIF,EAAOG,OAAQD,IAAK,CACtC,IAAIE,EAAOJ,EAAOE,IACdgC,EAAWpB,EAAYV,EAAKd,KACvB6C,OACTF,EAAU7C,KAAK8C,EACjB,CACIF,EAEFD,EADA/B,EAASH,EAAaC,EAAUkC,IAGhChC,EAAS,GAEX,IAASE,EAAI,EAAGA,EAAI+B,EAAU9B,OAAQD,IAAK,CACzC,IAAIgC,EACJ,GAAsB,KADlBA,EAAWD,EAAU/B,IACZiC,KAAY,CACvB,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAASzB,MAAMN,OAAQiC,IACzCF,EAASzB,MAAM2B,YAEVtB,EAAYoB,EAAS5C,GAC9B,CACF,CACF,CACF,CAEA,SAASyC,EAAgB/B,GACvB,IAAK,IAAIE,EAAI,EAAGA,EAAIF,EAAOG,OAAQD,IAAK,CACtC,IAAIE,EAAOJ,EAAOE,GACdgC,EAAWpB,EAAYV,EAAKd,IAChC,GAAI4C,EAAU,CACZA,EAASC,OACT,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAASzB,MAAMN,OAAQiC,IACzCF,EAASzB,MAAM2B,GAAGhC,EAAKK,MAAM2B,IAE/B,KAAOA,EAAIhC,EAAKK,MAAMN,OAAQiC,IAC5BF,EAASzB,MAAMrB,KAAKiD,EAASjC,EAAKK,MAAM2B,KAEtCF,EAASzB,MAAMN,OAASC,EAAKK,MAAMN,SACrC+B,EAASzB,MAAMN,OAASC,EAAKK,MAAMN,OAEvC,KAAO,CACL,IAAIM,EAAQ,GACZ,IAAS2B,EAAI,EAAGA,EAAIhC,EAAKK,MAAMN,OAAQiC,IACrC3B,EAAMrB,KAAKiD,EAASjC,EAAKK,MAAM2B,KAEjCtB,EAAYV,EAAKd,IAAM,CAAEA,GAAIc,EAAKd,GAAI6C,KAAM,EAAG1B,MAAOA,EACxD,CACF,CACF,CAEA,SAAS6B,IACP,IAAIC,EAAe5B,SAAS6B,cAAc,SAG1C,OAFAD,EAAaE,KAAO,WACpB1B,EAAK2B,YAAYH,GACVA,CACT,CAEA,SAASF,EAAUM,GACjB,IAAIC,EAAQC,EACRN,EAAe5B,SAASmC,cAAc,SAAWxB,EAAW,MAAQqB,EAAIrD,GAAK,MAEjF,GAAIiD,EAAc,CAChB,GAAIpB,EAGF,OAAOC,EAOPmB,EAAaQ,WAAWC,YAAYT,EAExC,CAEA,GAAIhB,EAAS,CAEX,IAAI0B,EAAa/B,IACjBqB,EAAetB,IAAqBA,EAAmBqB,KACvDM,EAASM,EAAoBC,KAAK,KAAMZ,EAAcU,GAAY,GAClEJ,EAASK,EAAoBC,KAAK,KAAMZ,EAAcU,GAAY,EACpE,MAEEV,EAAeD,IACfM,EAASQ,EAAWD,KAAK,KAAMZ,GAC/BM,EAAS,WACPN,EAAaQ,WAAWC,YAAYT,EACtC,EAKF,OAFAK,EAAOD,GAEA,SAAsBU,GAC3B,GAAIA,EAAQ,CACV,GAAIA,EAAO/C,MAAQqC,EAAIrC,KACnB+C,EAAO9C,QAAUoC,EAAIpC,OACrB8C,EAAO7C,YAAcmC,EAAInC,UAC3B,OAEFoC,EAAOD,EAAMU,EACf,MACER,GAEJ,CACF,CAEA,IACMS,EADFC,GACED,EAAY,GAET,SAAUE,EAAOC,GAEtB,OADAH,EAAUE,GAASC,EACZH,EAAUI,OAAOC,SAASC,KAAK,KACxC,GAGF,SAASV,EAAqBX,EAAciB,EAAOX,EAAQF,GACzD,IAAIrC,EAAMuC,EAAS,GAAKF,EAAIrC,IAE5B,GAAIiC,EAAasB,WACftB,EAAasB,WAAWC,QAAUP,EAAYC,EAAOlD,OAChD,CACL,IAAIyD,EAAUpD,SAASqD,eAAe1D,GAClC2D,EAAa1B,EAAa0B,WAC1BA,EAAWT,IAAQjB,EAAaS,YAAYiB,EAAWT,IACvDS,EAAW9D,OACboC,EAAa2B,aAAaH,EAASE,EAAWT,IAE9CjB,EAAaG,YAAYqB,EAE7B,CACF,CAEA,SAASX,EAAYb,EAAcI,GACjC,IAAIrC,EAAMqC,EAAIrC,IACVC,EAAQoC,EAAIpC,MACZC,EAAYmC,EAAInC,UAiBpB,GAfID,GACFgC,EAAa4B,aAAa,QAAS5D,GAEjCc,EAAQ+C,OACV7B,EAAa4B,aAAa7C,EAAUqB,EAAIrD,IAGtCkB,IAGFF,GAAO,mBAAqBE,EAAU6D,QAAQ,GAAK,MAEnD/D,GAAO,uDAAyDgE,KAAKC,SAASC,mBAAmBC,KAAKC,UAAUlE,MAAgB,OAG9H+B,EAAasB,WACftB,EAAasB,WAAWC,QAAUxD,MAC7B,CACL,KAAOiC,EAAaoC,YAClBpC,EAAaS,YAAYT,EAAaoC,YAExCpC,EAAaG,YAAY/B,SAASqD,eAAe1D,GACnD,CACF,C,WCzNAX,EAAQ,EAAU,CAACiF,EAAKC,KACpB,MAAMC,EAASF,EAAIG,WAAaH,EAChC,IAAK,MAAOI,EAAKC,KAAQJ,EACrBC,EAAOE,GAAOC,EAElB,OAAOH,E,SCPXzF,EAAOM,QAAU,SAAUS,GACzB,IAAIb,EAAUa,EAAK,GACf8E,EAAa9E,EAAK,GACtB,IAAK8E,EACH,OAAO3F,EAET,GAAoB,mBAAT+E,KAAqB,CAC9B,IAAIa,EAASb,KAAKC,SAASC,mBAAmBC,KAAKC,UAAUQ,MACzDE,EAAO,+DAA+DC,OAAOF,GAC7EG,EAAgB,OAAOD,OAAOD,EAAM,OACxC,MAAO,CAAC7F,GAAS8F,OAAO,CAACC,IAAgB1B,KAAK,KAChD,CACA,MAAO,CAACrE,GAASqE,KAAK,KACxB,C,0ECZIzE,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAOC,GAAI,8UACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,2DAA2D,MAAQ,GAAG,SAAW,kGAAkG,eAAiB,CAAC,syBAA+yB,WAAa,MAE/hC,S,0ECLIH,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAOC,GAAI,8YACtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,yDAAyD,MAAQ,GAAG,SAAW,oIAAoI,eAAiB,CAAC,8vBAAqwB,WAAa,MAErhC,S,aCLA,IAAIC,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACF,EAAOC,GAAIC,EAAS,MAC7DA,EAAQG,SAAQL,EAAOM,QAAUJ,EAAQG,SAG/BE,EADH,UACO,WAAYL,GAAS,EAAO,CAAC,OAAQ,G,aCNtD,IAAIA,EAAU,EAAQ,KACnBA,EAAQC,aAAYD,EAAUA,EAAQE,SACnB,iBAAZF,IAAsBA,EAAU,CAAC,CAACF,EAAOC,GAAIC,EAAS,MAC7DA,EAAQG,SAAQL,EAAOM,QAAUJ,EAAQG,SAG/BE,EADH,UACO,WAAYL,GAAS,EAAO,CAAC,OAAQ,G,SCHtDF,EAAOM,QAAU,SAAU4F,GACzB,IAAIxF,EAAO,GA4EX,OAzEAA,EAAKyF,SAAW,WACd,OAAOC,KAAKC,IAAI,SAAUtF,GACxB,IAAIb,EAAU,GACVoG,OAA+B,IAAZvF,EAAK,GAoB5B,OAnBIA,EAAK,KACPb,GAAW,cAAc8F,OAAOjF,EAAK,GAAI,QAEvCA,EAAK,KACPb,GAAW,UAAU8F,OAAOjF,EAAK,GAAI,OAEnCuF,IACFpG,GAAW,SAAS8F,OAAOjF,EAAK,GAAGD,OAAS,EAAI,IAAIkF,OAAOjF,EAAK,IAAM,GAAI,OAE5Eb,GAAWgG,EAAuBnF,GAC9BuF,IACFpG,GAAW,KAETa,EAAK,KACPb,GAAW,KAETa,EAAK,KACPb,GAAW,KAENA,CACT,GAAGqE,KAAK,GACV,EAGA7D,EAAKG,EAAI,SAAW0F,EAASrF,EAAOsF,EAAQC,EAAUC,GAC7B,iBAAZH,IACTA,EAAU,CAAC,CAAC,KAAMA,OAASI,KAE7B,IAAIC,EAAyB,CAAC,EAC9B,GAAIJ,EACF,IAAK,IAAIK,EAAI,EAAGA,EAAIT,KAAKtF,OAAQ+F,IAAK,CACpC,IAAI5G,EAAKmG,KAAKS,GAAG,GACP,MAAN5G,IACF2G,EAAuB3G,IAAM,EAEjC,CAEF,IAAK,IAAI6G,EAAK,EAAGA,EAAKP,EAAQzF,OAAQgG,IAAM,CAC1C,IAAI/F,EAAO,GAAGiF,OAAOO,EAAQO,IACzBN,GAAUI,EAAuB7F,EAAK,WAGrB,IAAV2F,SACc,IAAZ3F,EAAK,KAGdA,EAAK,GAAK,SAASiF,OAAOjF,EAAK,GAAGD,OAAS,EAAI,IAAIkF,OAAOjF,EAAK,IAAM,GAAI,MAAMiF,OAAOjF,EAAK,GAAI,MAF/FA,EAAK,GAAK2F,GAMVxF,IACGH,EAAK,IAGRA,EAAK,GAAK,UAAUiF,OAAOjF,EAAK,GAAI,MAAMiF,OAAOjF,EAAK,GAAI,KAC1DA,EAAK,GAAKG,GAHVH,EAAK,GAAKG,GAMVuF,IACG1F,EAAK,IAGRA,EAAK,GAAK,cAAciF,OAAOjF,EAAK,GAAI,OAAOiF,OAAOjF,EAAK,GAAI,KAC/DA,EAAK,GAAK0F,GAHV1F,EAAK,GAAK,GAAGiF,OAAOS,IAMxB/F,EAAKX,KAAKgB,GACZ,CACF,EACOL,CACT,C,GCnFIqG,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBN,IAAjBO,EACH,OAAOA,EAAa5G,QAGrB,IAAIN,EAAS+G,EAAyBE,GAAY,CACjDhH,GAAIgH,EAEJ3G,QAAS,CAAC,GAOX,OAHA6G,EAAoBF,GAAUjH,EAAQA,EAAOM,QAAS0G,GAG/ChH,EAAOM,OACf,CCKO,SAAS8G,EAAgBC,EAAeC,GAC7C,IAAKD,EACH,OAAO,KAET,MAAME,EAAY,CAACC,EAAiBC,KAC9BH,IACFE,EAAUE,iBAAiBF,IAEtB,IAAIG,OAAOH,EAASC,IAE7B,IACE,MAAMG,EAAQP,EAAMO,MAAM,qBAC1B,IAAKA,EACH,OAAOL,EAAUM,EAAEC,aAAaT,GAAQ,KAE1C,GAAIO,EAAM,KAAO,iCAAiCxF,KAAKwF,EAAM,IAC3D,OAAOL,EAAUF,EAAO,KAE1B,IAAII,EAAQG,EAAM,IAAM,GAKxB,OAJAC,EAAEE,KAAKN,EAAO,MACc,IAAxBA,EAAMO,QAAQ,OAChBP,GAAgB,KAEXF,EAAUK,EAAM,GAAIH,EAC7B,CAAE,MACA,OAAO,IACT,CACF,CCPO,SAASQ,EAAuBhI,GAKrC,MAAMiI,EAAYC,cACZC,EAAO,mBAAmBnI,IAE1BoI,EAAuB,KAC3B,MAAMC,EAAqBT,EAAEU,IAAIC,OAAOC,OAAQL,EAAM,IAAIM,KAC1D,OAAOb,EAAEc,EAAE,kBAAkBC,KAAK,uBAAuBC,WACtDxC,IAAIyC,GAAWC,OAAOJ,EAAEG,GAASE,KAAK,oBACtC3E,OAAOyE,GAAWR,EAAmBW,IAAIH,IACzCI,QAYL,OATArB,EAAEtE,OAAOiF,OAAOC,OAAQL,EAAOe,QACfxC,IAAVwC,EACK,IAAIT,IAAI,CAACR,KAElBiB,EAAM5I,IAAI2H,GACHiB,IAETC,UAAUhB,EAAMC,KAET,CACLgB,WAAY,KACVxB,EAAEtE,OAAOiF,OAAOC,OAAQL,EAAOe,SACfxC,IAAVwC,GACFA,EAAMG,OAAOpB,GAERiB,IAETC,UAAUhB,EAAMC,MAElBA,uBACAkB,sBAAwBC,GAAkDC,QAAQrB,EAAMoB,GAE5F,CCpFAxC,EAAoB0C,EAAK1J,IACxB,IAAI2J,EAAS3J,GAAUA,EAAOG,WAC7B,IAAOH,EAAiB,QACxB,IAAM,EAEP,OADAgH,EAAoB4C,EAAED,EAAQ,CAAEE,EAAGF,IAC5BA,GCLR3C,EAAoB4C,EAAI,CAACtJ,EAASwJ,KACjC,IAAI,IAAInE,KAAOmE,EACX9C,EAAoB+C,EAAED,EAAYnE,KAASqB,EAAoB+C,EAAEzJ,EAASqF,IAC5EqE,OAAOC,eAAe3J,EAASqF,EAAK,CAAEuE,YAAY,EAAM3B,IAAKuB,EAAWnE,MCJ3EqB,EAAoB+C,EAAI,CAACzG,EAAK6G,IAAUH,OAAOI,UAAUC,eAAeC,KAAKhH,EAAK6G,GCClFnD,EAAoBuD,EAAKjK,IACH,oBAAXkK,QAA0BA,OAAOC,aAC1CT,OAAOC,eAAe3J,EAASkK,OAAOC,YAAa,CAAEtB,MAAO,WAE7Da,OAAOC,eAAe3J,EAAS,aAAc,CAAE6I,OAAO,KCLvD,MAAM,EAA+BuB,ICA/B,EAA+BC,ECC/BC,EAAc,EAAAD,EACfE,OAAO,CACRC,KAAM,EAAAH,EAAEI,SAAS3K,QAAQ,UACzB4K,UAAW,EAAAL,EACNE,OAAO,CACRzH,KAAM,EAAAuH,EAAEM,KAAK,CAAC,QAAS,UAAW,iBAAkB,WAAW7K,QAAQ,kBACvE+I,MAAO,EAAAwB,EAAEI,SAAS3K,QAAQ,UAEzB8K,SAAS,CAAC,GACVC,UAAUpF,IACX,OAAQA,EAAK3C,MACT,IAAK,QACD2C,EAAKoD,MAAQ,IACb,MACJ,IAAK,UACDpD,EAAKoD,MAAQ,KACb,MACJ,IAAK,iBACDpD,EAAKoD,MAAQ,OAKrB,OAAOpD,IAEXqF,wCAAyC,EAAAT,EAAEU,UAAUjL,SAAQ,GAC7DkL,gBAAiB,EAAAX,EACZE,OAAO,CACRzH,KAAM,EAAAuH,EAAEM,KAAK,CAAC,QAAS,WAAY,WAAW7K,QAAQ,UACtDmL,YAAa,EAAAZ,EAAEM,KAAK,CAAC,OAAQ,YAAa,WAAW7K,QAAQ,aAC7DoL,YAAa,EAAAb,EAAEI,SAAS3K,QAAQ,gBAChCqL,YAAa,EAAAd,EAAEI,SAAS3K,QAAQ,iBAChCsL,iBAAkB,EAAAf,EAAEI,SAAS3K,QAAQ,UACrCuL,iBAAkB,EAAAhB,EAAEI,SAAS3K,QAAQ,WACrCwL,cAAe,EAAAjB,EAAEI,SAAS3K,QAAQ,UAClCyL,cAAe,EAAAlB,EAAEI,SAAS3K,QAAQ,aAEjC8K,SAAS,CAAC,GACfY,YAAa,EAAAnB,EAAEI,SAAS3K,QAAQ,cAAc2L,MAAM,gBAEnDZ,UAAUpF,GACJiG,EAASC,MAAM,CAClBC,UAAWnG,EAAKiF,UAChBc,YAAa/F,EAAK+F,YAClBK,gBAAiB,CACbC,UAAW,GACXC,MAAO,CACHC,QAASvG,EAAKqF,wCACdhI,KAAM,UACNmJ,YAAa,wBAEjBC,MAAO,CACHF,QAASvG,EAAKqF,wCACdhI,KAAM,UACNmJ,YAAa,yBAGrBE,aAAc,IACP1G,EAAKuF,gBACRlI,KAAoC,WAA9B2C,EAAKuF,gBAAgBlI,KAAoB,kBAAoB,oBAIlE4I,EAAW,EAAArB,EACnBE,OAAO,CACRqB,UAAW,EAAAvB,EACNE,OAAO,CACRzH,KAAM,EAAAuH,EAAEM,KAAK,CAAC,QAAS,UAAW,iBAAkB,WAAW7K,QAAQ,kBACvE+I,MAAO,EAAAwB,EAAEI,SAAS3K,QAAQ,UAEzB8K,SAAS,CAAC,GACVC,UAAUpF,IACX,OAAQA,EAAK3C,MACT,IAAK,QACD2C,EAAKoD,MAAQ,IACb,MACJ,IAAK,UACDpD,EAAKoD,MAAQ,KACb,MACJ,IAAK,iBACDpD,EAAKoD,MAAQ,OAKrB,OAAOpD,IAEX+F,YAAa,EAAAnB,EAAEI,SAAS3K,QAAQ,cAAc2L,MAAM,cACpDI,gBAAiB,EAAAxB,EACZE,OAAO,CACRuB,UAAW,EAAAzB,EAAE+B,SAASC,MAAMC,IAAI,GAAGxM,QAAQ,IAAI2L,MAAM,IACrDM,MAAO,EAAA1B,EACFE,OAAO,CACRyB,QAAS,EAAA3B,EAAEU,UAAUjL,SAAQ,GAC7BgD,KAAM,EAAAuH,EAAEM,KAAK,CAAC,UAAW,gBAAgB7K,QAAQ,WACjDmM,YAAa,EAAA5B,EAAEI,SAAS3K,QAAQ,0BAE/B8K,SAAS,CAAC,GACfsB,MAAO,EAAA7B,EACFE,OAAO,CACRyB,QAAS,EAAA3B,EAAEU,UAAUjL,SAAQ,GAC7BgD,KAAM,EAAAuH,EAAEM,KAAK,CAAC,UAAW,gBAAgB7K,QAAQ,WACjDmM,YAAa,EAAA5B,EAAEI,SAAS3K,QAAQ,0BAE/B8K,SAAS,CAAC,KAEdA,SAAS,CAAC,GACfuB,aAAc,EAAA9B,EACTE,OAAO,CACRzH,KAAM,EAAAuH,EAAEM,KAAK,CAAC,gBAAiB,oBAAoB7K,QAAQ,mBAC3DmL,YAAa,EAAAZ,EAAEM,KAAK,CAAC,OAAQ,YAAa,WAAW7K,QAAQ,aAC7DoL,YAAa,EAAAb,EAAEI,SAAS3K,QAAQ,gBAChCqL,YAAa,EAAAd,EAAEI,SAAS3K,QAAQ,iBAChCsL,iBAAkB,EAAAf,EAAEI,SAAS3K,QAAQ,UACrCuL,iBAAkB,EAAAhB,EAAEI,SAAS3K,QAAQ,WACrCwL,cAAe,EAAAjB,EAAEI,SAAS3K,QAAQ,UAClCyL,cAAe,EAAAlB,EAAEI,SAAS3K,QAAQ,aAEjC8K,SAAS,CAAC,KAEdA,SAAS,CAAC,GACF2B,EAAmB,EAAY,WAAY,KACpD,MAAMC,EAAYC,aAAa,CAAE3J,KAAM,SAAU8E,UAAWC,gBACtD6E,GAAW,IAAAC,MAAKpF,EAAEoB,IAAI6D,EAAW,aAAelC,EAAcoB,GAAUC,MAAMa,IAC9EI,GAAgB,IAAAD,MAAI,GAC1BhF,EAAuB,UAAUsB,sBAAsB4D,IACnDD,EAAc/D,MAAQgE,IAAwBhF,iBAElD,IAAAiF,aAAY,KACRC,wBAAwB,EAAML,EAAS7D,OAAQ,CAAE/F,KAAM,SAAU8E,UAAWC,kBAQhF,MAAO,CAAE6E,WAAUE,gBAAeI,kBANPlF,IAChB,IAAAmF,UAAS,CACZhF,IAAK,IAAMV,EAAEU,IAAIyE,EAAS7D,MAAOf,GAAMoF,QAAQ,MAAO,OACtDC,IAAKtE,GAAStB,EAAE4F,IAAIT,EAAS7D,MAAOf,EAAMe,EAAMqE,QAAQ,OAAQ,YCrItEE,EAAa,CAAEC,MAAO,0CACtBC,EAAa,CAAED,MAAO,mBAC5B,GAA6B,qBAAiB,CAC1CE,OAAQ,QACRrI,MAAO,CACHsI,MAAO,CAAC,GAEZC,MAAMC,GACK,CAACC,EAAMC,MACF,kBAAc,wBAAoB,MAAOR,EAAY,EACzD,wBAAoB,QAASE,EAAY,EACrC,wBAAoB,OAAQ,MAAM,qBAAiBI,EAAQF,OAAQ,IACnE,gBAAYG,EAAKE,OAAQ,mBAE7B,gBAAYF,EAAKE,OAAQ,gB,oBCVzC,MAEA,GAFiC,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBCJvE,GAA6B,qBAAiB,CAC1CN,OAAQ,WACRrI,MAAO,CACH4I,KAAM,CAAC,GAEXL,MAAMC,GAQK,CAACC,EAAMC,MACF,kBAAc,wBAAoB,IAAK,CAC3CP,MAAO,gEACPU,KAAM,SACNC,SAAU,IACVC,QAASL,EAAO,KAAOA,EAAO,GAAMM,IAAW,OAZhCtO,EAY+C8N,EAAQI,UAX1EK,YAAYC,iBAAiBxO,EAASuO,YAAYE,WAAWC,KAAM,GAAI,CACnEC,wBAAwB,EACxBC,WAAW,EACXC,MAAM,IAJd,IAAuB7O,S,OCF/B,MAEA,GAFiC,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBCJjE,EAAa,CAAEyN,MAAO,mCACtB,EAAa,CAAEhI,IAAK,GCE1B,GDD6B,qBAAiB,CAC1CkI,OAAQ,OACRrI,MAAO,CACHsI,MAAO,CAAC,GAEZC,MAAMC,GAEK,CAACC,EAAMC,MACF,kBAAc,wBAAoB,MAAO,EAAY,CACxDF,EAAa,QACP,kBAAc,wBAAoB,OAAQ,GAAY,qBAAiBA,EAAQF,OAAQ,KACxF,wBAAoB,QAAQ,IAClC,gBAAYG,EAAKE,OAAQ,gBEdnC,EAAa,CAAER,MAAO,4CACtB,EAAa,CAAEA,MAAO,qBACtBqB,EAAa,CAAErB,MAAO,qDAC5B,GAA6B,qBAAiB,CAC1CE,OAAQ,UACRrI,MAAO,CACHsI,MAAO,CAAC,GAEZC,MAAMC,GACK,CAACC,EAAMC,MACF,kBAAc,wBAAoB,MAAO,EAAY,EACzD,wBAAoB,MAAO,EAAY,EACnC,wBAAoB,SAAU,KAAM,EAChC,wBAAoB,OAAQ,MAAM,qBAAiBF,EAAQF,OAAQ,MAEvE,gBAAYG,EAAKE,OAAQ,mBAE7B,wBAAoB,MAAOa,EAAY,EACnC,gBAAYf,EAAKE,OAAQ,kB,OCd7C,MAEA,GAFiC,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBCFjE,EAAa,CAAC,SCCpB,GDA6B,qBAAiB,CAC1CN,OAAQ,SACRrI,OAAqB,iBAAa,CAC9BxD,QAAS,CAAC,GACX,CACC,WAAc,CAAEiN,UAAU,GAC1B,eAAkB,CAAC,IAEvBC,MAAO,CAAC,qBACR,KAAAnB,CAAMC,GACF,MAAMmB,GAAQ,cAAUnB,EAAS,cAC3BxI,EAAQwI,EACRhM,GAAU,IAAAuL,UAAS,IAAM/H,EAAMxD,QAAQqE,IAAI+I,GAA6B,iBAAXA,EAAsB,CAAEtB,MAAOsB,EAAQjG,MAAOiG,GAAWA,IAC5H,MAAO,CAACnB,EAAMC,KACH,sBAAiB,kBAAc,wBAAoB,SAAU,CAChE,sBAAuBA,EAAO,KAAOA,EAAO,GAAMM,GAAY,EAAQrF,MAAQqF,GAC9Eb,MAAO,aACR,GACE,gBAAW,IAAO,wBAAoB,WAAW,MAAM,iBAAY,WAAO3L,GAAU,EAAG8L,QAAO3E,aACnF,kBAAc,wBAAoB,SAAU,CAChDxD,IAAKwD,EACLA,MAAOA,IACR,qBAAiB2E,GAAQ,EAAqB,KACjD,OACL,MAAwB,CACvB,CAAC,eAAeqB,EAAMhG,QAGlC,IEtBJ,MCNA,GCI6B,qBAAiB,CAC1C0E,OAAQ,cACR,KAAAE,CAAMC,GACF,MAAMqB,EAAQxC,IACRyC,EAAoBD,EAAM/B,kBAAkB,4BAC5CiC,EAAoBF,EAAM/B,kBAAkB,4BAC5CkC,EAAyBH,EAAM/B,kBAAkB,iCACjDmC,EAAyBJ,EAAM/B,kBAAkB,iCACjDoC,EAAsBL,EAAM/B,kBAAkB,8BAC9CqC,EAAsBN,EAAM/B,kBAAkB,8BACpD,MAAO,CAACW,EAAMC,MACF,kBAAc,iBAAa0B,EAAS,CAAE9B,MAAO,UAAY,CAC7D,gBAAgB,aAAS,IAAM,EAC3B,iBAAa+B,EAAU,CAAEzB,MAAM,WFrBxC,2tBEqBqE,KAAM,EAAe,CAAC,WAEtFhO,SAAS,aAAS,IAAM,EACpB,iBAAa0P,EAAQ,CACjBC,YAAY,WAAOV,GAAOrC,SAASP,aAAarJ,KAChD,sBAAuB8K,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASP,aAAiB,KAAI+B,GAC3GxM,QAAS,CACL,CAAE8L,MAAO,cAAe3E,MAAO,iBAC/B,CAAE2E,MAAO,WAAY3E,MAAO,qBAEjC,KAAM,EAAe,CAAC,eACqB,qBAA7C,WAAOkG,GAAOrC,SAASP,aAAarJ,OAC9B,kBAAc,wBAAoB,WAAW,CAAEuC,IAAK,GAAK,EACxD,iBAAaqK,EAAO,CAAElC,MAAO,aAAe,CACxC1N,SAAS,aAAS,IAAM,EACpB,iBAAa0P,EAAQ,CACjBC,YAAY,WAAOV,GAAOrC,SAASP,aAAalB,YAChD,sBAAuB2C,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASP,aAAwB,YAAI+B,GAClHxM,QAAS,CACL,CAAE8L,MAAO,KAAM3E,MAAO,QACtB,CAAE2E,MAAO,KAAM3E,MAAO,aACtB,CAAE2E,MAAO,KAAM3E,MAAO,YAE3B,KAAM,EAAe,CAAC,iBAE7BtB,EAAG,KAEP,iBAAamI,EAAO,CAAElC,MAAO,UAAY,CACrC1N,SAAS,aAAS,IAAM,EACpB,iBAAa6P,EAAM,CAAEnC,MAAO,QAAU,CAClC1N,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAY,WAAOc,GAAqB,EAAoBnG,MAAQqF,EAAS,MAC/Hb,MAAO,2BACPvK,KAAM,OACN8M,aAAc,OACf,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAOZ,QAG7BzH,EAAG,KAEP,iBAAaoI,EAAM,CAAEnC,MAAO,QAAU,CAClC1N,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAY,WAAOe,GAAqB,EAAoBpG,MAAQqF,EAAS,MAC/Hb,MAAO,2BACPvK,KAAM,OACN8M,aAAc,OACf,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAOX,QAG7B1H,EAAG,KAEP,iBAAaoI,EAAM,CAAEnC,MAAO,QAAU,CAClC1N,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAY,WAAOgB,GAA0B,EAAyBrG,MAAQqF,EAAS,MACzIb,MAAO,2BACPvK,KAAM,OACN8M,aAAc,OACf,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAOV,QAG7B3H,EAAG,KAEP,iBAAaoI,EAAM,CAAEnC,MAAO,QAAU,CAClC1N,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAY,WAAOiB,GAA0B,EAAyBtG,MAAQqF,EAAS,MACzIb,MAAO,2BACPvK,KAAM,OACN8M,aAAc,OACf,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAOT,QAG7B5H,EAAG,KAEP,iBAAaoI,EAAM,CAAEnC,MAAO,QAAU,CAClC1N,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAY,WAAOkB,GAAuB,EAAsBvG,MAAQqF,EAAS,MACnIb,MAAO,2BACPvK,KAAM,OACN8M,aAAc,OACf,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAOR,QAG7B7H,EAAG,KAEP,iBAAaoI,EAAM,CAAEnC,MAAO,QAAU,CAClC1N,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAY,WAAOmB,GAAuB,EAAsBxG,MAAQqF,EAAS,MACnIb,MAAO,2BACPvK,KAAM,OACN8M,aAAc,OACf,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAOP,QAG7B9H,EAAG,MAGXA,EAAG,KAER,MACD,wBAAoB,QAAQ,KAEtCA,EAAG,IAGf,IChIJ,MCLA,GCE6B,qBAAiB,CAC1CgG,OAAQ,YACR,KAAAE,CAAMC,GACF,MAAMqB,EAAQxC,IACRX,EAAYmD,EAAM/B,kBAAkB,mBAC1C,MAAO,CAACW,EAAMC,MACF,kBAAc,iBAAa0B,EAAS,CAAE9B,MAAO,eAAiB,CAClE,gBAAgB,aAAS,IAAM,EAC3B,iBAAa+B,EAAU,CAAEzB,MAAM,WFdxC,wcEckE,KAAM,EAAe,CAAC,WAEnFhO,SAAS,aAAS,IAAM,EACpB,iBAAa0P,EAAQ,CACjBC,YAAY,WAAOV,GAAOrC,SAASd,UAAU9I,KAC7C,sBAAuB8K,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASd,UAAc,KAAIsC,GACxGxM,QAAS,CACL,CAAE8L,MAAO,KAAM3E,MAAO,SACtB,CAAE2E,MAAO,KAAM3E,MAAO,WACtB,CAAE2E,MAAO,MAAO3E,MAAO,kBACvB,CAAE2E,MAAO,MAAO3E,MAAO,YAE5B,KAAM,EAAe,CAAC,eACkB,YAA1C,WAAOkG,GAAOrC,SAASd,UAAU9I,MAC5B,sBAAiB,kBAAc,wBAAoB,QAAS,CAC1DuC,IAAK,EACL,sBAAuBuI,EAAO,KAAOA,EAAO,GAAMM,IAAY,WAAOtC,GAAa,EAAY/C,MAAQqF,EAAS,MAC/Gb,MAAO,2BACPvK,KAAM,OACN8M,aAAc,OACf,KAAM,MAAwB,CAC7B,CAAC,cAAa,WAAOhE,OAEvB,wBAAoB,QAAQ,KAEtCrE,EAAG,IAGf,ICzCE,EAAa,CAAE8F,MAAO,kBCG5B,GDF6B,qBAAiB,CAC1CE,OAAQ,WACRrI,MAAO,CACH,WAAc,CAAEpC,KAAMkB,QAAc2K,UAAU,GAC9C,eAAkB,CAAC,GAEvBC,MAAO,CAAC,qBACR,KAAAnB,CAAMC,GACF,MAAMmB,GAAQ,cAAUnB,EAAS,cACjC,MAAO,CAACC,EAAMC,MACF,kBAAc,wBAAoB,QAAS,EAAY,EAC3D,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuBA,EAAO,KAAOA,EAAO,GAAMM,GAAY,EAAQrF,MAAQqF,GAC9EpL,KAAM,YACP,KAAM,KAAuB,CAC5B,CAAC,iBAAiB+L,EAAMhG,UAE5B,gBAAY8E,EAAKE,OAAQ,aAGrC,IEpBJ,MCEA,GCG6B,qBAAiB,CAC1CN,OAAQ,iBACR,KAAAE,CAAMC,GACF,MAAMqB,EAAQxC,IACd,MAAO,CAACoB,EAAMC,MACF,kBAAc,iBAAa0B,EAAS,CAAE9B,MAAO,YAAc,CAC/D,gBAAgB,aAAS,IAAM,EAC3B,iBAAa+B,EAAU,CAAEzB,MAAM,WFdxC,2mBEcwE,KAAM,EAAe,CAAC,WAEzFhO,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASb,gBAAyB,UAAIqC,GACnHpL,KAAM,SACNwJ,IAAK,IACLe,MAAO,4BACR,KAAM,KAAuB,CAC5B,CACI,cACA,WAAO0B,GAAOrC,SAASb,gBAAgBC,eAClC,EACL,CAAEM,QAAQ,OAGlB,iBAAayD,EAAU,CACnBJ,YAAY,WAAOV,GAAOrC,SAASb,gBAAgBE,MAAMC,QACzD,sBAAuB4B,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASb,gBAAgBE,MAAa,QAAImC,IACxH,CACCpO,SAAS,aAAS,IAAM,EACpB,wBAAoB,OAAQ,KAAM,QAAS,sBAAiB,WAAOiP,GAAOrC,SAASb,gBAAgBC,WAAa,cAAe,KAEnIvE,EAAG,GACJ,EAAe,CAAC,gBAClB,WAAOwH,GAAOrC,SAASb,gBAAgBE,MAAa,UAC9C,kBAAc,iBAAayD,EAAQ,CAClCnK,IAAK,EACLoK,YAAY,WAAOV,GAAOrC,SAASb,gBAAgBE,MAAMjJ,KACzD,sBAAuB8K,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASb,gBAAgBE,MAAU,KAAImC,GACpH4B,MAAO,CAAE,MAAS,MAAO,aAAc,YACvCpO,QAAS,CACL,CAAE8L,MAAO,eAAgB3E,MAAO,WAChC,CAAE2E,MAAO,WAAU,WAAOuB,GAAOrC,SAASb,gBAAgBE,MAAME,kBAAmBpD,MAAO,iBAE/F,KAAM,EAAe,CAAC,aAAc,cACrC,wBAAoB,QAAQ,IAClC,iBAAagH,EAAU,CACnBJ,YAAY,WAAOV,GAAOrC,SAASb,gBAAgBK,MAAMF,QACzD,sBAAuB4B,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASb,gBAAgBK,MAAa,QAAIgC,IACxH,CACCpO,SAAS,aAAS,IAAM,EACpB,wBAAoB,OAAQ,KAAM,QAAS,sBAAiB,WAAOiP,GAAOrC,SAASb,gBAAgBC,WAAa,aAAc,KAElIvE,EAAG,GACJ,EAAe,CAAC,gBAClB,WAAOwH,GAAOrC,SAASb,gBAAgBK,MAAa,UAC9C,kBAAc,iBAAasD,EAAQ,CAClCnK,IAAK,EACLoK,YAAY,WAAOV,GAAOrC,SAASb,gBAAgBK,MAAMpJ,KACzD,sBAAuB8K,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAASb,gBAAgBK,MAAU,KAAIgC,GACpH4B,MAAO,CAAE,MAAS,MAAO,aAAc,YACvCpO,QAAS,CACL,CAAE8L,MAAO,YAAa3E,MAAO,WAC7B,CAAE2E,MAAO,WAAU,WAAOuB,GAAOrC,SAASb,gBAAgBK,MAAMD,kBAAmBpD,MAAO,iBAE/F,KAAM,EAAe,CAAC,aAAc,cACrC,wBAAoB,QAAQ,KAEtCtB,EAAG,IAGf,IC/DJ,MCTA,GCC6B,qBAAiB,CAC1CgG,OAAQ,OACR,KAAAE,CAAMC,GACF,MAAMqB,EAAQxC,IACd,MAAO,CAACoB,EAAMC,MACF,kBAAc,iBAAa0B,EAAS,CAAE9B,MAAO,SAAW,CAC5D,gBAAgB,aAAS,IAAM,EAC3B,iBAAa+B,EAAU,CAAEzB,MAAM,WFZxC,4mBEY6D,KAAM,EAAe,CAAC,WAE9EhO,SAAS,aAAS,IAAM,EACpB,qBAAgB,wBAAoB,QAAS,CACzC,sBAAuB8N,EAAO,KAAOA,EAAO,GAAMM,IAAa,WAAOa,GAAOrC,SAAoB,YAAIwB,GACrGb,MAAO,2BACPvK,KAAM,OACNmJ,YAAa,eACb2D,aAAc,OACf,KAAM,KAAuB,CAC5B,CAAC,cAAa,WAAOb,GAAOrC,SAASlB,iBAG7CjE,EAAG,IAGf,IC3BE,EAAa,CACflC,IAAK,EACLgI,MAAO,iBAEL,EAAa,CAAEA,MAAO,yBCD5B,GDO6B,qBAAiB,CAC1CE,OAAQ,QACR,KAAAE,CAAMC,GACF,MAAMqB,EAAQxC,IACd,MAAO,CAACoB,EAAMC,KACF,WAAOmB,GAAoB,gBAC5B,kBAAc,wBAAoB,MAAO,EAAY,CACpDnB,EAAO,KAAOA,EAAO,IAAK,wBAAoB,MAAO,CAAEP,MAAO,6CAA+C,EACzG,wBAAoB,IAAK,KAAM,WAC/B,wBAAoB,MAAO,CAAEA,MAAO,8DACpC,KACJ,wBAAoB,MAAO,EAAY,EACnC,iBAAa0C,IACb,iBAAaC,IACb,iBAAaC,IACb,iBAAaC,SAGnB,wBAAoB,QAAQ,EAE1C,IE3BG,SAASC,IACd,MAAMC,GAAM,IAAAC,WAAUC,GAAOC,IAAI,KAE3BC,ElC0BCnI,EAAE,SAASK,KAAK,YAAab,ekC1BH4I,SAAS,yBAC1CL,EAAIM,MAAMF,EAAK,IAEf,MAAM,QAAEG,GlCCH,SACLC,EAA2G,QAE3G,MAAMC,EAAOxI,EAAE,SACZK,KAAK,YAAab,eAClBiJ,OAAOzI,EAAE,eAAgBrH,UAAU+P,SACnCN,SAASG,GAEZ,MAAO,CACLD,QAAS,IAAME,EAAK3N,SAExB,CkCZsB8N,GAEpB,MAAO,CACLL,QAAS,KACPP,EAAIa,UACJT,EAAKtN,SACLyN,KAGN,CCkFA,SAASO,EAAezG,GACtB,OAAOlD,EAAEkD,GACN0G,MAAM,MACNC,UAAUC,IAASA,EAAKC,QACxBC,eAAeF,IAASA,EAAKC,QAC7BrN,KAAK,KACV,CAEA,SAASuN,EAAmBC,GAC1B,OAAOA,EAAQ1N,OAAO,EAAGnE,aAAiC,KAAnBA,EAAQ0R,OACjD,CAEA,SAASI,EAAoBD,EAAmB/E,GAC9C,OpCxGK,SAAoBiF,EAAYC,GACrC,GAAqB,IAAjBD,EAAMnR,OACR,MAAO,GAGT,MAAMqR,EAAgB,CAAC,CAACF,EAAM,KAC9B,IAAK,MAAOG,EAAKC,KAAQxK,EAAEyK,IAAIzK,EAAE0K,UAAUN,GAAQpK,EAAE2K,KAAKP,IACpDC,EAAUE,EAAMC,GAClBF,EAAOA,EAAOrR,OAAS,GAAGf,KAAKsS,GAE/BF,EAAOpS,KAAK,CAACsS,IAGjB,OAAOF,CACT,CoC0FSM,CAAQV,EAAS,CAACK,EAAKC,IAAQD,EAAI/D,OAASgE,EAAIhE,MAAMhI,IAAIqM,IAAS,CACxErE,KAAMqE,EAAM,GAAGrE,KACfnO,QAASwS,EAAMrM,IAAI,EAAGnG,aAAcsR,EAAetR,IAAUqE,KAAKyI,EAASd,UAAU/C,SAEzF,CA4BA,SAASwJ,EAAY3F,EAAoB4F,EAAwBC,GAC/D,MAAMC,EAAgB,EAAGC,UAAoDC,KAC3E,GAAIA,IAAYH,IACd,OAGF,GAAIE,EAAOE,KAAK,EAAG/S,aAAiC,iBAAZA,GAEtC,OAIF,MAAMiS,EAnGV,SAAyBJ,EAAmBa,GAC1C,MAAMM,EAAanB,EAAQoB,UAAU,EAAGjT,aAAcA,EAAQkT,SAASR,EAAWlR,KAAKxB,UACjFmT,EAAatB,EAAQoB,UAAU,EAAGjT,aAAcA,EAAQkT,SAASR,EAAWU,KAAKpT,UACjFqT,EAAaxB,EAAQoB,UAAU,EAAGjT,aAAcA,EAAQkT,SAASR,EAAWY,KAAKtT,UACvF,IAAoB,IAAhBgT,IAAqC,IAAhBG,IAAqC,IAAhBE,EAC5C,OAAO,KAGT,MAAME,EAAqB,CACzBC,EACAC,EACAC,EACAC,KAEA,GAAIF,IAAiBC,EACnB,OAAO7B,EAAQ6B,GAAe1T,QAAQuR,MAAMoC,GAE9C,MAAMC,EAAWJ,EAAgB,GAAGjC,MAAMoC,GAE1C,OADAH,EAAgB,GAAK,GACdI,GAGHC,EAAgBN,EAAmB,CAAC,GAAI,KAAM,EAAGP,EAAYN,EAAWlR,KAAKxB,SAC7E8T,EAAgBP,EAAmBM,EAAeb,EAAYG,EAAYT,EAAWU,KAAKpT,SAC1F+T,EAAgBR,EAAmBO,EAAeX,EAAYE,EAAYX,EAAWY,KAAKtT,SAEhG,MAAO,CACL,IAAI6R,EAAQmC,MAAM,EAAGhB,GAAa,CAAE7E,KAAM0D,EAAQmB,GAAY7E,KAAMnO,QAAS6T,EAAc,KAC3F,CACE,CAAE1F,KAAM0D,EAAQmB,GAAY7E,KAAMnO,QAAS6T,EAAc,OACtDhC,EAAQmC,MAAMhB,EAAa,EAAGG,GACjC,CAAEhF,KAAM0D,EAAQsB,GAAYhF,KAAMnO,QAAS8T,EAAc,KAE3D,CACE,CAAE3F,KAAM0D,EAAQsB,GAAYhF,KAAMnO,QAAS8T,EAAc,OACtDjC,EAAQmC,MAAMb,EAAa,EAAGE,GACjC,CAAElF,KAAM0D,EAAQwB,GAAYlF,KAAMnO,QAAS+T,EAAc,KAE3D,CAAC,CAAE5F,KAAM0D,EAAQwB,GAAYlF,KAAMnO,QAAS+T,EAAc,OAASlC,EAAQmC,MAAMX,EAAa,IAElG,CA2DmBY,CAAgBpB,EAAQH,GACvC,GAAe,OAAXT,EACF,OAGF,MAAM,MAAE9F,EAAK,MAAEG,GAAUQ,EAASb,gBAE5BiI,EAAiB,CAACC,EAAkCC,EAAcC,KACtE,IAAKF,EAAmB/H,QACtB,OAGF,MAAMkI,EAA8BC,KACvB,WAAXA,EAAEpG,MACAhC,EAAMC,SAA0B,gBAAfD,EAAMjJ,MAA0BqR,EAAEvU,QAAQkT,SAAS/G,EAAME,cAC1EC,EAAMF,SAA0B,gBAAfE,EAAMpJ,MAA0BqR,EAAEvU,QAAQkT,SAAS5G,EAAMD,cAExEmI,EACwB,gBAA5BL,EAAmBjR,KACf0O,EAAmBK,EAAOmC,IACvBjQ,OAAOmQ,GACPnO,IAAIoO,GAAKjD,EAAeiD,EAAEvU,UAC1BqE,KAAKyI,EAASd,UAAU/C,OAC3B,GAEN,GAC8B,gBAA5BkL,EAAmBjR,MACnByE,EAAEsK,GACCwC,UACA1B,KAAKwB,GAAKA,EAAEvU,QAAQkT,SAASiB,EAAmB9H,cAEnD1E,EAAErE,OAAO2O,EAAOmC,GAAOE,OAClB,CACL,MAAMI,EAAgB/M,EAAErE,OAAO2O,EAAOmC,GAAOG,GAAgB,WAAXA,EAAEpG,MACpD8D,EAAOoC,GAAMA,EAAKD,EAAOzM,EAAE7B,OAAOmM,EAAOoC,GAAKK,GAAiB/M,EAAE7B,OAAO4O,EAAezC,EAAOoC,GAChG,CACA1M,EAAEsK,GACCwC,UACAtQ,OAAOoQ,GAAKA,EAAEvU,QAAQkT,SAASiB,EAAmB9H,cAClDsI,QAAQJ,IACPA,EAAEvU,QAAUuU,EAAEvU,QAAQ4U,WAAWT,EAAmB9H,YAAamI,MAGvEN,EAAe/H,EAAO,EAAG,GACzB+H,EAAe5H,EAAO,EAAG,GAEzB,MAAO9K,EAAMqT,EAAoBC,EAAoBxB,GAAQ3L,EAAEsK,GAC5D9L,IAAI0L,GAAWD,EAAmBC,IAClC1L,IAAI0L,GAAWC,EAAoBD,EAAS/E,IAC5C7D,QAEH,IAAI8L,EACJ,OAAQjI,EAASP,aAAarJ,MAC5B,IAAK,gBACH6R,EAASjD,EAAoBnK,EAAE7B,OAAOtE,EAAMqT,EAAoBC,EAAoBxB,GAAOxG,GAC3F,MACF,IAAK,kBACHiI,EAASpN,EAAE7B,OAAOtE,EA/F1B,SAA2BqQ,EAAmB/E,GAE5C,MAAMpB,EAAgBlE,iBAAiBsF,EAASP,aAAab,eACvDC,EAAgBnE,iBAAiBsF,EAASP,aAAaZ,eACvDH,EAAmBhE,iBAAiBsF,EAASP,aAAaf,kBAC1DC,EAAmBjE,iBAAiBsF,EAASP,aAAad,kBAC1DH,EAAc9D,iBAAiBsF,EAASP,aAAajB,aACrDC,EAAc/D,iBAAiBsF,EAASP,aAAahB,aAC3D,MAAO,CACL4C,KAAMrB,EAASP,aAAalB,YAC5BrL,QAAS6R,EACN1L,IAAI,EAAGgI,OAAMnO,cACZ,MAAMgV,EAAU1D,EAAetR,GAC/B,OAAQmO,GACN,IAAK,SACH,OAAOzC,EAAgBsJ,EAAUrJ,EACnC,IAAK,YACH,OAAOH,EAAmBwJ,EAAUvJ,EACtC,IAAK,OACH,OAAOH,EAAc0J,EAAUzJ,KAGpClH,KAAKyI,EAASd,UAAU/C,OAE/B,CAuEgCgM,CAAkBtN,EAAE7B,OAAO+O,EAAoBC,GAAqBhI,GAAWwG,GpCnNxG,IAA0B4B,EAAkBC,IoCuNzBJ,GpCvNOG,EoCuNfrC,GpCtNJjS,OAAS,EACrBsU,EAAYrV,QAAQsV,IoCuNdC,EAAiB,EAAGC,eACxBzC,EAAc,CAAEC,OAAQwC,IAAY,IAGlC,EAAQC,mBAAoB,SAAU,KACxC/L,QAAQgM,cAAcC,oBAAqB5C,GAE3CrJ,QAAQgM,cAAcE,+BAAgCL,GAGxD,MAAMM,EAA4BC,IAChC,IAAK7I,EAASlB,cAAgB+G,IAC5B,OAEF,MAAMiD,EAAQ1O,EAAgB4F,EAASlB,aAAa,GAC/CgK,GAGDA,EAAM1T,KAAKyT,IACbpH,YAAYsH,kBAGhBtM,QAAQgM,cAAcO,sBAAuBJ,GAE7C,MAAMK,EAA6BC,MAAOC,IACxC,IAAKnJ,EAASlB,cAAgB+G,IAC5B,OAGF,MAAMuD,EAAe3H,YAAY4H,KAAKC,OAAOH,IAEvCL,EAAQ1O,EAAgB4F,EAASlB,aAAa,GACpD,IAAKgK,EACH,OAEF,MAAMlO,EAAQwO,EAAaG,IAAI3O,MAAMkO,GACjClO,IACFwO,EAAaG,IAAMH,EAAaG,IAAIrC,MAAM,EAAGtM,EAAMzD,OAC/CiS,EAAaI,QACf3O,EAAE4F,IAAI2I,EAAc,CAAC,SAAUA,EAAaK,UAAYL,EAAaG,KAGvE9H,YAAYiI,mBAAmBJ,OAAOH,GAAaC,SAC7C3H,YAAYkI,aAKtB,OAFAlN,QAAQgM,cAAcmB,iBAAkBX,GAEjC,CACLY,SAAU,KACRC,oBAAoBrB,cAAcC,oBAAqB5C,GACvDgE,oBAAoBrB,cAAcE,+BAAgCL,GAClEwB,oBAAoBrB,cAAcO,sBAAuBJ,GACzDkB,oBAAoBrB,cAAcmB,iBAAkBX,IAG1D,CAEO,SAASc,EAAW/J,GACzB,MAAM,WAAE3D,EAAU,qBAAEhB,GAAyBJ,EAAuB,WAC9D,WAAE2K,EAAU,SAAEoE,GAzQf,SAA0BhK,GAC/B,MAAM4F,EAAmC5I,OAAOiN,OAAO,CACrDvV,KAAM,CACJzB,GAAI,kBACJiX,SAAU,UACVC,MAAO,KACP9I,KAAM,YACNnO,QAAS,qBAEXoT,KAAM,CACJrT,GAAI,aACJiX,SAAU,UACVC,MAAOnK,EAASb,gBAAgBC,UAChCiC,KAAM,SACNnO,QAAS,iBAEXsT,KAAM,CACJvT,GAAI,iBACJiX,SAAU,UACVC,MAAO,EACP9I,KAAM,SACNnO,QAAS,uBAIPkX,EAAS,CAACC,EAAeC,EAAiBtE,KAC1CA,GAGJuE,cAAcvN,OAAOwN,OAAO5E,KAI9B,OAFAnJ,QAAQgM,cAAcgC,0BAA2BL,GAE1C,CACLxE,aACAoE,SAAU,KACRF,oBAAoBrB,cAAcgC,0BAA2BL,GAC7DM,gBAAgB1N,OAAOwN,OAAO5E,GAAYvM,IAAI,EAAGpG,QAASA,KAGhE,CAiOmC0X,CAAiB3K,IAC5C,SAAE6J,GAAalE,EAAY3F,EAAU4F,EAAY,IAAMvK,MAA2BF,eACxF,MAAO,CACL8I,QAAS,KACP5H,IACAwN,IACAG,KAGN,CC9RArO,EAAE,MrC2DKuN,eAAmC0B,EAAkBC,GACtD,QAAcC,yBAA0BF,EAAU,MACpDG,OAAOC,MAAM,IAAIH,mBAAuBD,KAAa,QAEzD,CqC9DIK,CAAoB,SAAU,UpCJ3B/B,eAA0BgC,GAC/B,MAAMC,QAAeC,MAAMF,GAC3B,IAAKC,EAAOE,GACV,OAAO,EAET,MAAMC,QAAoBH,EAAOtC,OACjC0C,kBAAkBD,EAEpB,CoCHIE,CAAW,wFACX,MAAQvH,QAASwH,GAAiBhI,IAClC,IAAIiI,GACJ,IAAAC,OAAM,IAAM9L,IAAmBG,SAAU4L,IACrCF,MACAA,EAAgB3B,EAAW6B,GAAa3H,SACzC,CAAE4H,WAAW,EAAMvF,MAAM,IAC5B3K,EAAEH,QAAQsQ,GAAG,WAAY,KACrBL,IACAC","sources":["webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue?12df","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue?1939","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue?cba2","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue?1657","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue?426b","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue?3bc0","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/util/script.ts","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/store.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Field.vue?95ac","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue?b4a3","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Item.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Item.vue?e68e","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Section.vue?7087","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Select.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Select.vue?219f","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/chat_history.md?88be","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/ChatHistory.vue?5b19","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/ChatHistory.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/delimiter.md?9ef7","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Delimiter.vue?576e","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Delimiter.vue","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Checkbox.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/component/Checkbox.vue?4722","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/depth_injection.md?89c4","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/DepthInjection.vue?7f4b","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/DepthInjection.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/help/stop.md?39cf","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Stop.vue?2f4f","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Stop.vue","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Panel.vue","webpack://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/Panel.vue?5e8b","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/panel/index.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/squash.ts","src://tavern_helper_template/src/酒馆助手/压缩相邻消息/index.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.TR-help-icon[data-v-43141e14]{cursor:pointer}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/酒馆助手/压缩相邻消息/panel/component/HelpIcon.vue\"],\"names\":[],\"mappings\":\"AAsBA,+BACE,cACF\",\"sourcesContent\":[\"<template>\\n  <i\\n    class=\\\"fa-solid fa-circle-question fa-sm note-link-span TR-help-icon\\\"\\n    role=\\\"button\\\"\\n    tabindex=\\\"0\\\"\\n    @click=\\\"showHelpPopup(help)\\\"\\n  />\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\ndefineProps<{ help: string }>();\\n\\nfunction showHelpPopup(content: string) {\\n  SillyTavern.callGenericPopup(content, SillyTavern.POPUP_TYPE.TEXT, '', {\\n    allowVerticalScrolling: true,\\n    leftAlign: true,\\n    wide: true,\\n  });\\n}\\n</script>\\n\\n<style scoped>\\n.TR-help-icon {\\n  cursor: pointer;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"5d9044fa\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.TR-section[data-v-399ec098]{border:1px solid var(--SmartThemeBorderColor,rgba(45,45,45,1));border-radius:10px;padding:0.6rem 0.75rem;gap:0.45rem;background-color:rgba(0,0,0,0.08);background-color:color-mix(in srgb,var(--SmartThemeBlurTintColor,rgba(31,31,31,1)) 75%,transparent)}.TR-section__content[data-v-399ec098]{gap:0.5rem}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/酒馆助手/压缩相邻消息/panel/component/Section.vue\"],\"names\":[],\"mappings\":\"AAmBA,6BACE,8DAAmE,CACnE,kBAAmB,CACnB,sBAAuB,CACvB,WAAY,CACZ,iCAAqC,CACrC,mGACF,CAEA,sCACE,UACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"TR-section flex-container flexFlowColumn\\\">\\n    <div class=\\\"TR-section__title\\\">\\n      <strong>\\n        <span>{{ label }}</span>\\n      </strong>\\n      <slot name=\\\"label-suffix\\\" />\\n    </div>\\n    <div class=\\\"TR-section__content flex-container flexFlowColumn\\\">\\n      <slot />\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\ndefineProps<{ label: string }>();\\n</script>\\n\\n<style scoped>\\n.TR-section {\\n  border: 1px solid var(--SmartThemeBorderColor, rgba(45, 45, 45, 1));\\n  border-radius: 10px;\\n  padding: 0.6rem 0.75rem;\\n  gap: 0.45rem;\\n  background-color: rgba(0, 0, 0, 0.08);\\n  background-color: color-mix(in srgb, var(--SmartThemeBlurTintColor, rgba(31, 31, 31, 1)) 75%, transparent);\\n}\\n\\n.TR-section__content {\\n  gap: 0.5rem;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.TR-field[data-v-75b81b74]{padding:0.45rem 0.6rem;gap:0.25rem;border:1px solid color-mix(in srgb,var(--SmartThemeBorderColor,rgba(45,45,45,1)) 35%,transparent);border-radius:10px;background-color:color-mix(in srgb,var(--SmartThemeBlurTintColor,rgba(31,31,31,1)) 55%,transparent)}.TR-field__label[data-v-75b81b74]{display:inline-flex;align-items:center;gap:0.35rem;font-weight:600;opacity:0.95}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/酒馆助手/压缩相邻消息/panel/component/Field.vue\"],\"names\":[],\"mappings\":\"AAeA,2BACE,sBAAuB,CACvB,WAAY,CACZ,iGAAwG,CACxG,kBAAmB,CACnB,mGACF,CAEA,kCACE,mBAAoB,CACpB,kBAAmB,CACnB,WAAY,CACZ,eAAgB,CAChB,YACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"TR-field flex-container flexFlowColumn\\\">\\n    <label class=\\\"TR-field__label\\\">\\n      <span>{{ label }}</span>\\n      <slot name=\\\"label-suffix\\\" />\\n    </label>\\n    <slot />\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\ndefineProps<{ label: string }>();\\n</script>\\n\\n<style scoped>\\n.TR-field {\\n  padding: 0.45rem 0.6rem;\\n  gap: 0.25rem;\\n  border: 1px solid color-mix(in srgb, var(--SmartThemeBorderColor, rgba(45, 45, 45, 1)) 35%, transparent);\\n  border-radius: 10px;\\n  background-color: color-mix(in srgb, var(--SmartThemeBlurTintColor, rgba(31, 31, 31, 1)) 55%, transparent);\\n}\\n\\n.TR-field__label {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 0.35rem;\\n  font-weight: 600;\\n  opacity: 0.95;\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"0c113507\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"28ead210\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../../../../node_modules/.pnpm/css-loader@7.1.2_webpack@5.104.1/node_modules/css-loader/dist/cjs.js??clonedRuleSet-844.use[1]!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/stylePostLoader.js!../../../../../node_modules/.pnpm/postcss-loader@8.2.0_postcss@8.5.6_typescript@6.0.0-dev.20250807_webpack@5.104.1/node_modules/postcss-loader/dist/cjs.js!../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { compare } from 'compare-versions';\nimport JSON5 from 'json5';\nimport { jsonrepair } from 'jsonrepair';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string, replace_macros?: boolean): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  const makeRegex = (pattern: string, flags: string) => {\n    if (replace_macros) {\n      pattern = substitudeMacros(pattern);\n    }\n    return new RegExp(pattern, flags);\n  };\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return makeRegex(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return makeRegex(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return makeRegex(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n\nexport function literalYamlify(value: any) {\n  return YAML.stringify(value, { blockQuote: 'literal' });\n}\n\nexport function parseString(content: string): any {\n  let parsed: unknown;\n  try {\n    parsed = YAML.parseDocument(content, { merge: true }).toJS();\n  } catch (yaml_error) {\n    try {\n      parsed = JSON5.parse(content);\n    } catch (json5_error) {\n      try {\n        parsed = JSON.parse(jsonrepair(content));\n      } catch (json_error) {\n        const toError = (error: unknown) => (error instanceof Error ? error.message : String(error));\n        throw new Error(\n          literalYamlify({\n            ['要解析的字符串不是有效的 YAML/JSON 格式']: {\n              字符串内容: content,\n              YAML错误信息: toError(yaml_error),\n              JSON5错误信息: toError(json5_error),\n              尝试修复JSON时的错误信息: toError(json_error),\n            },\n          }),\n        );\n      }\n    }\n  }\n  return parsed;\n}\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n\nexport function registerAsUniqueScript(id: string): {\n  unregister: () => void;\n  getPreferredScriptId: () => string | undefined;\n  listenPreferenceState: (callback: (perferred_script_id: string) => void) => EventOnReturn;\n} {\n  const script_id = getScriptId();\n  const path = `th_unique_check.${id}`;\n\n  const getPreferredScriptId = () => {\n    const registered_scripts = _.get(window.parent, path, new Set<string>());\n    return _($('#tavern_helper').find('div[data-script-id]').toArray())\n      .map(element => String($(element).attr('data-script-id')))\n      .filter(element => registered_scripts.has(element))\n      .last();\n  };\n\n  _.update(window.parent, path, (value: Set<string> | undefined) => {\n    if (value === undefined) {\n      return new Set([script_id]);\n    }\n    value.add(script_id);\n    return value;\n  });\n  eventEmit(path, getPreferredScriptId());\n\n  return {\n    unregister: () => {\n      _.update(window.parent, path, (value: Set<string> | undefined) => {\n        if (value !== undefined) {\n          value.delete(script_id);\n        }\n        return value;\n      });\n      eventEmit(path, getPreferredScriptId());\n    },\n    getPreferredScriptId,\n    listenPreferenceState: (callback: (enabled_script_id: string) => void) => eventOn(path, callback),\n  };\n}\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { registerAsUniqueScript } from '@util/script';\nconst OldSettings = z\n    .object({\n    name: z.string().default('压缩相邻消息'),\n    seperator: z\n        .object({\n        type: z.enum(['space', 'newline', 'double newline', 'custom']).default('double newline'),\n        value: z.string().default('\\n\\n'),\n    })\n        .prefault({})\n        .transform(data => {\n        switch (data.type) {\n            case 'space':\n                data.value = ' ';\n                break;\n            case 'newline':\n                data.value = '\\n';\n                break;\n            case 'double newline':\n                data.value = '\\n\\n';\n                break;\n            case 'custom':\n                break;\n        }\n        return data;\n    }),\n    put_system_injection_after_chat_history: z.boolean().default(false),\n    on_chat_history: z\n        .object({\n        type: z.enum(['mixin', 'seperate', 'squash']).default('squash'),\n        squash_role: z.enum(['user', 'assistant', 'system']).default('assistant'),\n        user_prefix: z.string().default('[{{user}}]\\n'),\n        user_suffix: z.string().default('\\n[/{{user}}]'),\n        assistant_prefix: z.string().default('[剧情]\\n'),\n        assistant_suffix: z.string().default('\\n[/剧情]'),\n        system_prefix: z.string().default('[设定]\\n'),\n        system_suffix: z.string().default('\\n[/设定]'),\n    })\n        .prefault({}),\n    stop_string: z.string().default('<|im_end|>').catch('<|im_end|>'),\n})\n    .transform(data => {\n    return Settings.parse({\n        delimiter: data.seperator,\n        stop_string: data.stop_string,\n        depth_injection: {\n            threshold: 10,\n            above: {\n                enabled: data.put_system_injection_after_chat_history,\n                type: 'exclude',\n                placeholder: `{{压缩相邻消息::above_dx}}`,\n            },\n            below: {\n                enabled: data.put_system_injection_after_chat_history,\n                type: 'exclude',\n                placeholder: `{{压缩相邻消息::below_dx}}`,\n            },\n        },\n        chat_history: {\n            ...data.on_chat_history,\n            type: data.on_chat_history.type === 'squash' ? 'squash_into_one' : 'squash_nearby',\n        },\n    });\n});\nexport const Settings = z\n    .object({\n    delimiter: z\n        .object({\n        type: z.enum(['space', 'newline', 'double newline', 'custom']).default('double newline'),\n        value: z.string().default('\\n\\n'),\n    })\n        .prefault({})\n        .transform(data => {\n        switch (data.type) {\n            case 'space':\n                data.value = ' ';\n                break;\n            case 'newline':\n                data.value = '\\n';\n                break;\n            case 'double newline':\n                data.value = '\\n\\n';\n                break;\n            case 'custom':\n                break;\n        }\n        return data;\n    }),\n    stop_string: z.string().default('<|im_end|>').catch('<|im_end|>'),\n    depth_injection: z\n        .object({\n        threshold: z.number().int().min(1).default(10).catch(10),\n        above: z\n            .object({\n            enabled: z.boolean().default(false),\n            type: z.enum(['exclude', 'placeholder']).default('exclude'),\n            placeholder: z.string().default('{{压缩相邻消息::above_dx}}'),\n        })\n            .prefault({}),\n        below: z\n            .object({\n            enabled: z.boolean().default(false),\n            type: z.enum(['exclude', 'placeholder']).default('exclude'),\n            placeholder: z.string().default('{{压缩相邻消息::below_dx}}'),\n        })\n            .prefault({}),\n    })\n        .prefault({}),\n    chat_history: z\n        .object({\n        type: z.enum(['squash_nearby', 'squash_into_one']).default('squash_into_one'),\n        squash_role: z.enum(['user', 'assistant', 'system']).default('assistant'),\n        user_prefix: z.string().default('[{{user}}]\\n'),\n        user_suffix: z.string().default('\\n[/{{user}}]'),\n        assistant_prefix: z.string().default('[剧情]\\n'),\n        assistant_suffix: z.string().default('\\n[/剧情]'),\n        system_prefix: z.string().default('[设定]\\n'),\n        system_suffix: z.string().default('\\n[/设定]'),\n    })\n        .prefault({}),\n})\n    .prefault({});\nexport const useSettingsStore = defineStore('settings', () => {\n    const variables = getVariables({ type: 'script', script_id: getScriptId() });\n    const settings = ref((_.has(variables, 'seperator') ? OldSettings : Settings).parse(variables));\n    const should_enable = ref(false);\n    registerAsUniqueScript('压缩相邻消息').listenPreferenceState(preferred_script_id => {\n        should_enable.value = preferred_script_id === getScriptId();\n    });\n    watchEffect(() => {\n        insertOrAssignVariables(klona(settings.value), { type: 'script', script_id: getScriptId() });\n    });\n    const useEscapedNewline = (path) => {\n        return computed({\n            get: () => _.get(settings.value, path).replace(/\\n/g, '\\\\n'),\n            set: value => _.set(settings.value, path, value.replace(/\\\\n/g, '\\n')),\n        });\n    };\n    return { settings, should_enable, useEscapedNewline };\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderSlot as _renderSlot, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"TR-field flex-container flexFlowColumn\" };\nconst _hoisted_2 = { class: \"TR-field__label\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Field',\n    props: {\n        label: {}\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"label\", _hoisted_2, [\n                    _createElementVNode(\"span\", null, _toDisplayString(__props.label), 1 /* TEXT */),\n                    _renderSlot(_ctx.$slots, \"label-suffix\")\n                ]),\n                _renderSlot(_ctx.$slots, \"default\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Field.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Field.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./Field.vue?vue&type=style&index=0&id=75b81b74&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-75b81b74\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'HelpIcon',\n    props: {\n        help: {}\n    },\n    setup(__props) {\n        function showHelpPopup(content) {\n            SillyTavern.callGenericPopup(content, SillyTavern.POPUP_TYPE.TEXT, '', {\n                allowVerticalScrolling: true,\n                leftAlign: true,\n                wide: true,\n            });\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"i\", {\n                class: \"fa-solid fa-circle-question fa-sm note-link-span TR-help-icon\",\n                role: \"button\",\n                tabindex: \"0\",\n                onClick: _cache[0] || (_cache[0] = ($event) => (showHelpPopup(__props.help)))\n            }));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./HelpIcon.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./HelpIcon.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./HelpIcon.vue?vue&type=style&index=0&id=43141e14&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-43141e14\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderSlot as _renderSlot } from \"vue\";\nconst _hoisted_1 = { class: \"flex-container alignitemscenter\" };\nconst _hoisted_2 = { key: 0 };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Item',\n    props: {\n        label: {}\n    },\n    setup(__props) {\n        const props = __props;\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                (__props.label)\n                    ? (_openBlock(), _createElementBlock(\"span\", _hoisted_2, _toDisplayString(__props.label), 1 /* TEXT */))\n                    : _createCommentVNode(\"v-if\", true),\n                _renderSlot(_ctx.$slots, \"default\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Item.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Item.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderSlot as _renderSlot, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"TR-section flex-container flexFlowColumn\" };\nconst _hoisted_2 = { class: \"TR-section__title\" };\nconst _hoisted_3 = { class: \"TR-section__content flex-container flexFlowColumn\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Section',\n    props: {\n        label: {}\n    },\n    setup(__props) {\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                    _createElementVNode(\"strong\", null, [\n                        _createElementVNode(\"span\", null, _toDisplayString(__props.label), 1 /* TEXT */)\n                    ]),\n                    _renderSlot(_ctx.$slots, \"label-suffix\")\n                ]),\n                _createElementVNode(\"div\", _hoisted_3, [\n                    _renderSlot(_ctx.$slots, \"default\")\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Section.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Section.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./Section.vue?vue&type=style&index=0&id=399ec098&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.26_typescript@6.0.0-dev.20250807__webpack@5.104.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-399ec098\"]])\n\nexport default __exports__","import { useModel as _useModel, mergeModels as _mergeModels, defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, withDirectives as _withDirectives } from \"vue\";\n\nimport { computed } from 'vue';\nconst _hoisted_1 = [\"value\"];\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Select',\n    props: /*@__PURE__*/ _mergeModels({\n        options: {}\n    }, {\n        \"modelValue\": { required: true },\n        \"modelModifiers\": {},\n    }),\n    emits: [\"update:modelValue\"],\n    setup(__props) {\n        const model = _useModel(__props, \"modelValue\");\n        const props = __props;\n        const options = computed(() => props.options.map(option => (typeof option === 'string' ? { label: option, value: option } : option)));\n        return (_ctx, _cache) => {\n            return _withDirectives((_openBlock(), _createElementBlock(\"select\", {\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((model).value = $event)),\n                class: \"text_pole\"\n            }, [\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(options), ({ label, value }) => {\n                    return (_openBlock(), _createElementBlock(\"option\", {\n                        key: value,\n                        value: value\n                    }, _toDisplayString(label), 9 /* TEXT, PROPS */, _hoisted_1));\n                }), 128 /* KEYED_FRAGMENT */))\n            ], 512 /* NEED_PATCH */)), [\n                [_vModelSelect, model.value]\n            ]);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Select.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Select.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","// Module\nvar code = `<h1>处理聊天历史</h1> <p>酒馆的聊天历史 (预设中的 Chat History 条目) 记录了玩家和 AI 的每楼层提示词, 也就是实际游玩的内容.</p> <p>聊天记录往往是一问一答的: 一条用户输入、一条 AI 输出、一条用户输入……AI 团队可能针对这种对话进行了一些特殊训练, 而我们游玩酒馆恰因为这些训练出现问题 (出现八股、文风变差之类的).</p> <p>因此本脚本允许你对聊天历史进行额外处理:</p> <ul> <li>仅合并相邻同身份提示词: 将聊天历史中相邻且身份相同的提示词合并, 例如世界书条目 A 和 B 都插入到 D1 作为系统提示词, 则会被合并成一条提示词</li> <li><strong>压缩为单条提示词</strong>: 先合并相邻同身份提示词, 再将整个聊天历史压缩为一条提示词</li> </ul> <p>其中, 压缩为单条提示词就是为了避免受 AI 团队对人机对话的训练影响. 它将原本的一问一答附上相应的身份前后缀, 然后合并成一条提示词, 例如:</p> <pre><code class=\"language-text\">{{user}}:\n我输入了一段话\n\n剧情:\nAI 根据输入的话生成了一段文本\n\n{{user}}:\n我又输入了一段话\n</code></pre> <p>不过, 由于聊天记录被压缩成单条提示词发给 AI, AI 可能误认为它就该输出这样的一长串对话.</p> <p>为了避免它自问自答, 你可以在停止字符串中填入它应该在什么时候中止输出. (对于上面的例子, 我们可以填写 <code>{{user}}:</code> 作为停止字符串.)</p> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./ChatHistory.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./ChatHistory.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, withCtx as _withCtx, isRef as _isRef, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createBlock as _createBlock } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport Field from './component/Field.vue';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Item from './component/Item.vue';\nimport Section from './component/Section.vue';\nimport Select from './component/Select.vue';\nimport chat_history_help from './help/chat_history.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'ChatHistory',\n    setup(__props) {\n        const store = useSettingsStore();\n        const user_prefix_input = store.useEscapedNewline('chat_history.user_prefix');\n        const user_suffix_input = store.useEscapedNewline('chat_history.user_suffix');\n        const assistant_prefix_input = store.useEscapedNewline('chat_history.assistant_prefix');\n        const assistant_suffix_input = store.useEscapedNewline('chat_history.assistant_suffix');\n        const system_prefix_input = store.useEscapedNewline('chat_history.system_prefix');\n        const system_suffix_input = store.useEscapedNewline('chat_history.system_suffix');\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"处理聊天历史\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(chat_history_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _createVNode(Select, {\n                        modelValue: _unref(store).settings.chat_history.type,\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.chat_history.type) = $event)),\n                        options: [\n                            { label: '仅合并相邻同身份提示词', value: 'squash_nearby' },\n                            { label: '压缩为单条提示词', value: 'squash_into_one' },\n                        ]\n                    }, null, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.chat_history.type === 'squash_into_one')\n                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                            _createVNode(Field, { label: \"压缩后的提示词身份\" }, {\n                                default: _withCtx(() => [\n                                    _createVNode(Select, {\n                                        modelValue: _unref(store).settings.chat_history.squash_role,\n                                        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((_unref(store).settings.chat_history.squash_role) = $event)),\n                                        options: [\n                                            { label: '用户', value: 'user' },\n                                            { label: '助手', value: 'assistant' },\n                                            { label: '系统', value: 'system' },\n                                        ]\n                                    }, null, 8 /* PROPS */, [\"modelValue\"])\n                                ]),\n                                _: 1 /* STABLE */\n                            }),\n                            _createVNode(Field, { label: \"提示词前后缀\" }, {\n                                default: _withCtx(() => [\n                                    _createVNode(Item, { label: \"用户前缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => (_isRef(user_prefix_input) ? (user_prefix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(user_prefix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"用户后缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => (_isRef(user_suffix_input) ? (user_suffix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(user_suffix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"助手前缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => (_isRef(assistant_prefix_input) ? (assistant_prefix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(assistant_prefix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"助手后缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event) => (_isRef(assistant_suffix_input) ? (assistant_suffix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(assistant_suffix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"系统前缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[6] || (_cache[6] = ($event) => (_isRef(system_prefix_input) ? (system_prefix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(system_prefix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    }),\n                                    _createVNode(Item, { label: \"系统后缀\" }, {\n                                        default: _withCtx(() => [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[7] || (_cache[7] = ($event) => (_isRef(system_suffix_input) ? (system_suffix_input).value = $event : null)),\n                                                class: \"text_pole flex1 wide100p\",\n                                                type: \"text\",\n                                                autocomplete: \"off\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(system_suffix_input)]\n                                            ])\n                                        ]),\n                                        _: 1 /* STABLE */\n                                    })\n                                ]),\n                                _: 1 /* STABLE */\n                            })\n                        ], 64 /* STABLE_FRAGMENT */))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","// Module\nvar code = `<h1>合并消息时的间隔文本</h1> <p>当发给 AI 的两条提示词合并时, 两条提示词的文本也会被合并. 但当文本合并时, 它们之间往往需要用额外文本间隔起来.</p> <p>例如, 一条提示词是:</p> <pre><code class=\"language-text\">用户:\n你好, 我是张三.\n</code></pre> <p>另一条提示词是:</p> <pre><code class=\"language-text\">助手:\n你好, 我是李四.\n</code></pre> <p>当这两条提示词合并时, 如果我们什么间隔文本都不加, 将会变成:</p> <pre><code class=\"language-text\">用户:\n你好, 我是张三.助手:\n你好, 我是李四.\n</code></pre> <p>显然这容易让 AI 产生误解, 因此我们需要在它们之间添加间隔文本.</p> <p>一般来说, 双换行是比较好的间隔文本, 因此脚本默认为你选择了双换行.</p> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./Delimiter.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Delimiter.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, isRef as _isRef, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, withCtx as _withCtx, createBlock as _createBlock } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Section from './component/Section.vue';\nimport Select from './component/Select.vue';\nimport delimiter_help from './help/delimiter.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Delimiter',\n    setup(__props) {\n        const store = useSettingsStore();\n        const delimiter = store.useEscapedNewline('delimiter.value');\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"合并提示词时的间隔文本\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(delimiter_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _createVNode(Select, {\n                        modelValue: _unref(store).settings.delimiter.type,\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.delimiter.type) = $event)),\n                        options: [\n                            { label: '空格', value: 'space' },\n                            { label: '换行', value: 'newline' },\n                            { label: '双换行', value: 'double newline' },\n                            { label: '自定义', value: 'custom' },\n                        ]\n                    }, null, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.delimiter.type === 'custom')\n                        ? _withDirectives((_openBlock(), _createElementBlock(\"input\", {\n                            key: 0,\n                            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => (_isRef(delimiter) ? (delimiter).value = $event : null)),\n                            class: \"text_pole flex1 wide100p\",\n                            type: \"text\",\n                            autocomplete: \"off\"\n                        }, null, 512 /* NEED_PATCH */)), [\n                            [_vModelText, _unref(delimiter)]\n                        ])\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","import { useModel as _useModel, defineComponent as _defineComponent } from 'vue';\nimport { vModelCheckbox as _vModelCheckbox, createElementVNode as _createElementVNode, withDirectives as _withDirectives, renderSlot as _renderSlot, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"checkbox_label\" };\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Checkbox',\n    props: {\n        \"modelValue\": { type: Boolean, ...{ required: true } },\n        \"modelModifiers\": {},\n    },\n    emits: [\"update:modelValue\"],\n    setup(__props) {\n        const model = _useModel(__props, \"modelValue\");\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"label\", _hoisted_1, [\n                _withDirectives(_createElementVNode(\"input\", {\n                    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((model).value = $event)),\n                    type: \"checkbox\"\n                }, null, 512 /* NEED_PATCH */), [\n                    [_vModelCheckbox, model.value]\n                ]),\n                _renderSlot(_ctx.$slots, \"default\")\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Checkbox.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Checkbox.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","// Module\nvar code = `<h1>处理 D⚙ 条目</h1> <p>按照<a href=\"https://discord.com/channels/1134557553011998840/1413538722078785576\">一些预设作者和角色卡作者的说法</a>, Gemini 和 Claude 不同, 不必将条目插入聊天记录中, 插入其中反而会干扰聊天记录的连续性, 重要条目应该都插入到 D0.</p> <p>但玩家依旧可能使用 Claude、GPT 等游玩, 而对它们还是需要用 D4 等深度的.</p> <p>因此本脚本提供了处理深度条目功能, 允许你特殊处理特定深度 (Dx) 以上和以下的系统深度条目 (D⚙ 条目):</p> <ul> <li>将它们按顺序插入到 D9999/D0: 如果说法无误, 几乎所有预设都能从中获得好处, 而不会产生负面影响</li> <li>或将它们合并成一条文本, 并替换到占位符位置: 预设可以赋予这些条目特殊的语义, 就像有的预设为 AI 把 \"角色定义之前/之后\" 部分定义成 <code>additional_settings</code> 那样</li> </ul> <hr> <p><strong>注意</strong>: 这些选项虽然已经不用角色卡作者自行将条目全设置为 D0，但仍很需要角色卡适配；如果角色详情等会随剧情发展的设定放在了深度条目，则勾选这些选项容易使角色固化。</p> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./DepthInjection.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./DepthInjection.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, toDisplayString as _toDisplayString, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport Checkbox from './component/Checkbox.vue';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Section from './component/Section.vue';\nimport Select from './component/Select.vue';\nimport depth_injection_help from './help/depth_injection.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'DepthInjection',\n    setup(__props) {\n        const store = useSettingsStore();\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"处理 D⚙ 条目\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(depth_injection_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _withDirectives(_createElementVNode(\"input\", {\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.depth_injection.threshold) = $event)),\n                        type: \"number\",\n                        min: \"0\",\n                        class: \"text_pole flex1 wide100p\"\n                    }, null, 512 /* NEED_PATCH */), [\n                        [\n                            _vModelText,\n                            _unref(store).settings.depth_injection.threshold,\n                            void 0,\n                            { number: true }\n                        ]\n                    ]),\n                    _createVNode(Checkbox, {\n                        modelValue: _unref(store).settings.depth_injection.above.enabled,\n                        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((_unref(store).settings.depth_injection.above.enabled) = $event))\n                    }, {\n                        default: _withCtx(() => [\n                            _createElementVNode(\"span\", null, \"处理 D\" + _toDisplayString(_unref(store).settings.depth_injection.threshold) + \" 及以上的 D⚙ 条目\", 1 /* TEXT */)\n                        ]),\n                        _: 1 /* STABLE */\n                    }, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.depth_injection.above.enabled)\n                        ? (_openBlock(), _createBlock(Select, {\n                            key: 0,\n                            modelValue: _unref(store).settings.depth_injection.above.type,\n                            \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => ((_unref(store).settings.depth_injection.above.type) = $event)),\n                            style: { \"width\": \"90%\", \"align-self\": \"flex-end\" },\n                            options: [\n                                { label: '按顺序插入到 D9999', value: 'exclude' },\n                                { label: `合并后替换到 ${_unref(store).settings.depth_injection.above.placeholder} 宏位置`, value: 'placeholder' },\n                            ]\n                        }, null, 8 /* PROPS */, [\"modelValue\", \"options\"]))\n                        : _createCommentVNode(\"v-if\", true),\n                    _createVNode(Checkbox, {\n                        modelValue: _unref(store).settings.depth_injection.below.enabled,\n                        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => ((_unref(store).settings.depth_injection.below.enabled) = $event))\n                    }, {\n                        default: _withCtx(() => [\n                            _createElementVNode(\"span\", null, \"处理 D\" + _toDisplayString(_unref(store).settings.depth_injection.threshold) + \" 以下的 D⚙ 条目\", 1 /* TEXT */)\n                        ]),\n                        _: 1 /* STABLE */\n                    }, 8 /* PROPS */, [\"modelValue\"]),\n                    (_unref(store).settings.depth_injection.below.enabled)\n                        ? (_openBlock(), _createBlock(Select, {\n                            key: 1,\n                            modelValue: _unref(store).settings.depth_injection.below.type,\n                            \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => ((_unref(store).settings.depth_injection.below.type) = $event)),\n                            style: { \"width\": \"90%\", \"align-self\": \"flex-end\" },\n                            options: [\n                                { label: '按顺序插入到 D0', value: 'exclude' },\n                                { label: `合并后替换到 ${_unref(store).settings.depth_injection.below.placeholder} 宏位置`, value: 'placeholder' },\n                            ]\n                        }, null, 8 /* PROPS */, [\"modelValue\", \"options\"]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","// Module\nvar code = `<h1>停止字符串</h1> <p>如果填入停止字符串, 则 AI 输出了对应文本时将会直接停止输出. 停止字符串可以是字符串或正则, 如 <code>User:</code> 或 <code>/User:|System:/</code>.</p> <p>这可以避免 AI 在输出完剧情后自己和自己对话. 例如, AI 直接回复了以下内容:</p> <pre><code class=\"language-text\">&#x3C;|im_start|> assistant\n剧情……\n&#x3C;|im_end|>\n\n&#x3C;|im_start|> user\nAI 自己作为 user 继续发送消息了!\n&#x3C;|im_end|>\n\n&#x3C;|im_start|> assistant\n剧情……\n&#x3C;|im_end|>\n</code></pre> <p>那么可以把 <code>&#x3C;|im_end|></code> 作为停止字符串.</p> <p>这样一来,</p> <ul> <li>对于流式传输: 当 AI 输出完剧情, 输出到 <code>&#x3C;|im_end|></code> 时, 就会直接停止输出</li> <li>对于非流式传输: 当 AI 回复后, 脚本会删去 <code>&#x3C;|im_end|></code> 及以后的所有文本</li> </ul> `;\n// Exports\nexport default code;","/* unplugin-vue-components disabled */import script from \"./Stop.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Stop.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createVNode as _createVNode, vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nimport { useSettingsStore } from '../store';\nimport HelpIcon from './component/HelpIcon.vue';\nimport Section from './component/Section.vue';\nimport stop_help from './help/stop.md';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Stop',\n    setup(__props) {\n        const store = useSettingsStore();\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createBlock(Section, { label: \"停止字符串\" }, {\n                \"label-suffix\": _withCtx(() => [\n                    _createVNode(HelpIcon, { help: _unref(stop_help) }, null, 8 /* PROPS */, [\"help\"])\n                ]),\n                default: _withCtx(() => [\n                    _withDirectives(_createElementVNode(\"input\", {\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => ((_unref(store).settings.stop_string) = $event)),\n                        class: \"text_pole flex1 wide100p\",\n                        type: \"text\",\n                        placeholder: \"请输入字符串或 /正则/\",\n                        autocomplete: \"off\"\n                    }, null, 512 /* NEED_PATCH */), [\n                        [_vModelText, _unref(store).settings.stop_string]\n                    ])\n                ]),\n                _: 1 /* STABLE */\n            }));\n        };\n    }\n});\n","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createElementVNode as _createElementVNode, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n    key: 0,\n    class: \"inline-drawer\"\n};\nconst _hoisted_2 = { class: \"inline-drawer-content\" };\nimport { useSettingsStore } from '../store';\nimport ChatHistory from './ChatHistory.vue';\nimport Delimiter from './Delimiter.vue';\nimport DepthInjection from './DepthInjection.vue';\nimport Stop from './Stop.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Panel',\n    setup(__props) {\n        const store = useSettingsStore();\n        return (_ctx, _cache) => {\n            return (_unref(store).should_enable)\n                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                    _cache[0] || (_cache[0] = _createElementVNode(\"div\", { class: \"inline-drawer-toggle inline-drawer-header\" }, [\n                        _createElementVNode(\"b\", null, \"压缩相邻消息\"),\n                        _createElementVNode(\"div\", { class: \"inline-drawer-icon fa-solid fa-circle-chevron-down down\" })\n                    ], -1 /* CACHED */)),\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createVNode(Delimiter),\n                        _createVNode(Stop),\n                        _createVNode(DepthInjection),\n                        _createVNode(ChatHistory)\n                    ])\n                ]))\n                : _createCommentVNode(\"v-if\", true);\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Panel.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createScriptIdDiv, teleportStyle } from '@util/script';\nimport { createPinia } from 'pinia';\nimport { createApp } from 'vue';\nimport Panel from './Panel.vue';\n\nexport function initPanel() {\n  const app = createApp(Panel).use(createPinia());\n\n  const $app = createScriptIdDiv().appendTo('#extensions_settings2');\n  app.mount($app[0]);\n\n  const { destroy } = teleportStyle();\n\n  return {\n    destroy: () => {\n      app.unmount();\n      $app.remove();\n      destroy();\n    },\n  };\n}\n","import { assignInplace, chunkBy, regexFromString } from '@util/common';\nimport { registerAsUniqueScript } from '@util/script';\nimport { compare } from 'compare-versions';\nimport { Settings } from './store';\n\ntype Prompt = {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n};\n\n//----------------------------------------------------------------------------------------------------------------------\nexport type Separators = {\n  head: InjectionPrompt;\n  deep: InjectionPrompt;\n  tail: InjectionPrompt;\n};\n\nexport function injectSeparators(settings: Settings) {\n  const separators: Readonly<Separators> = Object.freeze({\n    head: {\n      id: `\\0压缩相邻消息-聊天记录开头`,\n      position: 'in_chat',\n      depth: 9999,\n      role: 'assistant',\n      content: `【【压缩相邻消息-聊天记录开头】】`,\n    },\n    deep: {\n      id: `\\xff压缩相邻消息-Dx`,\n      position: 'in_chat',\n      depth: settings.depth_injection.threshold,\n      role: 'system',\n      content: `【【压缩相邻消息-Dx】】`,\n    },\n    tail: {\n      id: `\\xff压缩相邻消息-聊天记录结尾`,\n      position: 'in_chat',\n      depth: 0,\n      role: 'system',\n      content: `【【压缩相邻消息-聊天记录结尾】】`,\n    },\n  } as const);\n\n  const inject = (_type: string, _option: object, dry_run: boolean) => {\n    if (dry_run) {\n      return;\n    }\n    injectPrompts(Object.values(separators));\n  };\n  eventOn(tavern_events.GENERATION_AFTER_COMMANDS, inject);\n\n  return {\n    separators,\n    uninject: () => {\n      eventRemoveListener(tavern_events.GENERATION_AFTER_COMMANDS, inject);\n      uninjectPrompts(Object.values(separators).map(({ id }) => id));\n    },\n  };\n}\n\n//----------------------------------------------------------------------------------------------------------------------\nfunction seperatePrompts(prompts: Prompt[], separators: Separators): Prompt[][] | null {\n  const head_index = prompts.findIndex(({ content }) => content.includes(separators.head.content));\n  const deep_index = prompts.findIndex(({ content }) => content.includes(separators.deep.content));\n  const tail_index = prompts.findIndex(({ content }) => content.includes(separators.tail.content));\n  if (head_index === -1 || deep_index === -1 || tail_index === -1) {\n    return null;\n  }\n\n  const split_with_context = (\n    splitted_before: [string, string],\n    before_index: number,\n    current_index: number,\n    splitter: string,\n  ): [string, string] => {\n    if (before_index !== current_index) {\n      return prompts[current_index].content.split(splitter) as [string, string];\n    }\n    const splitted = splitted_before[1].split(splitter) as [string, string];\n    splitted_before[1] = '';\n    return splitted;\n  };\n\n  const splitted_head = split_with_context(['', ''], -1, head_index, separators.head.content);\n  const splitted_deep = split_with_context(splitted_head, head_index, deep_index, separators.deep.content);\n  const splitted_tail = split_with_context(splitted_deep, deep_index, tail_index, separators.tail.content);\n\n  return [\n    [...prompts.slice(0, head_index), { role: prompts[head_index].role, content: splitted_head[0] }],\n    [\n      { role: prompts[head_index].role, content: splitted_head[1] },\n      ...prompts.slice(head_index + 1, deep_index),\n      { role: prompts[deep_index].role, content: splitted_deep[0] },\n    ],\n    [\n      { role: prompts[deep_index].role, content: splitted_deep[1] },\n      ...prompts.slice(deep_index + 1, tail_index),\n      { role: prompts[tail_index].role, content: splitted_tail[0] },\n    ],\n    [{ role: prompts[tail_index].role, content: splitted_tail[1] }, ...prompts.slice(tail_index + 1)],\n  ];\n}\n\nfunction trimEmptyLines(string: string): string {\n  return _(string)\n    .split('\\n')\n    .dropWhile(line => !line.trim())\n    .dropRightWhile(line => !line.trim())\n    .join('\\n');\n}\n\nfunction rejectEmptyPrompts(prompts: Prompt[]): Prompt[] {\n  return prompts.filter(({ content }) => content.trim() !== '');\n}\n\nfunction squashMessageByRole(prompts: Prompt[], settings: Settings): Prompt[] {\n  return chunkBy(prompts, (lhs, rhs) => lhs.role === rhs.role).map(chunk => ({\n    role: chunk[0].role,\n    content: chunk.map(({ content }) => trimEmptyLines(content)).join(settings.delimiter.value),\n  }));\n}\n\nfunction squashChatHistory(prompts: Prompt[], settings: Settings): Prompt {\n  // TODO: zod encode\n  const system_prefix = substitudeMacros(settings.chat_history.system_prefix);\n  const system_suffix = substitudeMacros(settings.chat_history.system_suffix);\n  const assistant_prefix = substitudeMacros(settings.chat_history.assistant_prefix);\n  const assistant_suffix = substitudeMacros(settings.chat_history.assistant_suffix);\n  const user_prefix = substitudeMacros(settings.chat_history.user_prefix);\n  const user_suffix = substitudeMacros(settings.chat_history.user_suffix);\n  return {\n    role: settings.chat_history.squash_role,\n    content: prompts\n      .map(({ role, content }) => {\n        const trimmed = trimEmptyLines(content);\n        switch (role) {\n          case 'system':\n            return system_prefix + trimmed + system_suffix;\n          case 'assistant':\n            return assistant_prefix + trimmed + assistant_suffix;\n          case 'user':\n            return user_prefix + trimmed + user_suffix;\n        }\n      })\n      .join(settings.delimiter.value),\n  };\n}\n\nfunction listenEvent(settings: Settings, separators: Separators, shouldEnable: () => boolean) {\n  const handlePrompts = ({ prompt }: { prompt: SillyTavern.SendingMessage[] }, dry_run: boolean) => {\n    if (dry_run || !shouldEnable()) {\n      return;\n    }\n\n    if (prompt.some(({ content }) => typeof content !== 'string')) {\n      // TODO: 支持带图片、多媒体的情况\n      return;\n    }\n\n    // @ts-expect-error 类型正确\n    const chunks = seperatePrompts(prompt, separators);\n    if (chunks === null) {\n      return;\n    }\n\n    const { above, below } = settings.depth_injection;\n\n    const applyInjection = (injection_settings: typeof above, from: number, to: number) => {\n      if (!injection_settings.enabled) {\n        return;\n      }\n\n      const isSystemWithoutPlaceholder = (p: Prompt): boolean =>\n        p.role === 'system' &&\n        !(above.enabled && above.type === 'placeholder' && p.content.includes(above.placeholder)) &&\n        !(below.enabled && below.type === 'placeholder' && p.content.includes(below.placeholder));\n\n      const placeholder_content =\n        injection_settings.type === 'placeholder'\n          ? rejectEmptyPrompts(chunks[from])\n              .filter(isSystemWithoutPlaceholder)\n              .map(p => trimEmptyLines(p.content))\n              .join(settings.delimiter.value)\n          : '';\n\n      if (\n        injection_settings.type === 'placeholder' &&\n        _(chunks)\n          .flatten()\n          .some(p => p.content.includes(injection_settings.placeholder))\n      ) {\n        _.remove(chunks[from], isSystemWithoutPlaceholder);\n      } else {\n        const exclude_chunk = _.remove(chunks[from], p => p.role === 'system');\n        chunks[to] = to < from ? _.concat(chunks[to], exclude_chunk) : _.concat(exclude_chunk, chunks[to]);\n      }\n      _(chunks)\n        .flatten()\n        .filter(p => p.content.includes(injection_settings.placeholder))\n        .forEach(p => {\n          p.content = p.content.replaceAll(injection_settings.placeholder, placeholder_content);\n        });\n    };\n    applyInjection(above, 1, 0);\n    applyInjection(below, 2, 3);\n\n    const [head, above_chat_history, below_chat_history, tail] = _(chunks)\n      .map(prompts => rejectEmptyPrompts(prompts))\n      .map(prompts => squashMessageByRole(prompts, settings))\n      .value();\n\n    let result: Prompt[];\n    switch (settings.chat_history.type) {\n      case 'squash_nearby':\n        result = squashMessageByRole(_.concat(head, above_chat_history, below_chat_history, tail), settings);\n        break;\n      case 'squash_into_one':\n        result = _.concat(head, squashChatHistory(_.concat(above_chat_history, below_chat_history), settings), tail);\n        break;\n    }\n\n    assignInplace(prompt, result);\n  };\n  const handlePrompts2 = ({ messages }: { messages: SillyTavern.SendingMessage[] }) => {\n    handlePrompts({ prompt: messages }, false);\n  };\n\n  if (compare(getTavernVersion(), '1.13.4', '>')) {\n    eventOn(tavern_events.GENERATE_AFTER_DATA, handlePrompts);\n  } else {\n    eventOn(tavern_events.CHAT_COMPLETION_SETTINGS_READY, handlePrompts2);\n  }\n\n  const handleStopStringOnStream = (text: string) => {\n    if (!settings.stop_string || !shouldEnable()) {\n      return;\n    }\n    const regex = regexFromString(settings.stop_string, true);\n    if (!regex) {\n      return;\n    }\n    if (regex.test(text)) {\n      SillyTavern.stopGeneration();\n    }\n  };\n  eventOn(tavern_events.STREAM_TOKEN_RECEIVED, handleStopStringOnStream);\n\n  const handleStopStringOnReceived = async (message_id: number | string) => {\n    if (!settings.stop_string || !shouldEnable()) {\n      return;\n    }\n\n    const chat_message = SillyTavern.chat[Number(message_id)];\n\n    const regex = regexFromString(settings.stop_string, true);\n    if (!regex) {\n      return;\n    }\n    const match = chat_message.mes.match(regex);\n    if (match) {\n      chat_message.mes = chat_message.mes.slice(0, match.index);\n      if (chat_message.swipes) {\n        _.set(chat_message, ['swipes', chat_message.swipe_id!], chat_message.mes);\n      }\n      // 与 https://gitgud.io/Monblant/noass 采用相同逻辑而不使用 setChatMessages, 因为 CHARACTER_MESSAGE_RENDERED 将会随后自然触发\n      SillyTavern.updateMessageBlock(Number(message_id), chat_message);\n      await SillyTavern.saveChat();\n    }\n  };\n  eventOn(tavern_events.MESSAGE_RECEIVED, handleStopStringOnReceived);\n\n  return {\n    unlisten: () => {\n      eventRemoveListener(tavern_events.GENERATE_AFTER_DATA, handlePrompts);\n      eventRemoveListener(tavern_events.CHAT_COMPLETION_SETTINGS_READY, handlePrompts2);\n      eventRemoveListener(tavern_events.STREAM_TOKEN_RECEIVED, handleStopStringOnStream);\n      eventRemoveListener(tavern_events.MESSAGE_RECEIVED, handleStopStringOnReceived);\n    },\n  };\n}\n\nexport function initSquash(settings: Settings) {\n  const { unregister, getPreferredScriptId } = registerAsUniqueScript('压缩相邻消息');\n  const { separators, uninject } = injectSeparators(settings);\n  const { unlisten } = listenEvent(settings, separators, () => getPreferredScriptId() === getScriptId());\n  return {\n    destroy: () => {\n      unregister();\n      unlisten();\n      uninject();\n    },\n  };\n}\n","import { checkMinimumVersion } from '@util/common';\nimport { loadReadme } from '@util/script';\nimport { initPanel } from './panel';\nimport { initSquash } from './squash';\nimport { useSettingsStore } from './store';\n$(() => {\n    checkMinimumVersion('3.4.17', '压缩相邻消息');\n    loadReadme('https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/src/酒馆助手/压缩相邻消息/README.md');\n    const { destroy: destroyPanel } = initPanel();\n    let destroySquash;\n    watch(() => useSettingsStore().settings, newSettings => {\n        destroySquash?.();\n        destroySquash = initSquash(newSettings).destroy;\n    }, { immediate: true, deep: true });\n    $(window).on('pagehide', () => {\n        destroyPanel();\n        destroySquash();\n    });\n});\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","content","__esModule","default","locals","exports","add","listToStyles","parentId","list","styles","newStyles","i","length","item","part","css","media","sourceMap","parts","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","join","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","btoa","unescape","encodeURIComponent","JSON","stringify","firstChild","sfc","props","target","__vccOpts","key","val","cssMapping","base64","data","concat","sourceMapping","cssWithMappingToString","toString","this","map","needLayer","modules","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","regexFromString","input","replace_macros","makeRegex","pattern","flags","substitudeMacros","RegExp","match","_","escapeRegExp","pull","indexOf","registerAsUniqueScript","script_id","getScriptId","path","getPreferredScriptId","registered_scripts","get","window","parent","Set","$","find","toArray","element","String","attr","has","last","value","eventEmit","unregister","delete","listenPreferenceState","callback","eventOn","n","getter","d","a","definition","o","Object","defineProperty","enumerable","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","Vue","z","OldSettings","object","name","string","seperator","enum","prefault","transform","put_system_injection_after_chat_history","boolean","on_chat_history","squash_role","user_prefix","user_suffix","assistant_prefix","assistant_suffix","system_prefix","system_suffix","stop_string","catch","Settings","parse","delimiter","depth_injection","threshold","above","enabled","placeholder","below","chat_history","number","int","min","useSettingsStore","variables","getVariables","settings","ref","should_enable","preferred_script_id","watchEffect","insertOrAssignVariables","useEscapedNewline","computed","replace","set","_hoisted_1","class","_hoisted_2","__name","label","setup","__props","_ctx","_cache","$slots","help","role","tabindex","onClick","$event","SillyTavern","callGenericPopup","POPUP_TYPE","TEXT","allowVerticalScrolling","leftAlign","wide","_hoisted_3","required","emits","model","option","store","user_prefix_input","user_suffix_input","assistant_prefix_input","assistant_suffix_input","system_prefix_input","system_suffix_input","Section","HelpIcon","Select","modelValue","Field","Item","autocomplete","Checkbox","style","Delimiter","Stop","DepthInjection","ChatHistory","initPanel","app","createApp","Panel","use","$app","appendTo","mount","destroy","append_to","$div","append","clone","teleportStyle","unmount","trimEmptyLines","split","dropWhile","line","trim","dropRightWhile","rejectEmptyPrompts","prompts","squashMessageByRole","array","predicate","chunks","lhs","rhs","zip","dropRight","drop","chunkBy","chunk","listenEvent","separators","shouldEnable","handlePrompts","prompt","dry_run","some","head_index","findIndex","includes","deep_index","deep","tail_index","tail","split_with_context","splitted_before","before_index","current_index","splitter","splitted","splitted_head","splitted_deep","splitted_tail","slice","seperatePrompts","applyInjection","injection_settings","from","to","isSystemWithoutPlaceholder","p","placeholder_content","flatten","exclude_chunk","forEach","replaceAll","above_chat_history","below_chat_history","result","trimmed","squashChatHistory","destination","new_array","handlePrompts2","messages","getTavernVersion","tavern_events","GENERATE_AFTER_DATA","CHAT_COMPLETION_SETTINGS_READY","handleStopStringOnStream","text","regex","stopGeneration","STREAM_TOKEN_RECEIVED","handleStopStringOnReceived","async","message_id","chat_message","chat","Number","mes","swipes","swipe_id","updateMessageBlock","saveChat","MESSAGE_RECEIVED","unlisten","eventRemoveListener","initSquash","uninject","freeze","position","depth","inject","_type","_option","injectPrompts","values","GENERATION_AFTER_COMMANDS","uninjectPrompts","injectSeparators","expected","title","getTavernHelperVersion","toastr","error","checkMinimumVersion","url","readme","fetch","ok","readme_text","replaceScriptInfo","loadReadme","destroyPanel","destroySquash","watch","newSettings","immediate","on"],"ignoreList":[],"sourceRoot":""}