import{compare as t}from'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import{default as r}from'https://testingcf.jsdelivr.net/npm/json5/+esm';import{jsonrepair as e}from'https://testingcf.jsdelivr.net/npm/jsonrepair/+esm';import{toDotPath as n}from'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';var o={};function s(t,r){return t.length=0,t.push(...r),t}function i(t,r){if(0===t.length)return[];const e=[[t[0]]];for(const[n,o]of _.zip(_.dropRight(t),_.drop(t)))r(n,o)?e[e.length-1].push(o):e.push([o]);return e}function a(t,r){if(!t)return null;const e=(t,e)=>(r&&(t=substitudeMacros(t)),new RegExp(t,e));try{const r=t.match(/\/(.+)\/([a-z]*)/i);if(!r)return e(_.escapeRegExp(t),'i');if(r[2]&&!/^(?!.*?(.).*?\1)[gmixXsuUAJ]+$/.test(r[3]))return e(t,'i');let n=r[2]??'';return _.pull(n,'g'),-1===n.indexOf('i')&&(n+='i'),e(r[1],n)}catch{return null}}function c(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(t){const r=16*Math.random()|0;return('x'===t?r:3&r|8).toString(16)})}async function p(r,e){t(await getTavernHelperVersion(),r,'<')&&toastr.error(`'${e}' 需要酒馆助手版本 >= '${r}'`,'版本不兼容')}function u(t){return _([...t.issues]).sortBy(t=>t.path?.length??0).flatMap(t=>{const r=[`✖ ${t.message}`];return t.path?.length&&r.push(`  → 路径: ${n(t.path)}`),void 0!==t.input&&r.push(`  → 输入: ${JSON.stringify(t.input)}`),r}).join('\n')}function x(t){return YAML.stringify(t,{blockQuote:'literal'})}function f(t){let n;try{n=YAML.parseDocument(t,{merge:!0}).toJS()}catch(o){try{n=r.parse(t)}catch(r){try{n=JSON.parse(e(t))}catch(e){const n=t=>t instanceof Error?t.message:String(t);throw new Error(x({'要解析的字符串不是有效的 YAML/JSON 格式':{字符串内容:t,YAML错误信息:n(o),JSON5错误信息:n(r),尝试修复JSON时的错误信息:n(e)}}))}}}return n}function h(t){const r=(new TextEncoder).encode(t),e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=255-r[t];let n='';for(let t=0;t<e.length;t++){n+=e[t].toString(16).padStart(2,'0')}return n}async function l(r,e,n){const o=(await getCharacter(r)).version.trim()||'0.0.0';t(o,e,'>=')||(await importRawCharacter(r,await fetch(n).then(t=>t.blob())),replaceCharacter(r,{version:e}),toastr.success(`角色卡已自动更新到 '${e.startsWith('v')?e:`v${e}`}'`,r))}o.d=(t,r)=>{for(var e in r)o.o(r,e)&&!o.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:r[e]})},o.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);export{s as assignInplace,l as checkAndUpdateCharacter,p as checkMinimumVersion,i as chunkBy,h as getComplementString,x as literalYamlify,f as parseString,u as prettifyErrorWithInput,a as regexFromString,c as uuidv4};
//# sourceMappingURL=common.js.map