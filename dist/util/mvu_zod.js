import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import{toDotPath as t}from'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';import{klona as e}from'https://testingcf.jsdelivr.net/npm/klona/+esm';var r={};r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);const a=z;function n(r){'function'==typeof registerVariableSchema&&registerVariableSchema(a.z.object({stat_data:r}),{type:'message'}),eventOn('mag_variable_initialized',(t,e)=>{const n=r.safeParse(_.get(t,'stat_data',{}));n.error&&toastr.error(a.z.prettifyError(n.error).replaceAll('\n','<br>'),`[MVU zod]第 ${e+1} 条开场白的变量初始化失败`,{escapeHtml:!1})}),eventOn('mag_command_parsed',(a,n)=>{const o=Boolean($('#mvu_notification_error').prop('checked')),c=(e,n,s)=>{const i=r.safeParse(e,{reportInput:!0});return i.success?(a.stat_data=i.data,!0):(o&&s&&toastr.warning((c=i.error,_([...c.issues]).sortBy(t=>t.path?.length??0).flatMap(e=>{const r=[`✖ ${e.message}`];return e.path?.length&&r.push(`  → 路径: ${t(e.path)}`),void 0!==e.input&&r.push(`  → 输入: ${JSON.stringify(e.input)}`),r}).join('\n')).replaceAll('\n','<br>'),`[MVU zod]发生变量更新错误，可能需要重Roll: ${n.full_match}`,{escapeHtml:!1}),!1);var c};for(const t of n){let r=e(a.stat_data);const n=s(t.args[0]);switch(t.type){case'set':3===t.args.length&&t.args.splice(1,1),n?_.set(r,n,i(t.args[1])):r=i(t.args[1]),c(r,t,!0);break;case'insert':{const a=i(t.args[1]),s=i(t.args.at(-1)),o=(e,r)=>{const i=''===n?e:_.get(e,n),o=_.isArray(i);return 2===t.args.length?o?i.push(s):_.assign(i,s):o?i.splice(a,0,s):i[String(a)]=s,c(e,t,r)},l=''===n?r:_.get(r,n),p=_.isNil(l);if(!p&&!_.isArray(l)&&!_.isPlainObject(l))continue;if(!p){o(r,!0);continue}const u=_(e(r));o(u.set(n,{}).value(),!1)||o(u.set(n,[]).value(),!0);break}case'delete':{const e=t.args.map(s).join('.'),a=_(e).toPath().value(),n=_(a).dropRight().join('.');_.isArray(_.get(r,n))?_.pullAt(_.get(r,n),Number(_(a).last())):_.unset(r,e),c(r,t,!0);break}}}n.length=0})}function s(t){return t.replace(/^[\\"'` ]*(.*?)[\\"'` ]*$/,'$1')}function i(t){const e=function(t){const e=t.trim();if('true'===e)return!0;if('false'===e)return!1;if('null'===e)return null;if('undefined'===e)return;try{return JSON.parse(e)}catch(t){if(e.startsWith('{')&&e.endsWith('}')||e.startsWith('[')&&e.endsWith(']'))try{const t=new Function(`return ${e};`)();if(_.isObject(t)||Array.isArray(t))return t}catch(t){}}try{return YAML.parse(e)}catch(t){}return s(t)}(t);return e instanceof Date?e.toISOString():Array.isArray(e)?e.map(t=>t instanceof Date?t.toISOString():t):e}export{n as registerMvuSchema};
//# sourceMappingURL=mvu_zod.js.map