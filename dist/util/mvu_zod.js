import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import{toDotPath as t}from'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';import{klona as r}from'https://testingcf.jsdelivr.net/npm/klona/+esm';var e={};e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);const n=z;function s(e){eventOn('mag_variable_initialized',(t,r)=>{const s=e.safeParse(_.get(t,'stat_data',{}));s.error&&toastr.error(n.z.prettifyError(s.error).replaceAll('\n','<br>'),`[MVU zod]第 ${r+1} 条开场白的变量初始化失败`,{escapeHtml:!1})}),eventOn('mag_command_parsed',(n,s)=>{const i=Boolean($('#mvu_notification_error').prop('checked')),c=(r,s,a)=>{const o=e.safeParse(r,{reportInput:!0});return o.success?(n.stat_data=o.data,!0):(i&&a&&toastr.warning((c=o.error,_([...c.issues]).sortBy(t=>t.path?.length??0).flatMap(r=>{const e=[`✖ ${r.message}`];return r.path?.length&&e.push(`  → 路径: ${t(r.path)}`),void 0!==r.input&&e.push(`  → 输入: ${JSON.stringify(r.input)}`),e}).join('\n')).replaceAll('\n','<br>'),`[MVU zod]发生变量更新错误，可能需要重Roll: ${s.full_match}`,{escapeHtml:!1}),!1);var c};for(const t of s){const e=r(n.stat_data),s=a(t.args[0]);switch(t.type){case'set':3===t.args.length&&t.args.splice(1,1),_.set(e,s,o(t.args[1])),c(e,t,!0);break;case'insert':{const n=o(t.args[1]),a=o(t.args.at(-1)),i=(r,e)=>{const o=_.get(r,s),i=_.isArray(o);return 2===t.args.length?i?o.push(a):_.assign(o,a):i?o.splice(n,0,a):o[String(n)]=a,c(r,t,e)},l=_.get(e,s),p=_.isNil(l);if(!p&&!_.isArray(l)&&!_.isPlainObject(l))continue;if(!p){i(e,!0);continue}const u=_(r(e));i(u.set(s,{}).value(),!1)||i(u.set(s,[]).value(),!0);break}case'delete':{const r=t.args.map(a).join('.'),n=_(r).toPath().value(),s=_(n).dropRight().join('.');_.isArray(_.get(e,s))?_.pullAt(_.get(e,s),Number(_(n).last())):_.unset(e,r),c(e,t,!0);break}}}s.length=0})}function a(t){return t.replace(/^[\\"'` ]*(.*?)[\\"'` ]*$/,'$1')}function o(t){const r=function(t){const r=t.trim();if('true'===r)return!0;if('false'===r)return!1;if('null'===r)return null;if('undefined'===r)return;try{return JSON.parse(r)}catch(t){if(r.startsWith('{')&&r.endsWith('}')||r.startsWith('[')&&r.endsWith(']'))try{const t=new Function(`return ${r};`)();if(_.isObject(t)||Array.isArray(t))return t}catch(t){}}try{return YAML.parse(r)}catch(t){}return a(t)}(t);return r instanceof Date?r.toISOString():Array.isArray(r)?r.map(t=>t instanceof Date?t.toISOString():t):r}export{s as registerMvuSchema};
//# sourceMappingURL=mvu_zod.js.map