import{klona as t}from'https://testingcf.jsdelivr.net/npm/klona/+esm';const r=z;function e(e){eventOn('mag_variable_initialized',(t,n)=>{const a=e.safeParse(_.get(t,'stat_data',{}));a.error&&toastr.error(r.z.prettifyError(a.error).replaceAll('\n','<br>'),`[MVU zod]第 ${n+1} 条开场白的变量初始化失败`,{escapeHtml:!1})}),eventOn('mag_command_parsed',(s,i)=>{const o=Boolean($('#mvu_notification_error').prop('checked')),c=(t,n,a)=>{const i=e.safeParse(t);return i.success?(s.stat_data=i.data,!0):(o&&a&&toastr.warning(r.z.prettifyError(i.error).replaceAll('\n','<br>'),`[MVU zod]发生变量更新错误，可能需要重Roll: ${n.full_match}`,{escapeHtml:!1}),!1)};for(const r of i){const e=t(s.stat_data),i=n(r.args[0]);switch(r.type){case'set':3===r.args.length&&r.args.splice(1,1),_.set(e,i,a(r.args[1])),c(e,r,!0);break;case'insert':{const n=a(r.args[1]),s=a(r.args.at(-1)),o=(t,e)=>{const a=_.get(t,i),o=_.isArray(a);return 2===r.args.length?o?a.push(s):_.assign(a,s):o?a.splice(n,0,s):a[String(n)]=s,c(t,r,e)},l=_.get(e,i),u=_.isNil(l);if(!u&&!_.isArray(l)&&!_.isPlainObject(l))continue;if(!u){o(e,!0);continue}const f=_(t(e));o(f.set(i,{}).value(),!1)||o(f.set(i,[]).value(),!0);break}case'delete':{const t=r.args.map(n).join('.'),a=_(t).toPath().value(),s=_(a).dropRight().join('.');_.isArray(_.get(e,s))?_.pullAt(_.get(e,s),Number(_(a).last())):_.unset(e,t),c(e,r,!0);break}}}i.length=0})}function n(t){return t.replace(/^[\\"'` ]*(.*?)[\\"'` ]*$/,'$1')}function a(t){const r=function(t){const r=t.trim();if('true'===r)return!0;if('false'===r)return!1;if('null'===r)return null;if('undefined'===r)return;try{return JSON.parse(r)}catch(t){if(r.startsWith('{')&&r.endsWith('}')||r.startsWith('[')&&r.endsWith(']'))try{const t=new Function(`return ${r};`)();if(_.isObject(t)||Array.isArray(t))return t}catch(t){}}try{return YAML.parse(r)}catch(t){}return n(t)}(t);return r instanceof Date?r.toISOString():Array.isArray(r)?r.map(t=>t instanceof Date?t.toISOString():t):r}export{e as registerMvuSchema};
//# sourceMappingURL=mvu_zod.js.map