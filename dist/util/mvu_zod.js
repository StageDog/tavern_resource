import{klona as t}from'https://testingcf.jsdelivr.net/npm/klona/+esm';const r=z;function e(e){eventOn('mag_variable_initialized',(t,n)=>{const s=e.safeParse(_.get(t,'stat_data',{}));s.error&&toastr.error(r.z.prettifyError(s.error),`[MVU zod]第 ${n+1} 条开场白的变量初始化失败`)}),eventOn('mag_command_parsed',(a,i)=>{const o=Boolean($('#mvu_notification_error').prop('checked')),c=(t,n,s)=>{const i=e.safeParse(t);return i.success?(a.stat_data=i.data,!0):(o&&s&&toastr.warning(r.z.prettifyError(i.error),`[MVU zod]发生变量更新错误，可能需要重Roll: ${n.full_match}`),!1)};for(const r of i){const e=t(a.stat_data),i=n(r.args[0]);switch(r.type){case'set':3===r.args.length&&r.args.splice(1,1),_.set(e,i,s(r.args[1])),c(e,r,!0);break;case'insert':{const n=s(r.args[1]),a=s(r.args.at(-1)),o=(t,e)=>{const s=_.get(t,i),o=_.isArray(s);return 2===r.args.length?o?s.push(a):_.assign(s,a):o?s.splice(n,0,a):s[String(n)]=a,c(t,r,e)},u=_.get(e,i),f=_.isNil(u);if(!f&&!_.isArray(u)&&!_.isPlainObject(u))continue;if(!f){o(e,!0);continue}const l=_(t(e));o(l.set(i,{}).value(),!1)||o(l.set(i,[]).value(),!0);break}case'delete':_.unset(e,r.args.map(n)),c(e,r,!0)}}i.length=0})}function n(t){return t.replace(/^[\\"'` ]*(.*?)[\\"'` ]*$/,'$1')}function s(t){const r=function(t){const r=t.trim();if('true'===r)return!0;if('false'===r)return!1;if('null'===r)return null;if('undefined'===r)return;try{return JSON.parse(r)}catch(t){if(r.startsWith('{')&&r.endsWith('}')||r.startsWith('[')&&r.endsWith(']'))try{const t=new Function(`return ${r};`)();if(_.isObject(t)||Array.isArray(t))return t}catch(t){}}try{return YAML.parse(r)}catch(t){}return n(t)}(t);return r instanceof Date?r.toISOString():Array.isArray(r)?r.map(t=>t instanceof Date?t.toISOString():t):r}export{e as registerMvuSchema};
//# sourceMappingURL=mvu_zod.js.map