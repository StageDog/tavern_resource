import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import{toDotPath as t}from'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';import{klona as e}from'https://testingcf.jsdelivr.net/npm/klona/+esm';var r={};r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);const n=z;function a(r){'function'==typeof registerVariableSchema&&registerVariableSchema(n.z.object({stat_data:'function'==typeof r?r():r}),{type:'message'});const a=()=>{if('function'==typeof r){const t=r();return'function'==typeof registerVariableSchema&&registerVariableSchema(n.z.object({stat_data:t}),{type:'message'}),t}return r};eventOn('mag_variable_initialized',(t,e)=>{const r=a().safeParse(_.get(t,'stat_data',{}));r.error&&s(n.z.prettifyError(r.error),`第 ${e+1} 条开场白的变量初始化失败`)}),eventOn('mag_command_parsed',(r,n)=>{const c=a(),l=Boolean($('#mvu_notification_error').prop('checked')),u=(e,n,a)=>{const o=c.safeParse(e,{reportInput:!0});return o.success?(r.stat_data=o.data,!0):(l&&a&&s((i=o.error,_([...i.issues]).sortBy(t=>t.path?.length??0).flatMap(e=>{const r=[`✖ ${e.message}`];return e.path?.length&&r.push(`  → 路径: ${t(e.path)}`),void 0!==e.input&&r.push(`  → 输入: ${JSON.stringify(e.input)}`),r}).join('\n')),`发生变量更新错误，可能需要重Roll: ${n.full_match}`),!1);var i};for(const t of n){let n=e(r.stat_data);const a=o(t.args[0]);switch(t.type){case'set':3===t.args.length&&t.args.splice(1,1),a?_.set(n,a,i(t.args[1])):n=i(t.args[1]),u(n,t,!0);break;case'insert':{const r=i(t.args[1]),s=i(t.args.at(-1)),o=(e,n)=>{const o=''===a?e:_.get(e,a),i=_.isArray(o);return 2===t.args.length?i?o.push(s):_.assign(o,s):i?o.splice(r,0,s):o[String(r)]=s,u(e,t,n)},c=''===a?n:_.get(n,a),l=_.isNil(c);if(!l&&!_.isArray(c)&&!_.isPlainObject(c))continue;if(!l){o(n,!0);continue}const p=_(e(n));o(p.set(a,{}).value(),!1)||o(p.set(a,[]).value(),!0);break}case'delete':{const e=t.args.map(o).join('.'),r=_(e).toPath().value(),a=_(r).dropRight().join('.');_.isArray(_.get(n,a))?_.pullAt(_.get(n,a),Number(_(r).last())):_.unset(n,e),u(n,t,!0);break}}}n.length=0}),console.info('变量结构注册成功')}function s(t,e){toastr.error(t.replaceAll('\n','<br>'),'[MVU zod]'+e,{escapeHtml:!1}),console.warn(`${e} ${t}`)}function o(t){return t.replace(/^[\\"'` ]*(.*?)[\\"'` ]*$/,'$1')}function i(t){const e=function(t){const e=t.trim();if('true'===e)return!0;if('false'===e)return!1;if('null'===e)return null;if('undefined'===e)return;try{return JSON.parse(e)}catch(t){if(e.startsWith('{')&&e.endsWith('}')||e.startsWith('[')&&e.endsWith(']'))try{const t=new Function(`return ${e};`)();if(_.isObject(t)||Array.isArray(t))return t}catch(t){}}try{return YAML.parse(e)}catch(t){}return o(t)}(t);return e instanceof Date?e.toISOString():Array.isArray(e)?e.map(t=>t instanceof Date?t.toISOString():t):e}export{a as registerMvuSchema};
//# sourceMappingURL=mvu_zod.js.map