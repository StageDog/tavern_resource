{"version":3,"file":"common.js","mappings":"mPACA,IAAIA,EAAsB,CAAC,ECGpB,SAASC,EAAiBC,EAAkBC,GAGjD,OAFAD,EAAYE,OAAS,EACrBF,EAAYG,QAAQF,GACbD,CACT,CAGO,SAASI,EAAiCC,EAAcC,GAC7D,OAAOC,EAAEC,UAAUH,EAAKC,EAAK,CAACG,EAAMH,IAASC,EAAEG,QAAQJ,GAAOA,OAAMK,EACtE,CAEO,SAASC,EAAWC,EAAYC,GACrC,GAAqB,IAAjBD,EAAMX,OACR,MAAO,GAGT,MAAMa,EAAgB,CAAC,CAACF,EAAM,KAC9B,IAAK,MAAOR,EAAKC,KAAQC,EAAES,IAAIT,EAAEU,UAAUJ,GAAQN,EAAEW,KAAKL,IACpDC,EAAUT,EAAMC,GAClBS,EAAOA,EAAOb,OAAS,GAAGC,KAAKG,GAE/BS,EAAOZ,KAAK,CAACG,IAGjB,OAAOS,CACT,CAEO,SAASI,EAAgBC,EAAeC,GAC7C,IAAKD,EACH,OAAO,KAET,MAAME,EAAY,CAACC,EAAiBC,KAC9BH,IACFE,EAAUE,iBAAiBF,IAEtB,IAAIG,OAAOH,EAASC,IAE7B,IACE,MAAMG,EAAQP,EAAMO,MAAM,qBAC1B,IAAKA,EACH,OAAOL,EAAUf,EAAEqB,aAAaR,GAAQ,KAE1C,GAAIO,EAAM,KAAO,iCAAiCE,KAAKF,EAAM,IAC3D,OAAOL,EAAUF,EAAO,KAE1B,IAAII,EAAQG,EAAM,IAAM,GAKxB,OAJApB,EAAEuB,KAAKN,EAAO,MACc,IAAxBA,EAAMO,QAAQ,OAChBP,GAAgB,KAEXF,EAAUK,EAAM,GAAIH,EAC7B,CAAE,MACA,OAAO,IACT,CACF,CAEO,SAASQ,IACd,MAAO,uCAAuCC,QAAQ,QAAS,SAAUC,GACvE,MAAMC,EAAqB,GAAhBC,KAAKC,SAAiB,EAEjC,OADgB,MAANH,EAAYC,EAAS,EAAJA,EAAW,GAC7BG,SAAS,GACpB,EACF,CAEOC,eAAeC,EAAoBC,EAAkBC,GACtD,QAAcC,yBAA0BF,EAAU,MACpDG,OAAOC,MAAM,IAAIH,mBAAuBD,KAAa,QAEzD,CAEO,SAASK,EAAuBD,GACrC,OAAOtC,EAAE,IAAIsC,EAAME,SAChBC,OAAOC,GAASA,EAAMC,MAAMhD,QAAU,GACtCiD,QAAQF,IACP,MAAMG,EAAQ,CAAC,KAAKH,EAAMI,WAO1B,OANIJ,EAAMC,MAAMhD,QACdkD,EAAMjD,KAAK,WAAW,EAAU8C,EAAMC,cAEpBvC,IAAhBsC,EAAM7B,OACRgC,EAAMjD,KAAK,WAAWmD,KAAKC,UAAUN,EAAM7B,UAEtCgC,IAERI,KAAK,KACV,CAEO,SAASC,EAAeC,GAC7B,OAAOC,KAAKJ,UAAUG,EAAO,CAAEE,WAAY,WAC7C,CAEO,SAASC,EAAYC,GAC1B,MAAMC,EAAa,SAASlC,KAAKiC,EAAQE,aACzC,IACE,OAAOD,EAAaT,KAAKW,MAAM,EAAWH,IAAYH,KAAKO,cAAcJ,EAAS,CAAEK,OAAO,IAAQC,MACrG,CAAE,MAAOC,GACP,IACE,OAAON,EAAaJ,KAAKO,cAAcJ,EAAS,CAAEK,OAAO,IAAQC,OAASd,KAAKW,MAAM,EAAWH,GAClG,CAAE,MAAOQ,GACP,MAAMC,EAAW1B,GACfA,aAAiB2B,MAAQ,GAAG3B,EAAM4B,MAAQ5B,EAAM4B,MAAQ5B,EAAMQ,UAAYqB,OAAO7B,GAE7EA,EAAQ,CAAE,MAAOiB,GAGvB,MAFAvD,EAAEoE,IAAI9B,EAAOkB,EAAa,WAAa,WAAYQ,EAAQF,IAC3D9D,EAAEoE,IAAI9B,EAAOkB,EAAa,WAAa,WAAYQ,EAAQD,IACrD,IAAIE,MACRf,EAAe,CAAE,CAAC,gBAAgBM,EAAa,YAAc,kBAAmBlB,IAEpF,CACF,CACF,CAEO,SAAS+B,EAAoBC,GAClC,MACMC,GADU,IAAIC,aACEC,OAAOH,GAEvBI,EAAe,IAAIC,WAAWJ,EAAM5E,QAC1C,IAAK,IAAIiF,EAAI,EAAGA,EAAIL,EAAM5E,OAAQiF,IAChCF,EAAaE,GAAK,IAAOL,EAAMK,GAGjC,IAAIC,EAAM,GACV,IAAK,IAAID,EAAI,EAAGA,EAAIF,EAAa/E,OAAQiF,IAAK,CAE5CC,GADUH,EAAaE,GAAG7C,SAAS,IAAI+C,SAAS,EAAG,IAErD,CACA,OAAOD,CACT,CCjIAtF,EAAoBwF,EAAI,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACX1F,EAAoB4F,EAAEF,EAAYC,KAAS3F,EAAoB4F,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3E3F,EAAoB4F,EAAI,CAACK,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,U","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","import { compare } from 'compare-versions';\nimport { jsonrepair } from 'jsonrepair';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\n// 修正 _.merge 对数组的合并逻辑, [1, 2, 3] 和 [4, 5] 合并后变成 [4, 5] 而不是 [4, 5, 3]\nexport function correctlyMerge<TObject, TSource>(lhs: TObject, rhs: TSource): TObject & TSource {\n  return _.mergeWith(lhs, rhs, (_lhs, rhs) => (_.isArray(rhs) ? rhs : undefined));\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string, replace_macros?: boolean): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  const makeRegex = (pattern: string, flags: string) => {\n    if (replace_macros) {\n      pattern = substitudeMacros(pattern);\n    }\n    return new RegExp(pattern, flags);\n  };\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return makeRegex(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return makeRegex(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return makeRegex(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n\nexport function literalYamlify(value: any) {\n  return YAML.stringify(value, { blockQuote: 'literal' });\n}\n\nexport function parseString(content: string): any {\n  const json_first = /^[[{]/s.test(content.trimStart());\n  try {\n    return json_first ? JSON.parse(jsonrepair(content)) : YAML.parseDocument(content, { merge: true }).toJS();\n  } catch (e1) {\n    try {\n      return json_first ? YAML.parseDocument(content, { merge: true }).toJS() : JSON.parse(jsonrepair(content));\n    } catch (e2) {\n      const toError = (error: unknown) =>\n        error instanceof Error ? `${error.stack ? error.stack : error.message}` : String(error);\n\n      const error = { 字符串内容: content };\n      _.set(error, json_first ? 'JSON错误信息' : 'YAML错误信息', toError(e1));\n      _.set(error, json_first ? 'YAML错误信息' : 'JSON错误信息', toError(e2));\n      throw new Error(\n        literalYamlify({ [`要解析的字符串不是有效的 ${json_first ? 'JSON/YAML' : 'YAML/JSON'} 格式`]: error }),\n      );\n    }\n  }\n}\n\nexport function getComplementString(string: string) {\n  const encoder = new TextEncoder();\n  const bytes = encoder.encode(string);\n\n  const complemented = new Uint8Array(bytes.length);\n  for (let i = 0; i < bytes.length; i++) {\n    complemented[i] = 0xff - bytes[i];\n  }\n\n  let hex = '';\n  for (let i = 0; i < complemented.length; i++) {\n    const h = complemented[i].toString(16).padStart(2, '0');\n    hex += h;\n  }\n  return hex;\n}\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))"],"names":["__webpack_require__","assignInplace","destination","new_array","length","push","correctlyMerge","lhs","rhs","_","mergeWith","_lhs","isArray","undefined","chunkBy","array","predicate","chunks","zip","dropRight","drop","regexFromString","input","replace_macros","makeRegex","pattern","flags","substitudeMacros","RegExp","match","escapeRegExp","test","pull","indexOf","uuidv4","replace","c","r","Math","random","toString","async","checkMinimumVersion","expected","title","getTavernHelperVersion","toastr","error","prettifyErrorWithInput","issues","sortBy","issue","path","flatMap","lines","message","JSON","stringify","join","literalYamlify","value","YAML","blockQuote","parseString","content","json_first","trimStart","parse","parseDocument","merge","toJS","e1","e2","toError","Error","stack","String","set","getComplementString","string","bytes","TextEncoder","encode","complemented","Uint8Array","i","hex","padStart","d","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call"],"sourceRoot":""}