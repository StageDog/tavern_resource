{"version":3,"file":"common.js","mappings":"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","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/util/common.ts","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","import { compare } from 'compare-versions';\nimport JSON5 from 'json5';\nimport { jsonrepair } from 'jsonrepair';\nimport { toDotPath } from 'zod/v4/core';\n\nexport function assignInplace<T>(destination: T[], new_array: T[]): T[] {\n  destination.length = 0;\n  destination.push(...new_array);\n  return destination;\n}\n\nexport function chunkBy<T>(array: T[], predicate: (lhs: T, rhs: T) => boolean): T[][] {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks: T[][] = [[array[0]]];\n  for (const [lhs, rhs] of _.zip(_.dropRight(array), _.drop(array))) {\n    if (predicate(lhs!, rhs!)) {\n      chunks[chunks.length - 1].push(rhs!);\n    } else {\n      chunks.push([rhs!]);\n    }\n  }\n  return chunks;\n}\n\nexport function regexFromString(input: string, replace_macros?: boolean): RegExp | null {\n  if (!input) {\n    return null;\n  }\n  const makeRegex = (pattern: string, flags: string) => {\n    if (replace_macros) {\n      pattern = substitudeMacros(pattern);\n    }\n    return new RegExp(pattern, flags);\n  };\n  try {\n    const match = input.match(/\\/(.+)\\/([a-z]*)/i);\n    if (!match) {\n      return makeRegex(_.escapeRegExp(input), 'i');\n    }\n    if (match[2] && !/^(?!.*?(.).*?\\1)[gmixXsuUAJ]+$/.test(match[3])) {\n      return makeRegex(input, 'i');\n    }\n    let flags = match[2] ?? '';\n    _.pull(flags, 'g');\n    if (flags.indexOf('i') === -1) {\n      flags = flags + 'i';\n    }\n    return makeRegex(match[1], flags);\n  } catch {\n    return null;\n  }\n}\n\nexport function uuidv4(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nexport async function checkMinimumVersion(expected: string, title: string) {\n  if (compare(await getTavernHelperVersion(), expected, '<')) {\n    toastr.error(`'${title}' 需要酒馆助手版本 >= '${expected}'`, '版本不兼容');\n  }\n}\n\nexport function prettifyErrorWithInput(error: z.ZodError) {\n  return _([...error.issues])\n    .sortBy(issue => issue.path?.length ?? 0)\n    .flatMap(issue => {\n      const lines = [`✖ ${issue.message}`];\n      if (issue.path?.length) {\n        lines.push(`  → 路径: ${toDotPath(issue.path)}`);\n      }\n      if (issue.input !== undefined) {\n        lines.push(`  → 输入: ${JSON.stringify(issue.input)}`);\n      }\n      return lines;\n    })\n    .join('\\n');\n}\n\nexport function literalYamlify(value: any) {\n  return YAML.stringify(value, { blockQuote: 'literal' });\n}\n\nexport function parseString(content: string): any {\n  let parsed: unknown;\n  try {\n    parsed = YAML.parseDocument(content, { merge: true }).toJS();\n  } catch (yaml_error) {\n    try {\n      // eslint-disable-next-line import-x/no-named-as-default-member\n      parsed = JSON5.parse(content);\n    } catch (json5_error) {\n      try {\n        parsed = JSON.parse(jsonrepair(content));\n      } catch (json_error) {\n        const toError = (error: unknown) => (error instanceof Error ? error.message : String(error));\n        throw new Error(\n          literalYamlify({\n            ['要解析的字符串不是有效的 YAML/JSON 格式']: {\n              字符串内容: content,\n              YAML错误信息: toError(yaml_error),\n              JSON5错误信息: toError(json5_error),\n              尝试修复JSON时的错误信息: toError(json_error),\n            },\n          }),\n        );\n      }\n    }\n  }\n  return parsed;\n}\n\nexport function getComplementString(string: string) {\n  const encoder = new TextEncoder();\n  const bytes = encoder.encode(string);\n\n  const complemented = new Uint8Array(bytes.length);\n  for (let i = 0; i < bytes.length; i++) {\n    complemented[i] = 0xff - bytes[i];\n  }\n\n  let hex = '';\n  for (let i = 0; i < complemented.length; i++) {\n    const h = complemented[i].toString(16).padStart(2, '0');\n    hex += h;\n  }\n  return hex;\n}\n\nexport async function checkAndUpdateCharacter(name: string, latest_version: string, png_url: string): Promise<void> {\n  const current_version = (await getCharacter(name)).version.trim() || '0.0.0';\n  if (compare(current_version, latest_version, '>=')) {\n    return;\n  }\n  await importRawCharacter(name, await fetch(png_url).then(response => response.blob()));\n  replaceCharacter(name, { version: latest_version });\n  toastr.success(\n    `角色卡已自动更新到 '${latest_version.startsWith('v') ? latest_version : `v${latest_version}`}'`,\n    name,\n  );\n}\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))"],"names":["__webpack_require__","assignInplace","destination","new_array","length","push","chunkBy","array","predicate","chunks","lhs","rhs","_","zip","dropRight","drop","regexFromString","input","replace_macros","makeRegex","pattern","flags","substitudeMacros","RegExp","match","escapeRegExp","test","pull","indexOf","uuidv4","replace","c","r","Math","random","toString","async","checkMinimumVersion","expected","title","getTavernHelperVersion","toastr","error","prettifyErrorWithInput","issues","sortBy","issue","path","flatMap","lines","message","undefined","JSON","stringify","join","literalYamlify","value","YAML","blockQuote","parseString","content","parsed","parseDocument","merge","toJS","yaml_error","json5_error","parse","json_error","toError","Error","String","getComplementString","string","bytes","TextEncoder","encode","complemented","Uint8Array","i","hex","padStart","checkAndUpdateCharacter","name","latest_version","png_url","current_version","getCharacter","version","trim","importRawCharacter","fetch","then","response","blob","replaceCharacter","success","startsWith","d","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call"],"sourceRoot":""}