import{defineStore as e}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';const t=Vue;function a(e){return!!(0,t.getCurrentScope)()&&((0,t.onScopeDispose)(e),!0)}const n='undefined'!=typeof window&&'undefined'!=typeof document;'undefined'!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope),Object.prototype.toString;function s(e,t){return function(...a){return new Promise((n,s)=>{Promise.resolve(e(()=>t.apply(this,a),{fn:t,thisArg:this,args:a})).then(n).catch(s)})}}const o=e=>e();function r(e){const t=Object.create(null);return a=>t[a]||(t[a]=e(a))}const i=/\B([A-Z])/g,c=(r(e=>e.replace(i,'-$1').toLowerCase()),/-(\w)/g);r(e=>e.replace(c,(_,e)=>e?e.toUpperCase():''));function l(e,s=1e3,o={}){const{immediate:r=!0,immediateCallback:i=!1}=o;let c=null;const l=(0,t.shallowRef)(!1);function u(){c&&(clearInterval(c),c=null)}function p(){l.value=!1,u()}function d(){const a=(0,t.toValue)(s);a<=0||(l.value=!0,i&&e(),u(),l.value&&(c=setInterval(e,a)))}if(r&&n&&d(),(0,t.isRef)(s)||'function'==typeof s){a((0,t.watch)(s,()=>{l.value&&n&&d()}))}return a(p),{isActive:(0,t.shallowReadonly)(l),pause:p,resume:d}}function u(e,a,n={}){const{eventFilter:r=o,...i}=n,c=s(r,a);let l,u,p;if('sync'===i.flush){let a=!1;u=()=>{},l=e=>{a=!0,e(),a=!1},p=(0,t.watch)(e,(...e)=>{a||c(...e)},i)}else{const a=[];let n=0,s=0;u=()=>{n=s},a.push((0,t.watch)(e,()=>{s++},{...i,flush:'sync'})),l=e=>{const t=s;e(),n+=s-t},a.push((0,t.watch)(e,(...e)=>{const t=n>0&&n===s;n=0,s=0,t||c(...e)},i)),p=()=>{a.forEach(e=>e())}}return{stop:p,ignoreUpdates:l,ignorePrevAsyncUpdates:u}}function p(a,n){return'message'!==n.type||void 0!==n.message_id&&'latest'!==n.message_id||(n.message_id=-1),e(`mvu_data.${_(n).entries().sortBy(e=>e[0]).map(e=>e[1]).join('.')}`,errorCatched(()=>{const e=(0,t.ref)(a.parse(_.get(getVariables(n),'stat_data',{})));l(()=>{const t=a.safeParse(_.get(getVariables(n),'stat_data',{}));t.error||_.isEqual(t.data,e.value)||s(()=>{e.value=t.data})},2e3);const{ignoreUpdates:s}=u(e,t=>{const o=a.safeParse(t);o.error||(_.isEqual(o,t)||s(()=>{e.value=o.data}),updateVariablesWith(e=>_.set(e,'stat_data',o.data),n))},{deep:!0});return{data:e}}))}export{p as defineMvuDataStore};
//# sourceMappingURL=mvu.js.map