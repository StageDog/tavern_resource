{"version":3,"file":"mvu_zod.js","mappings":"sEACA,IAAIA,EAAsB,CAAC,ECDpB,SAASC,EAAkBC,GAC9BC,QAAQ,qBAAsB,CAACC,EAAWC,KACtC,MAAMC,EAAmBC,IACrB,MAAMC,EAASN,EAAOO,UAAUF,GAChC,QAAIC,EAAOE,UACPN,EAAUO,UAAYH,EAAOD,MACtB,IAIf,IAAK,MAAMK,KAAWP,EAAU,CAC5B,MAAME,EAAO,EAAMH,EAAUO,WACvBE,EAAOC,EAAyBF,EAAQG,KAAK,IACnD,OAAQH,EAAQI,MACZ,IAAK,MAC2B,IAAxBJ,EAAQG,KAAKE,QACbL,EAAQG,KAAKG,OAAO,EAAG,GAE3BC,EAAEC,IAAIb,EAAMM,EAAMQ,EAAkBT,EAAQG,KAAK,KACjDT,EAAgBC,GAChB,MAEJ,IAAK,SAAU,CACX,MAAMe,EAAeD,EAAkBT,EAAQG,KAAK,IAC9CQ,EAAQF,EAAkBT,EAAQG,KAAKS,IAAI,IAC3CC,EAAUlB,IACZ,MAAMmB,EAAaP,EAAEQ,IAAIpB,EAAMM,GACzBe,EAAWT,EAAEU,QAAQH,GAe3B,OAd4B,IAAxBd,EAAQG,KAAKE,OACTW,EACAF,EAAWI,KAAKP,GAGhBJ,EAAEY,OAAOL,EAAYH,GAGpBK,EACLF,EAAWR,OAAOI,EAAc,EAAGC,GAGnCG,EAAWM,OAAOV,IAAiBC,EAEhCjB,EAAgBC,IAErBmB,EAAaP,EAAEQ,IAAIpB,EAAMM,GACzBoB,EAASd,EAAEe,MAAMR,GACvB,IAAKO,IAAWd,EAAEU,QAAQH,KAAgBP,EAAEgB,cAAcT,GACtD,SAEJ,IAAKO,EAAQ,CACTR,EAAOlB,GACP,QACJ,CACA,MAAM6B,EAASjB,EAAE,EAAMZ,IAClBkB,EAAOW,EAAOhB,IAAIP,EAAM,CAAC,GAAGU,UAC7BE,EAAOW,EAAOhB,IAAIP,EAAM,IAAIU,SAEhC,KACJ,CACA,IAAK,SACDJ,EAAEkB,MAAM9B,EAAMK,EAAQG,KAAKuB,IAAIxB,IAC/BR,EAAgBC,GAI5B,CACAF,EAASY,OAAS,GAE1B,CACA,SAASH,EAAyByB,GAC9B,OAAOA,EAAOC,QAAQ,4BAA6B,KACvD,CACA,SAASnB,EAAkBkB,GACvB,MAAMhB,EASV,SAA+BgB,GAC3B,MAAME,EAAUF,EAAOG,OACvB,GAAgB,SAAZD,EACA,OAAO,EAEX,GAAgB,UAAZA,EACA,OAAO,EAEX,GAAgB,SAAZA,EACA,OAAO,KAEX,GAAgB,cAAZA,EACA,OAEJ,IACI,OAAOE,KAAKC,MAAMH,EACtB,CACA,MAAOI,GACH,GAAKJ,EAAQK,WAAW,MAAQL,EAAQM,SAAS,MAAUN,EAAQK,WAAW,MAAQL,EAAQM,SAAS,KACnG,IACI,MAAMvC,EAAS,IAAIwC,SAAS,UAAUP,KAAvB,GACf,GAAItB,EAAE8B,SAASzC,IAAW0C,MAAMrB,QAAQrB,GACpC,OAAOA,CAEf,CACA,MAAO2C,GAEP,CAER,CACA,IACI,OAAOC,KAAKR,MAAMH,EACtB,CACA,MAAOI,GAEP,CACA,OAAO/B,EAAyByB,EACpC,CA9CkBc,CAAsBd,GACpC,OAAIhB,aAAiB+B,KACV/B,EAAMgC,cAEbL,MAAMrB,QAAQN,GACPA,EAAMe,IAAIkB,GAASA,aAAgBF,KAAOE,EAAKD,cAAgBC,GAEnEjC,CACX,CChFAvB,EAAoByD,EAAI,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACX3D,EAAoB6D,EAAEF,EAAYC,KAAS5D,EAAoB6D,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMrC,IAAKgC,EAAWC,MCJ3E5D,EAAoB6D,EAAI,CAACI,EAAKC,IAAUJ,OAAOK,UAAUC,eAAeC,KAAKJ,EAAKC,U","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/src/util/mvu_zod.ts","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","export function registerMvuSchema(schema) {\n    eventOn('mag_command_parsed', (variables, commands) => {\n        const check_and_apply = (data) => {\n            const result = schema.safeParse(data);\n            if (result.success) {\n                variables.stat_data = result.data;\n                return true;\n            }\n            return false;\n        };\n        for (const command of commands) {\n            const data = klona(variables.stat_data);\n            const path = trimQuotesAndBackslashes(command.args[0]);\n            switch (command.type) {\n                case 'set': {\n                    if (command.args.length === 3) {\n                        command.args.splice(1, 1);\n                    }\n                    _.set(data, path, parseCommandValue(command.args[1]));\n                    check_and_apply(data);\n                    break;\n                }\n                case 'insert': {\n                    const key_or_index = parseCommandValue(command.args[1]);\n                    const value = parseCommandValue(command.args.at(-1));\n                    const insert = (data) => {\n                        const collection = _.get(data, path);\n                        const is_array = _.isArray(collection);\n                        if (command.args.length === 2) {\n                            if (is_array) {\n                                collection.push(value);\n                            }\n                            else {\n                                _.assign(collection, value);\n                            }\n                        }\n                        else if (is_array) {\n                            collection.splice(key_or_index, 0, value);\n                        }\n                        else {\n                            collection[String(key_or_index)] = value;\n                        }\n                        return check_and_apply(data);\n                    };\n                    const collection = _.get(data, path);\n                    const is_nil = _.isNil(collection);\n                    if (!is_nil && !_.isArray(collection) && !_.isPlainObject(collection)) {\n                        continue;\n                    }\n                    if (!is_nil) {\n                        insert(data);\n                        continue;\n                    }\n                    const filled = _(klona(data));\n                    if (!insert(filled.set(path, {}).value())) {\n                        insert(filled.set(path, []).value());\n                    }\n                    break;\n                }\n                case 'delete': {\n                    _.unset(data, command.args.map(trimQuotesAndBackslashes));\n                    check_and_apply(data);\n                    break;\n                }\n            }\n        }\n        commands.length = 0;\n    });\n}\nfunction trimQuotesAndBackslashes(string) {\n    return string.replace(/^[\\\\\"'` ]*(.*?)[\\\\\"'` ]*$/, '$1');\n}\nfunction parseCommandValue(string) {\n    const value = parseCommandValueImpl(string);\n    if (value instanceof Date) {\n        return value.toISOString();\n    }\n    if (Array.isArray(value)) {\n        return value.map(item => (item instanceof Date ? item.toISOString() : item));\n    }\n    return value;\n}\nfunction parseCommandValueImpl(string) {\n    const trimmed = string.trim();\n    if (trimmed === 'true') {\n        return true;\n    }\n    if (trimmed === 'false') {\n        return false;\n    }\n    if (trimmed === 'null') {\n        return null;\n    }\n    if (trimmed === 'undefined') {\n        return undefined;\n    }\n    try {\n        return JSON.parse(trimmed);\n    }\n    catch (e) {\n        if ((trimmed.startsWith('{') && trimmed.endsWith('}')) || (trimmed.startsWith('[') && trimmed.endsWith(']'))) {\n            try {\n                const result = new Function(`return ${trimmed};`)();\n                if (_.isObject(result) || Array.isArray(result)) {\n                    return result;\n                }\n            }\n            catch (err) {\n                // 如果解析失败，说明它可能是一个未加引号的字符串，继续往下走\n            }\n        }\n    }\n    try {\n        return YAML.parse(trimmed);\n    }\n    catch (e) {\n        /** empty */\n    }\n    return trimQuotesAndBackslashes(string);\n}\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))"],"names":["__webpack_require__","registerMvuSchema","schema","eventOn","variables","commands","check_and_apply","data","result","safeParse","success","stat_data","command","path","trimQuotesAndBackslashes","args","type","length","splice","_","set","parseCommandValue","key_or_index","value","at","insert","collection","get","is_array","isArray","push","assign","String","is_nil","isNil","isPlainObject","filled","unset","map","string","replace","trimmed","trim","JSON","parse","e","startsWith","endsWith","Function","isObject","Array","err","YAML","parseCommandValueImpl","Date","toISOString","item","d","exports","definition","key","o","Object","defineProperty","enumerable","obj","prop","prototype","hasOwnProperty","call"],"sourceRoot":""}