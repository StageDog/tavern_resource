{"version":3,"file":"mvu_zod.js","mappings":"sEACA,IAAIA,EAAsB,CAAC,ECDpB,SAASC,EAAeC,GAC3BC,QAAQ,qBAAsB,CAACC,EAAWC,KACtC,IAAK,MAAMC,KAAWD,EAAU,CAC5B,MAAME,EAAW,EAAMH,EAAUI,WAC3BC,EAAOC,EAAyBJ,EAAQK,KAAK,IACnD,OAAQL,EAAQM,MACZ,IAAK,MAC2B,IAAxBN,EAAQK,KAAKE,QACbP,EAAQK,KAAKG,OAAO,EAAG,GAE3BC,EAAEC,IAAIT,EAAUE,EAAMQ,EAAkBX,EAAQK,KAAK,KACrD,MAEJ,IAAK,SAAU,CACX,MAAMO,EAAaH,EAAEI,IAAIZ,EAAUE,GAC7BW,EAAWL,EAAEM,QAAQH,GACrBI,EAAYP,EAAEQ,cAAcL,GAClC,IAAKE,IAAaE,EACd,SAEJ,MAAME,EAAQP,EAAkBX,EAAQK,KAAKc,IAAI,IACjD,GAA4B,IAAxBnB,EAAQK,KAAKE,OACTO,EACAF,EAAWQ,KAAKF,GAGhBT,EAAEY,OAAOT,EAAYM,OAGxB,CACD,MAAMI,EAAeX,EAAkBX,EAAQK,KAAK,IAChDS,EACAF,EAAWJ,OAAOc,EAAc,EAAGJ,GAGnCN,EAAWW,OAAOD,IAAiBJ,CAE3C,CACA,KACJ,CACA,IAAK,SACDT,EAAEe,MAAMvB,EAAUD,EAAQK,MAIlC,MAAMoB,EAAS7B,EAAO8B,UAAUzB,GAC5BwB,EAAOE,UACP7B,EAAUI,UAAYuB,EAAOG,KAErC,CACA7B,EAASQ,OAAS,GAE1B,CACA,SAASH,EAAyByB,GAC9B,OAAOA,EAAOC,QAAQ,4BAA6B,KACvD,CACA,SAASnB,EAAkBkB,GACvB,MAAME,EAAUF,EAAOG,OACvB,GAAgB,SAAZD,EACA,OAAO,EAEX,GAAgB,UAAZA,EACA,OAAO,EAEX,GAAgB,SAAZA,EACA,OAAO,KAEX,GAAgB,cAAZA,EAAJ,CAGA,IACI,OAAOE,KAAKC,MAAMH,EACtB,CACA,MAAOI,GACH,GAAKJ,EAAQK,WAAW,MAAQL,EAAQM,SAAS,MAAUN,EAAQK,WAAW,MAAQL,EAAQM,SAAS,KACnG,IACI,MAAMZ,EAAS,IAAIa,SAAS,UAAUP,KAAvB,GACf,GAAItB,EAAE8B,SAASd,IAAWe,MAAMzB,QAAQU,GACpC,OAAOA,CAEf,CACA,MAAOgB,GAEP,CAER,CACA,IACI,OAAOC,KAAKR,MAAMH,EACtB,CACA,MAAOI,GAEP,CACA,OAAO/B,EAAyByB,EAvBhC,CAwBJ,CC5FAnC,EAAoBiD,EAAI,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXnD,EAAoBqD,EAAEF,EAAYC,KAASpD,EAAoBqD,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMrC,IAAKgC,EAAWC,MCJ3EpD,EAAoBqD,EAAI,CAACI,EAAKC,IAAUJ,OAAOK,UAAUC,eAAeC,KAAKJ,EAAKC,U","sources":["src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/src/util/mvu_zod.ts","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","export function registerSchema(schema) {\n    eventOn('mag_command_parsed', (variables, commands) => {\n        for (const command of commands) {\n            const new_data = klona(variables.stat_data);\n            const path = trimQuotesAndBackslashes(command.args[0]);\n            switch (command.type) {\n                case 'set': {\n                    if (command.args.length === 3) {\n                        command.args.splice(1, 1);\n                    }\n                    _.set(new_data, path, parseCommandValue(command.args[1]));\n                    break;\n                }\n                case 'insert': {\n                    const collection = _.get(new_data, path);\n                    const is_array = _.isArray(collection);\n                    const is_object = _.isPlainObject(collection);\n                    if (!is_array && !is_object) {\n                        continue;\n                    }\n                    const value = parseCommandValue(command.args.at(-1));\n                    if (command.args.length === 2) {\n                        if (is_array) {\n                            collection.push(value);\n                        }\n                        else {\n                            _.assign(collection, value);\n                        }\n                    }\n                    else {\n                        const key_or_index = parseCommandValue(command.args[1]);\n                        if (is_array) {\n                            collection.splice(key_or_index, 0, value);\n                        }\n                        else {\n                            collection[String(key_or_index)] = value;\n                        }\n                    }\n                    break;\n                }\n                case 'delete': {\n                    _.unset(new_data, command.args);\n                    break;\n                }\n            }\n            const result = schema.safeParse(new_data);\n            if (result.success) {\n                variables.stat_data = result.data;\n            }\n        }\n        commands.length = 0;\n    });\n}\nfunction trimQuotesAndBackslashes(string) {\n    return string.replace(/^[\\\\\"'` ]*(.*?)[\\\\\"'` ]*$/, '$1');\n}\nfunction parseCommandValue(string) {\n    const trimmed = string.trim();\n    if (trimmed === 'true') {\n        return true;\n    }\n    if (trimmed === 'false') {\n        return false;\n    }\n    if (trimmed === 'null') {\n        return null;\n    }\n    if (trimmed === 'undefined') {\n        return undefined;\n    }\n    try {\n        return JSON.parse(trimmed);\n    }\n    catch (e) {\n        if ((trimmed.startsWith('{') && trimmed.endsWith('}')) || (trimmed.startsWith('[') && trimmed.endsWith(']'))) {\n            try {\n                const result = new Function(`return ${trimmed};`)();\n                if (_.isObject(result) || Array.isArray(result)) {\n                    return result;\n                }\n            }\n            catch (err) {\n                // 如果解析失败，说明它可能是一个未加引号的字符串或数学表达式，继续往下走\n            }\n        }\n    }\n    try {\n        return YAML.parse(trimmed);\n    }\n    catch (e) {\n        /** empty */\n    }\n    return trimQuotesAndBackslashes(string);\n}\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))"],"names":["__webpack_require__","registerSchema","schema","eventOn","variables","commands","command","new_data","stat_data","path","trimQuotesAndBackslashes","args","type","length","splice","_","set","parseCommandValue","collection","get","is_array","isArray","is_object","isPlainObject","value","at","push","assign","key_or_index","String","unset","result","safeParse","success","data","string","replace","trimmed","trim","JSON","parse","e","startsWith","endsWith","Function","isObject","Array","err","YAML","d","exports","definition","key","o","Object","defineProperty","enumerable","obj","prop","prototype","hasOwnProperty","call"],"sourceRoot":""}